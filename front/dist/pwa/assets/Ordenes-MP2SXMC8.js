import{Q as _}from"./QSelect-CvxpBSHJ.js";import{_ as b,c as C,o as f,w as n,a as o,Q as u,e as c,b as t,an as y,at as P,d as m,t as r,f as d,a2 as x,a3 as k,a4 as q,au as w,a0 as O,Z as g,am as Q,av as E}from"./index-Jso25Eoj.js";import{Q as V}from"./QSpace-CebMmhD0.js";import{d as Y}from"./format-RUThioNZ.js";import{Q as T}from"./QPagination-BnmswFrR.js";import{Q as N}from"./QPage-D2s4N9Sv.js";import{h as p}from"./moment-C5S46NFB.js";import"./selection-C0rq1wmY.js";const D={name:"OrdenesPage",data(){return{ordenes:[],usuarios:[],estados:["Todos","Pendiente","Entregado","Cancelada"],filters:{fecha_inicio:p().startOf("week").format("YYYY-MM-DD"),fecha_fin:p().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos",search:""},resumen:{total:0,adelanto:0,saldo:0},loading:!1,pagination:{page:1,rowsPerPage:12,rowsNumber:0,lastPage:1},perPageOptions:[12,24,48,96,100]}},computed:{totalQr(){let s=0;return this.ordenes.forEach(e=>{e.tipo_pago==="QR"&&(s+=Number(e.adelanto||0))}),s.toFixed(2)},totalEfectivo(){let s=0;return this.ordenes.forEach(e=>{e.tipo_pago==="Efectivo"&&(s+=Number(e.adelanto||0))}),s.toFixed(2)}},mounted(){this.getUsuarios(),this.getOrdenes()},methods:{resetToFirst(){this.pagination.page=1},pagarTodo(s){const e=Number(s.saldo||0);this.$q.dialog({title:"Confirmar Pago",html:!0,message:`¿Confirma registrar el pago total de <b style="color: red">${this.money(e)}</b> Bs para la orden #${s.numero}?`,cancel:!0,persistent:!0}).onOk(()=>{this.$axios.post(`/ordenes/${s.id}/pagar-todo`).then(()=>{this.$alert?.success("Pago registrado correctamente"),this.getOrdenes()}).catch(v=>{this.$alert?.error(v.response?.data?.message||"Error al registrar el pago")})})},imprimirOrden(s){const e=`${this.$axios.defaults.baseURL}/ordenes/${s}/pdf`;window.open(e,"_blank")},imprimirGarantia(s){const e=`${this.$axios.defaults.baseURL}/ordenes/${s}/garantia`;window.open(e,"_blank")},getUsuarios(){this.$axios.get("users").then(s=>{this.usuarios=[{id:null,name:"Todos"},...s.data]})},getOrdenes(){this.loading=!0,this.$axios.get("ordenes",{params:{...this.filters,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(s=>{const e=s.data;this.ordenes=e.data||[],this.pagination.page=e.current_page||1,this.pagination.rowsPerPage=e.per_page||this.pagination.rowsPerPage,this.pagination.rowsNumber=e.total||this.ordenes.length,this.pagination.lastPage=e.last_page||1,this.calcularResumen()}).catch(s=>{this.$alert?.error?.(s.response?.data?.message||"Error al obtener órdenes")}).finally(()=>{this.loading=!1})},onChangePerPage(){this.pagination.page=1,this.getOrdenes()},calcularResumen(){this.resumen.total=this.ordenes.filter(s=>s.estado!=="Cancelada").reduce((s,e)=>s+Number(e.costo_total||0),0),this.resumen.adelanto=this.ordenes.filter(s=>s.estado!=="Cancelada").reduce((s,e)=>s+Number(e.adelanto||0),0),this.resumen.saldo=this.ordenes.filter(s=>s.estado!=="Cancelada").reduce((s,e)=>s+Number(e.saldo||0),0)},getEstadoColor(s){switch(s){case"Pendiente":return"#fb8c00";case"Entregado":return"#21ba45";case"Cancelada":return"#e53935";default:return"#9e9e9e"}},getEstadoIcon(s){switch(s){case"Pendiente":return"hourglass_empty";case"Entregado":return"check_circle";case"Cancelada":return"cancel";default:return"work"}},money(s){return Number(s||0).toFixed(2)},formatDateTime(s){return s?s.length>10?p(s).format("YYYY-MM-DD HH:mm"):p(s,"YYYY-MM-DD").format("YYYY-MM-DD"):"—"}},watch:{"filters.fecha_inicio"(){this.resetToFirst(),this.getOrdenes()},"filters.fecha_fin"(){this.resetToFirst(),this.getOrdenes()},"filters.user_id"(){this.resetToFirst(),this.getOrdenes()},"filters.estado"(){this.resetToFirst(),this.getOrdenes()},"filters.search"(){this.resetToFirst(),this.getOrdenes()}}},U={class:"row q-col-gutter-sm"},M={class:"col-12 col-md-3"},F={class:"col-12 col-md-3"},B={class:"col-12 col-md-6"},z={class:"col-6 col-md-2"},I={class:"text-h6 text-white"},S={class:"col-6 col-md-2"},R={class:"text-h6 text-white"},A={class:"col-12 col-md-2 q-mt-sm"},K={class:"col-12 col-md-2 q-mt-sm"},L={class:"col-12 q-mt-sm"},j={class:"row q-col-gutter-sm"},G={class:"row items-center no-wrap"},H={class:"q-ml-sm"},Z={class:"text-weight-bold"},J={class:"text-caption text-grey-7"},W={class:"muted"},X={class:"row items-center"},$={class:"text-body2 ellipsis-2-lines"},ee={class:"row q-mt-sm"},te={class:"col-4"},se={class:"text-weight-medium"},ae={class:"col-4"},oe={class:"text-weight-medium"},ie={class:"muted text-red"},le={class:"col-4"},re={class:"text-weight-medium"},ne={class:"row items-center q-mt-sm text-caption text-grey"},de={class:"col-12 q-mt-md"},ce={class:"row items-center justify-between"},me={class:"col-12 col-sm-6 q-mb-sm"},ue={class:"row items-center"},ge={class:"q-ml-md text-caption"},pe={class:"col-12 col-sm-6"},he={class:"row justify-end"};function _e(s,e,v,fe,i,l){return f(),C(N,{class:"q-pa-xs"},{default:n(()=>[o(u,{flat:"",bordered:""},{default:n(()=>[o(c,null,{default:n(()=>[t("div",U,[t("div",M,[o(_,{modelValue:i.filters.user_id,"onUpdate:modelValue":e[0]||(e[0]=a=>i.filters.user_id=a),options:i.usuarios,"option-label":"name","option-value":"id",label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",F,[o(_,{modelValue:i.filters.estado,"onUpdate:modelValue":e[1]||(e[1]=a=>i.filters.estado=a),options:i.estados,label:"Estado",dense:"",outlined:""},null,8,["modelValue","options"])]),t("div",B,[o(y,{modelValue:i.filters.search,"onUpdate:modelValue":e[2]||(e[2]=a=>i.filters.search=a),dense:"",outlined:"",placeholder:"Buscar por Nº orden, nombre o CI...",debounce:400,onKeyup:P(l.getOrdenes,["enter"])},{append:n(()=>[o(m,{name:"search"})]),_:1},8,["modelValue","onKeyup"])]),t("div",z,[o(u,{class:"items-center bg-info"},{default:n(()=>[o(c,{class:"row q-pa-none"},{default:n(()=>[o(m,{name:"payments",color:"white",size:"lg",class:"q-mr-sm"}),t("div",null,[e[6]||(e[6]=t("div",{class:"text-subtitle1 text-weight-bold text-white"},"Total QR",-1)),t("div",I,r(l.totalQr)+" Bs ",1)])]),_:1})]),_:1})]),t("div",S,[o(u,{class:"items-center bg-secondary"},{default:n(()=>[o(c,{class:"row q-pa-none"},{default:n(()=>[o(m,{name:"account_balance_wallet",color:"white",size:"lg",class:"q-mr-sm"}),t("div",null,[e[7]||(e[7]=t("div",{class:"text-subtitle1 text-weight-bold text-white"},"Total Efectivo",-1)),t("div",R,r(l.totalEfectivo)+" Bs ",1)])]),_:1})]),_:1})]),e[13]||(e[13]=t("div",{class:"col-12"},null,-1)),t("div",A,[o(d,{color:"primary",label:"Actualizar",icon:"refresh",onClick:l.getOrdenes,loading:i.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",K,[o(d,{color:"green",label:"Crear Orden",icon:"add",onClick:e[3]||(e[3]=a=>s.$router.push("/ordenes/crear")),"no-caps":""})]),t("div",L,[t("div",j,[(f(!0),x(k,null,q(i.ordenes,a=>(f(),x("div",{key:a.id,class:"col-12 col-md-4"},[o(u,{bordered:"",flat:"",class:"order-card"},{default:n(()=>[t("div",{class:"status-strip",style:w({backgroundColor:l.getEstadoColor(a.estado)})},null,4),o(c,{class:"q-pb-xs"},{default:n(()=>[t("div",G,[o(O,{icon:l.getEstadoIcon(a.estado),color:l.getEstadoColor(a.estado),"text-color":"white",size:"32px"},null,8,["icon","color"]),t("div",H,[t("div",Z,"#"+r(a.numero),1),t("div",J,[g(r(a.fecha_creacion?.substring(0,10))+" ",1),e[8]||(e[8]=t("br",null,null,-1)),t("span",W,"Creado: "+r(l.formatDateTime(a.fecha_creacion)),1)])]),o(V),o(Y,{dense:"",square:"","text-color":"white",style:w({backgroundColor:l.getEstadoColor(a.estado)})},{default:n(()=>[g(r(a.estado),1)]),_:2},1032,["style"])])]),_:2},1024),o(c,{class:"q-pt-none"},{default:n(()=>[t("div",X,[o(m,{name:"person",size:"18px",class:"q-mr-xs"}),t("div",$,r(a.cliente?.name||"N/A"),1)]),t("div",ee,[t("div",te,[e[9]||(e[9]=t("div",{class:"text-caption text-grey-7"},"Total",-1)),t("div",se,r(l.money(a.costo_total)),1)]),t("div",ae,[e[10]||(e[10]=t("div",{class:"text-caption text-grey-7"},"Adelanto",-1)),t("div",oe,[g(r(parseInt(a.adelanto)+parseInt(a.totalPagos))+" ",1),t("span",ie,r(a.tipo_pago),1)])]),t("div",le,[e[11]||(e[11]=t("div",{class:"text-caption text-grey-7"},"Saldo",-1)),t("div",re,r(l.money(a.saldo)),1)])]),t("div",ne,[o(m,{name:"account_circle",size:"16px",class:"q-mr-xs"}),g(" "+r(a.user?.name||"—"),1)])]),_:2},1024),o(Q),o(E,{align:"between",class:"q-pa-sm"},{default:n(()=>[o(d,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:h=>s.$router.push("/ordenes/editar/"+a.id)},null,8,["onClick"]),t("div",null,[o(d,{dense:"",flat:"",icon:"payment",onClick:h=>l.pagarTodo(a)},null,8,["onClick"]),o(d,{dense:"",flat:"",icon:"print",onClick:h=>l.imprimirOrden(a.id)},null,8,["onClick"]),o(d,{dense:"",flat:"",icon:"assignment",onClick:h=>l.imprimirGarantia(a.id)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128))])]),t("div",de,[t("div",ce,[t("div",me,[t("div",ue,[e[12]||(e[12]=t("div",{class:"q-mr-sm text-caption text-grey-7"},"Por página",-1)),o(_,{dense:"",outlined:"","emit-value":"","map-options":"",options:i.perPageOptions,modelValue:i.pagination.rowsPerPage,"onUpdate:modelValue":[e[4]||(e[4]=a=>i.pagination.rowsPerPage=a),l.onChangePerPage],style:{width:"110px"}},null,8,["options","modelValue","onUpdate:modelValue"]),t("div",ge," Mostrando "+r(i.ordenes.length)+" de "+r(i.pagination.rowsNumber)+" registros ",1)])]),t("div",pe,[t("div",he,[o(T,{modelValue:i.pagination.page,"onUpdate:modelValue":[e[5]||(e[5]=a=>i.pagination.page=a),l.getOrdenes],max:i.pagination.lastPage,"max-pages":7,"boundary-numbers":"","direction-links":"",size:"sm"},null,8,["modelValue","max","onUpdate:modelValue"])])])])])])]),_:1})]),_:1})]),_:1})}const qe=b(D,[["render",_e],["__scopeId","data-v-a7aaf031"]]);export{qe as default};
