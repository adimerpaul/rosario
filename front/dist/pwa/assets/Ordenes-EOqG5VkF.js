import{_ as C,c as y,o as m,w as r,a,Q as v,e as u,b as s,an as p,at as P,d as g,f as d,a2 as w,a3 as V,a4 as k,au as b,a0 as O,t as n,Z as h,am as x,av as Y}from"./index-BHtSqkkw.js";import{Q as f}from"./QSelect-CadkN1GF.js";import{Q as q}from"./QSpace-DjNMJG6k.js";import{Q}from"./format-B22FAFov.js";import{Q as U}from"./QPagination-CtBpymzJ.js";import{Q as D}from"./QPage-DwTZv9Kv.js";import{h as c}from"./moment-C5S46NFB.js";import"./QMenu-BHPn8YG1.js";import"./selection-Bpjs1JHD.js";const E={name:"OrdenesPage",data(){return{ordenes:[],usuarios:[],estados:["Todos","Pendiente","Entregado","Cancelada"],filters:{fecha_inicio:c().startOf("week").format("YYYY-MM-DD"),fecha_fin:c().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos",search:""},resumen:{total:0,adelanto:0,saldo:0},loading:!1,pagination:{page:1,rowsPerPage:12,rowsNumber:0,lastPage:1},perPageOptions:[12,24,48,96,100]}},mounted(){this.getUsuarios(),this.getOrdenes()},methods:{resetToFirst(){this.pagination.page=1},imprimirOrden(t){const e=`${this.$axios.defaults.baseURL}/ordenes/${t}/pdf`;window.open(e,"_blank")},imprimirGarantia(t){const e=`${this.$axios.defaults.baseURL}/ordenes/${t}/garantia`;window.open(e,"_blank")},getUsuarios(){this.$axios.get("users").then(t=>{this.usuarios=[{id:null,name:"Todos"},...t.data]})},getOrdenes(){this.loading=!0,this.$axios.get("ordenes",{params:{...this.filters,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(t=>{const e=t.data;this.ordenes=e.data||[],this.pagination.page=e.current_page||1,this.pagination.rowsPerPage=e.per_page||this.pagination.rowsPerPage,this.pagination.rowsNumber=e.total||this.ordenes.length,this.pagination.lastPage=e.last_page||1,this.calcularResumen()}).catch(t=>{this.$alert?.error?.(t.response?.data?.message||"Error al obtener órdenes")}).finally(()=>{this.loading=!1})},onChangePerPage(){this.pagination.page=1,this.getOrdenes()},calcularResumen(){this.resumen.total=this.ordenes.filter(t=>t.estado!=="Cancelada").reduce((t,e)=>t+Number(e.costo_total||0),0),this.resumen.adelanto=this.ordenes.filter(t=>t.estado!=="Cancelada").reduce((t,e)=>t+Number(e.adelanto||0),0),this.resumen.saldo=this.ordenes.filter(t=>t.estado!=="Cancelada").reduce((t,e)=>t+Number(e.saldo||0),0)},getEstadoColor(t){switch(t){case"Pendiente":return"#fb8c00";case"Entregado":return"#21ba45";case"Cancelada":return"#e53935";default:return"#9e9e9e"}},getEstadoIcon(t){switch(t){case"Pendiente":return"hourglass_empty";case"Entregado":return"check_circle";case"Cancelada":return"cancel";default:return"work"}},money(t){return Number(t||0).toFixed(2)},formatDateTime(t){return t?t.length>10?c(t).format("YYYY-MM-DD HH:mm"):c(t,"YYYY-MM-DD").format("YYYY-MM-DD"):"—"}},watch:{"filters.fecha_inicio"(){this.resetToFirst(),this.getOrdenes()},"filters.fecha_fin"(){this.resetToFirst(),this.getOrdenes()},"filters.user_id"(){this.resetToFirst(),this.getOrdenes()},"filters.estado"(){this.resetToFirst(),this.getOrdenes()},"filters.search"(){this.resetToFirst(),this.getOrdenes()}}},T={class:"row q-col-gutter-sm"},N={class:"col-12 col-md-3"},F={class:"col-12 col-md-3"},M={class:"col-12 col-md-3"},I={class:"col-12 col-md-3"},S={class:"col-12 col-md-6"},z={class:"col-12 col-md-2 q-mt-sm"},B={class:"col-12 col-md-2 q-mt-sm"},A={class:"col-12 q-mt-sm"},R={class:"row q-col-gutter-sm"},K={class:"row items-center no-wrap"},L={class:"q-ml-sm"},j={class:"text-weight-bold"},G={class:"text-caption text-grey-7"},H={class:"muted"},Z={class:"row items-center"},J={class:"text-body2 ellipsis-2-lines"},W={class:"row q-mt-sm"},X={class:"col-4"},$={class:"text-weight-medium"},ee={class:"col-4"},se={class:"text-weight-medium"},te={class:"col-4"},oe={class:"text-weight-medium"},ae={class:"row items-center q-mt-sm text-caption text-grey"},ie={class:"col-12 q-mt-md"},le={class:"row items-center justify-between"},ne={class:"col-12 col-sm-6 q-mb-sm"},re={class:"row items-center"},de={class:"q-ml-md text-caption"},ce={class:"col-12 col-sm-6"},me={class:"row justify-end"};function ue(t,e,pe,ge,i,l){return m(),y(D,{class:"q-pa-xs"},{default:r(()=>[a(v,{flat:"",bordered:""},{default:r(()=>[a(u,null,{default:r(()=>[s("div",T,[s("div",N,[a(p,{label:"Fecha Inicio",type:"date",dense:"",outlined:"",modelValue:i.filters.fecha_inicio,"onUpdate:modelValue":e[0]||(e[0]=o=>i.filters.fecha_inicio=o)},null,8,["modelValue"])]),s("div",F,[a(p,{label:"Fecha Fin",type:"date",dense:"",outlined:"",modelValue:i.filters.fecha_fin,"onUpdate:modelValue":e[1]||(e[1]=o=>i.filters.fecha_fin=o)},null,8,["modelValue"])]),s("div",M,[a(f,{modelValue:i.filters.user_id,"onUpdate:modelValue":e[2]||(e[2]=o=>i.filters.user_id=o),options:i.usuarios,"option-label":"name","option-value":"id",label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",I,[a(f,{modelValue:i.filters.estado,"onUpdate:modelValue":e[3]||(e[3]=o=>i.filters.estado=o),options:i.estados,label:"Estado",dense:"",outlined:""},null,8,["modelValue","options"])]),s("div",S,[a(p,{modelValue:i.filters.search,"onUpdate:modelValue":e[4]||(e[4]=o=>i.filters.search=o),dense:"",outlined:"",placeholder:"Buscar por Nº orden, nombre o CI...",debounce:400,onKeyup:P(l.getOrdenes,["enter"])},{append:r(()=>[a(g,{name:"search"})]),_:1},8,["modelValue","onKeyup"])]),s("div",z,[a(d,{color:"primary",label:"Actualizar",icon:"refresh",onClick:l.getOrdenes,loading:i.loading,"no-caps":""},null,8,["onClick","loading"])]),s("div",B,[a(d,{color:"green",label:"Crear Orden",icon:"add",onClick:e[5]||(e[5]=o=>t.$router.push("/ordenes/crear")),"no-caps":""})]),s("div",A,[s("div",R,[(m(!0),w(V,null,k(i.ordenes,o=>(m(),w("div",{key:o.id,class:"col-12 col-md-4"},[a(v,{bordered:"",flat:"",class:"order-card"},{default:r(()=>[s("div",{class:"status-strip",style:b({backgroundColor:l.getEstadoColor(o.estado)})},null,4),a(u,{class:"q-pb-xs"},{default:r(()=>[s("div",K,[a(O,{icon:l.getEstadoIcon(o.estado),color:l.getEstadoColor(o.estado),"text-color":"white",size:"32px"},null,8,["icon","color"]),s("div",L,[s("div",j,"#"+n(o.numero),1),s("div",G,[h(n(o.fecha_creacion?.substring(0,10))+" ",1),e[8]||(e[8]=s("br",null,null,-1)),s("span",H,"Creado: "+n(l.formatDateTime(o.fecha_creacion)),1)])]),a(q),a(Q,{dense:"",square:"","text-color":"white",style:b({backgroundColor:l.getEstadoColor(o.estado)})},{default:r(()=>[h(n(o.estado),1)]),_:2},1032,["style"])])]),_:2},1024),a(x,{spaced:""}),a(u,{class:"q-pt-none"},{default:r(()=>[s("div",Z,[a(g,{name:"person",size:"18px",class:"q-mr-xs"}),s("div",J,n(o.cliente?.name||"N/A"),1)]),s("div",W,[s("div",X,[e[9]||(e[9]=s("div",{class:"text-caption text-grey-7"},"Total",-1)),s("div",$,n(l.money(o.costo_total)),1)]),s("div",ee,[e[10]||(e[10]=s("div",{class:"text-caption text-grey-7"},"Adelanto",-1)),s("div",se,n(l.money(o.adelanto)),1)]),s("div",te,[e[11]||(e[11]=s("div",{class:"text-caption text-grey-7"},"Saldo",-1)),s("div",oe,n(l.money(o.saldo)),1)])]),s("div",ae,[a(g,{name:"account_circle",size:"16px",class:"q-mr-xs"}),h(" "+n(o.user?.name||"—"),1)])]),_:2},1024),a(x),a(Y,{align:"between",class:"q-pa-sm"},{default:r(()=>[a(d,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:_=>t.$router.push("/ordenes/editar/"+o.id)},null,8,["onClick"]),s("div",null,[a(d,{dense:"",flat:"",icon:"print",onClick:_=>l.imprimirOrden(o.id)},null,8,["onClick"]),a(d,{dense:"",flat:"",icon:"assignment",onClick:_=>l.imprimirGarantia(o.id)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128))])]),s("div",ie,[s("div",le,[s("div",ne,[s("div",re,[e[12]||(e[12]=s("div",{class:"q-mr-sm text-caption text-grey-7"},"Por página",-1)),a(f,{dense:"",outlined:"","emit-value":"","map-options":"",options:i.perPageOptions,modelValue:i.pagination.rowsPerPage,"onUpdate:modelValue":[e[6]||(e[6]=o=>i.pagination.rowsPerPage=o),l.onChangePerPage],style:{width:"110px"}},null,8,["options","modelValue","onUpdate:modelValue"]),s("div",de," Mostrando "+n(i.ordenes.length)+" de "+n(i.pagination.rowsNumber)+" registros ",1)])]),s("div",ce,[s("div",me,[a(U,{modelValue:i.pagination.page,"onUpdate:modelValue":[e[7]||(e[7]=o=>i.pagination.page=o),l.getOrdenes],max:i.pagination.lastPage,"max-pages":7,"boundary-numbers":"","direction-links":"",size:"sm"},null,8,["modelValue","max","onUpdate:modelValue"])])])])])])]),_:1})]),_:1})]),_:1})}const Pe=C(E,[["render",ue],["__scopeId","data-v-54bdee98"]]);export{Pe as default};
