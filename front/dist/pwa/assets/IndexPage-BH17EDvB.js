import{_ as v,Y as w,c as k,o as N,w as a,b as s,a as e,a6 as Q,f as I,Q as m,e as d,a0 as b,t as u,Z as _,a7 as x,a8 as C}from"./index-Bxw-T3oo.js";import{Q as f}from"./QChip-Cle8wZD0.js";import{Q as O}from"./QBadge-GoVQeAcA.js";import{Q as E}from"./QInnerLoading-BeA8-oNx.js";import{Q as q}from"./QPage-pNAokgfe.js";import{h as y}from"./moment-C5S46NFB.js";import{m as R}from"./vue3-apexcharts-DQUG_lL5.js";const S={name:"IndexPage",components:{apexchart:R},data(){return{loading:!1,selectedDate:y().format("YYYY-MM-DD"),dashboard:null,kpi:{dayIngresos:0,dayEgresos:0,dayCaja:0,ordenesRetrasadas:0,prestamosRetrasados:0},lineSeries:[{name:"Ingresos",data:[]},{name:"Egresos",data:[]}],lineOptions:{chart:{toolbar:{show:!1}},stroke:{width:3,curve:"smooth"},dataLabels:{enabled:!1},xaxis:{categories:[]},yaxis:{labels:{formatter:t=>Number(t||0).toFixed(0)}},tooltip:{y:{formatter:t=>`${Number(t||0).toFixed(2)} Bs.`}}},barSeries:[{name:"Neto semanal",data:[]}],barOptions:{chart:{toolbar:{show:!1}},plotOptions:{bar:{borderRadius:6,columnWidth:"55%"}},dataLabels:{enabled:!1},xaxis:{categories:[]},yaxis:{labels:{formatter:t=>Number(t||0).toFixed(0)}},tooltip:{y:{formatter:t=>`${Number(t||0).toFixed(2)} Bs.`}}},donutSeries:[0,0],donutOptions:{labels:["EFECTIVO","QR"],legend:{position:"bottom"},dataLabels:{enabled:!0},tooltip:{y:{formatter:t=>`${Number(t||0).toFixed(2)} Bs.`}}}}},mounted(){this.load()},methods:{money(t){return`${Number(t||0).toFixed(2)} Bs.`},async load(){this.loading=!0;try{const{data:t}=await this.$axios.get("dashboard",{params:{date:this.selectedDate,days:56}});this.dashboard=t,this.kpi.dayIngresos=Number(t?.kpi?.dayIngresos||0),this.kpi.dayEgresos=Number(t?.kpi?.dayEgresos||0),this.kpi.dayCaja=Number(t?.kpi?.dayCaja||0),this.kpi.ordenesRetrasadas=Number(t?.kpi?.ordenesRetrasadas||0),this.kpi.prestamosRetrasados=Number(t?.kpi?.prestamosRetrasados||0),this.donutSeries=Array.isArray(t?.donut?.series)?t.donut.series.map(o=>Number(o||0)):[0,0],this.buildLineChart(14),this.buildWeeklyBars(8)}catch(t){this.$q.notify({type:"negative",message:t.response?.data?.message||"Error al cargar dashboard"})}finally{this.loading=!1}},buildLineChart(t=14){const n=(Array.isArray(this.dashboard?.days)?this.dashboard.days:[]).slice(-t),h=n.map(r=>y(r.date).format("DD/MM")),i=n.map(r=>Number(r.total_ingresos||0)),c=n.map(r=>Number(r.total_egresos||0));this.lineOptions={...this.lineOptions,xaxis:{...this.lineOptions.xaxis,categories:h}},this.lineSeries=[{name:"Ingresos",data:i},{name:"Egresos",data:c}]},buildWeeklyBars(t=8){const o=Array.isArray(this.dashboard?.days)?this.dashboard.days:[],n={};o.forEach(l=>{const p=y(l.date).format("GGGG-[W]WW"),g=Number(l.total_ingresos||0)-Number(l.total_egresos||0);n[p]=(n[p]||0)+g});const i=Object.keys(n).sort().slice(-t),c=i.map(l=>{const p=l.split("W")[1],g=l.split("-")[0];return`W${p} ${g}`}),r=i.map(l=>Number(n[l]||0));this.barOptions={...this.barOptions,xaxis:{...this.barOptions.xaxis,categories:c}},this.barSeries=[{name:"Neto semanal",data:r}]}}},D={class:"row items-center q-col-gutter-sm q-mb-md"},B={class:"col-auto"},F={class:"col-auto"},W={class:"row q-col-gutter-md q-mb-md"},j={class:"col-12 col-md-4"},A={class:"col-auto"},V={class:"col"},L={class:"text-h6"},M={class:"col-12 col-md-4"},P={class:"col-auto"},Y={class:"col"},G={class:"text-h6"},T={class:"col-12 col-md-4"},z={class:"col-auto"},K={class:"col"},U={class:"text-h6"},Z={class:"row q-col-gutter-md q-mb-md"},H={class:"col-12 col-md-6"},J={class:"col-auto"},X={class:"col-12 col-md-6"},$={class:"col-auto"},ss={class:"row q-col-gutter-md"},es={class:"col-12 col-lg-7"},ts={class:"col-12 col-lg-5"};function os(t,o,n,h,i,c){const r=w("apexchart");return N(),k(q,{class:"q-pa-md bg-grey-2"},{default:a(()=>[s("div",D,[o[1]||(o[1]=s("div",{class:"col"},[s("div",{class:"text-h5 text-weight-bold"},"Dashboard"),s("div",{class:"text-caption text-grey-7"}," Resumen por día y mejoras por semanas. ")],-1)),s("div",B,[e(Q,{dense:"",outlined:"",modelValue:i.selectedDate,"onUpdate:modelValue":o[0]||(o[0]=l=>i.selectedDate=l),type:"date",label:"Fecha",style:{"min-width":"190px"},onInput:c.load},null,8,["modelValue","onInput"])]),s("div",F,[e(I,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:i.loading,onClick:c.load},null,8,["loading","onClick"])])]),s("div",W,[s("div",j,[e(m,{flat:"",bordered:"",class:"shadow-1"},{default:a(()=>[e(d,{class:"row items-center q-col-gutter-sm"},{default:a(()=>[s("div",A,[e(b,{color:"green-6","text-color":"white",icon:"trending_up"})]),s("div",V,[o[2]||(o[2]=s("div",{class:"text-caption text-grey-7"},"Ingresos (día)",-1)),s("div",L,u(c.money(i.kpi.dayIngresos)),1)])]),_:1})]),_:1})]),s("div",M,[e(m,{flat:"",bordered:"",class:"shadow-1"},{default:a(()=>[e(d,{class:"row items-center q-col-gutter-sm"},{default:a(()=>[s("div",P,[e(b,{color:"red-6","text-color":"white",icon:"trending_down"})]),s("div",Y,[o[3]||(o[3]=s("div",{class:"text-caption text-grey-7"},"Egresos (día)",-1)),s("div",G,u(c.money(i.kpi.dayEgresos)),1)])]),_:1})]),_:1})]),s("div",T,[e(m,{flat:"",bordered:"",class:"shadow-1"},{default:a(()=>[e(d,{class:"row items-center q-col-gutter-sm"},{default:a(()=>[s("div",z,[e(b,{color:"blue-6","text-color":"white",icon:"account_balance_wallet"})]),s("div",K,[o[4]||(o[4]=s("div",{class:"text-caption text-grey-7"},"Caja (día)",-1)),s("div",U,u(c.money(i.kpi.dayCaja)),1)])]),_:1})]),_:1})])]),s("div",Z,[s("div",H,[e(m,{flat:"",bordered:"",class:"shadow-1"},{default:a(()=>[e(d,{class:"row items-center"},{default:a(()=>[o[5]||(o[5]=s("div",{class:"col"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Retrasos"),s("div",{class:"text-caption text-grey-7"},"Órdenes y Préstamos con atraso")],-1)),s("div",J,[e(f,{color:"red-6","text-color":"white",dense:""},{default:a(()=>[_(" Órdenes retrasadas: "+u(i.kpi.ordenesRetrasadas),1)]),_:1}),e(f,{color:"deep-orange-6","text-color":"white",dense:"",class:"q-ml-sm"},{default:a(()=>[_(" Préstamos retrasados: "+u(i.kpi.prestamosRetrasados),1)]),_:1})])]),_:1})]),_:1})]),s("div",X,[e(m,{flat:"",bordered:"",class:"shadow-1"},{default:a(()=>[e(d,{class:"row items-center"},{default:a(()=>[o[6]||(o[6]=s("div",{class:"col"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Método de pago (día)"),s("div",{class:"text-caption text-grey-7"}," Distribución de ingresos EFECTIVO/QR para la fecha seleccionada ")],-1)),s("div",$,[e(O,{outline:"",color:"grey-8"},{default:a(()=>[_(u(i.selectedDate),1)]),_:1})])]),_:1}),e(x),e(d,null,{default:a(()=>[e(r,{type:"donut",height:"260",options:i.donutOptions,series:i.donutSeries},null,8,["options","series"])]),_:1})]),_:1})])]),s("div",ss,[s("div",es,[e(m,{flat:"",bordered:"",class:"shadow-1"},{default:a(()=>[e(d,{class:"row items-center"},{default:a(()=>o[7]||(o[7]=[s("div",{class:"col"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Ingresos vs Egresos (diario)"),s("div",{class:"text-caption text-grey-7"},"Últimos 14 días")],-1)])),_:1}),e(x),e(d,null,{default:a(()=>[e(r,{type:"line",height:"320",options:i.lineOptions,series:i.lineSeries},null,8,["options","series"])]),_:1})]),_:1})]),s("div",ts,[e(m,{flat:"",bordered:"",class:"shadow-1"},{default:a(()=>[e(d,{class:"row items-center"},{default:a(()=>o[8]||(o[8]=[s("div",{class:"col"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Mejoras por semana"),s("div",{class:"text-caption text-grey-7"},"Últimas 8 semanas (Neto semanal)")],-1)])),_:1}),e(x),e(d,null,{default:a(()=>[e(r,{type:"bar",height:"320",options:i.barOptions,series:i.barSeries},null,8,["options","series"])]),_:1})]),_:1})])]),e(E,{showing:i.loading},{default:a(()=>[e(C,{size:"34px"})]),_:1},8,["showing"])]),_:1})}const ms=v(S,[["render",os],["__scopeId","data-v-a3a37469"]]);export{ms as default};
