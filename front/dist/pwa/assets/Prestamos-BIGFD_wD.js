import{_ as w,c as q,o as u,w as d,a,Q as m,e as n,b as e,an as g,d as c,f as _,t as i,a2 as h,a1 as C,a3 as k,a4 as Q,ay as x,a0 as U,Z as V,am as y,az as N}from"./index-DePMG0cy.js";import{Q as p}from"./QSelect-BoFoKKct.js";import{Q as F}from"./QSpace-U9HCJXDw.js";import{Q as I}from"./format-B2tpYWqK.js";import{Q as A}from"./QPagination-DK_iaAlO.js";import{Q as E}from"./QPage-Crx2SrYo.js";import{h as P}from"./moment-C5S46NFB.js";import"./QMenu-BdRM3-9X.js";import"./selection-CQYWlQ2Y.js";const S={name:"PrestamosPage",data(){return{prestamos:[],usuarios:[],estados:["Todos","Pendiente","Pagado","Cancelado","Vencido"],filters:{fecha_inicio:P().startOf("week").format("YYYY-MM-DD"),fecha_fin:P().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos",search:""},page:1,perPage:12,perPageOptions:[6,12,24,36,60].map(l=>({label:String(l),value:l})),totalPages:1,totalItems:0,from:0,to:0,resumen:{prestado:0,cargos:0,saldo:0},loading:!1}},mounted(){this.getUsuarios(),this.getPrestamos()},methods:{resetAndFetch(){this.page=1,this.getPrestamos()},getUsuarios(){this.$axios.get("users").then(l=>{this.usuarios=[{id:null,name:"Todos"},...l.data]})},getPrestamos(){this.loading=!0,this.$axios.get("prestamos",{params:{...this.filters,page:this.page,per_page:this.perPage}}).then(l=>{const s=l.data;this.prestamos=s.data||s,this.totalPages=s.last_page||1,this.page=s.current_page||1,this.totalItems=s.total||(s.data?s.data.length:this.prestamos.length),this.from=s.from||(this.page-1)*this.perPage+(this.totalItems?1:0),this.to=s.to||Math.min(this.page*this.perPage,this.totalItems),this.calcularResumen()}).catch(l=>{this.$alert?.error?.(l.response?.data?.message||"Error al obtener préstamos")}).finally(()=>{this.loading=!1})},calcularResumen(){const l=(t,r)=>t.reduce((o,b)=>o+r(b),0),s=t=>Number(t.valor_prestado||0),f=t=>s(t)*Number(t.interes||0)/100,v=t=>s(t)*Number(t.almacen||0)/100;this.resumen.prestado=l(this.prestamos,s),this.resumen.cargos=l(this.prestamos,t=>f(t)+v(t)),this.resumen.saldo=l(this.prestamos,t=>Number(t.saldo||0))},cargosTotales(l){const s=Number(l.valor_prestado||0);return s*Number(l.interes||0)/100+s*Number(l.almacen||0)/100},getEstadoColor(l){return l==="Pendiente"?"#fb8c00":l==="Pagado"?"#21ba45":l==="Cancelado"?"#e53935":l==="Vencido"?"#f4511e":"#9e9e9e"},getEstadoIcon(l){return l==="Pendiente"?"hourglass_empty":l==="Pagado"?"check_circle":l==="Cancelado"?"block":l==="Vencido"?"warning":"payments"},money(l){return Number(l||0).toFixed(2)}}},z={class:"row q-col-gutter-sm"},Y={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},M={class:"col-12 col-md-3"},T={class:"col-12 col-md-3"},D={class:"col-12 col-md-6"},O={class:"col-12 col-md-2"},R={class:"col-12 col-md-2 q-mt-sm"},j={class:"col-12 col-md-2 q-mt-sm"},L={class:"col-12 col-md-8 q-mt-sm"},Z={class:"row q-col-gutter-sm"},G={class:"col-12 col-md-4"},H={class:"text-h6"},J={class:"col-12 col-md-4"},K={class:"text-h6"},W={class:"col-12 col-md-4"},X={class:"text-h6"},$={class:"col-12 q-mt-sm"},ee={class:"row q-col-gutter-sm"},se={class:"row items-center no-wrap"},te={class:"q-ml-sm"},oe={class:"text-weight-bold"},ae={class:"text-caption text-grey-7"},le={class:"row items-center"},re={class:"text-body2 ellipsis-2-lines"},ie={class:"row q-mt-sm"},de={class:"col-6"},ne={class:"text-weight-medium"},ce={class:"col-6"},me={class:"text-weight-medium"},ue={class:"text-caption text-grey"},ge={class:"row q-mt-sm"},_e={class:"col-6"},he={class:"text-weight-medium"},pe={class:"col-6"},fe={class:"text-weight-medium"},ve={class:"row items-center q-mt-sm text-caption text-grey"},be={key:0,class:"row items-center justify-between q-mt-sm"},xe={class:"col-auto text-caption text-grey-8 q-ml-sm"},Ve={class:"col-auto"};function ye(l,s,f,v,t,r){return u(),q(E,{class:"q-pa-xs"},{default:d(()=>[a(m,{flat:"",bordered:""},{default:d(()=>[a(n,null,{default:d(()=>[e("div",z,[e("div",Y,[a(g,{type:"date",label:"Fecha Inicio",dense:"",outlined:"",modelValue:t.filters.fecha_inicio,"onUpdate:modelValue":[s[0]||(s[0]=o=>t.filters.fecha_inicio=o),r.resetAndFetch]},null,8,["modelValue","onUpdate:modelValue"])]),e("div",B,[a(g,{type:"date",label:"Fecha Fin",dense:"",outlined:"",modelValue:t.filters.fecha_fin,"onUpdate:modelValue":[s[1]||(s[1]=o=>t.filters.fecha_fin=o),r.resetAndFetch]},null,8,["modelValue","onUpdate:modelValue"])]),e("div",M,[a(p,{modelValue:t.filters.user_id,"onUpdate:modelValue":[s[2]||(s[2]=o=>t.filters.user_id=o),r.resetAndFetch],options:t.usuarios,"option-label":"name","option-value":"id","emit-value":"","map-options":"",dense:"",outlined:"",label:"Usuario"},null,8,["modelValue","options","onUpdate:modelValue"])]),e("div",T,[a(p,{modelValue:t.filters.estado,"onUpdate:modelValue":[s[3]||(s[3]=o=>t.filters.estado=o),r.resetAndFetch],options:t.estados,dense:"",outlined:"",label:"Estado"},null,8,["modelValue","options","onUpdate:modelValue"])]),e("div",D,[a(g,{modelValue:t.filters.search,"onUpdate:modelValue":[s[4]||(s[4]=o=>t.filters.search=o),r.resetAndFetch],dense:"",outlined:"",placeholder:"Buscar por Nº, nombre o CI…",debounce:400},{append:d(()=>[a(c,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),e("div",O,[a(p,{dense:"",outlined:"",modelValue:t.perPage,"onUpdate:modelValue":[s[5]||(s[5]=o=>t.perPage=o),r.resetAndFetch],options:t.perPageOptions,label:"Por página","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])]),e("div",R,[a(_,{color:"primary",label:"Actualizar",icon:"refresh",loading:t.loading,"no-caps":"",onClick:r.getPrestamos},null,8,["loading","onClick"])]),e("div",j,[a(_,{color:"green",label:"Nuevo Préstamo",icon:"add","no-caps":"",onClick:s[6]||(s[6]=o=>l.$router.push("/prestamos/crear"))})]),e("div",L,[e("div",Z,[e("div",G,[a(m,{bordered:"",class:"bg-blue-1"},{default:d(()=>[a(n,{class:"row items-center"},{default:d(()=>[a(c,{name:"savings",color:"blue",size:"lg",class:"q-mr-sm"}),e("div",null,[s[8]||(s[8]=e("div",{class:"text-subtitle1 text-weight-bold text-blue"},"Prestado",-1)),e("div",H,i(r.money(t.resumen.prestado)),1)])]),_:1})]),_:1})]),e("div",J,[a(m,{bordered:"",class:"bg-orange-1"},{default:d(()=>[a(n,{class:"row items-center"},{default:d(()=>[a(c,{name:"stacked_bar_chart",color:"orange",size:"lg",class:"q-mr-sm"}),e("div",null,[s[9]||(s[9]=e("div",{class:"text-subtitle1 text-weight-bold text-orange"},"Cargos (Int+Alm)",-1)),e("div",K,i(r.money(t.resumen.cargos)),1)])]),_:1})]),_:1})]),e("div",W,[a(m,{bordered:"",class:"bg-red-1"},{default:d(()=>[a(n,{class:"row items-center"},{default:d(()=>[a(c,{name:"account_balance_wallet",color:"red",size:"lg",class:"q-mr-sm"}),e("div",null,[s[10]||(s[10]=e("div",{class:"text-subtitle1 text-weight-bold text-red"},"Saldo",-1)),e("div",X,i(r.money(t.resumen.saldo)),1)])]),_:1})]),_:1})])])]),e("div",$,[e("div",ee,[(u(!0),h(k,null,Q(t.prestamos,o=>(u(),h("div",{key:o.id,class:"col-12 col-sm-6 col-md-4"},[a(m,{bordered:"",flat:"",class:"loan-card"},{default:d(()=>[e("div",{class:"status-strip",style:x({backgroundColor:r.getEstadoColor(o.estado)})},null,4),a(n,{class:"q-pb-xs"},{default:d(()=>[e("div",se,[a(U,{icon:r.getEstadoIcon(o.estado),color:r.getEstadoColor(o.estado),"text-color":"white",size:"32px"},null,8,["icon","color"]),e("div",te,[e("div",oe,"#"+i(o.numero),1),e("div",ae,i(String(o.fecha_creacion).substring(0,10)),1)]),a(F),a(I,{dense:"",square:"","text-color":"white",style:x({backgroundColor:r.getEstadoColor(o.estado)})},{default:d(()=>[V(i(o.estado),1)]),_:2},1032,["style"])])]),_:2},1024),a(y,{spaced:""}),a(n,{class:"q-pt-none"},{default:d(()=>[e("div",le,[a(c,{name:"person",size:"18px",class:"q-mr-xs"}),e("div",re,i(o.cliente?.name||"N/A"),1)]),e("div",ie,[e("div",de,[s[11]||(s[11]=e("div",{class:"text-caption text-grey-7"},"Prestado",-1)),e("div",ne,i(r.money(o.valor_prestado)),1)]),e("div",ce,[s[12]||(s[12]=e("div",{class:"text-caption text-grey-7"},"Cargos",-1)),e("div",me,i(r.money(r.cargosTotales(o))),1),e("div",ue,i(o.interes)+"% + "+i(o.almacen)+"%",1)])]),e("div",ge,[e("div",_e,[s[13]||(s[13]=e("div",{class:"text-caption text-grey-7"},"Peso (kg)",-1)),e("div",he,i(Number(o.peso||0).toFixed(3)),1)]),e("div",pe,[s[14]||(s[14]=e("div",{class:"text-caption text-grey-7"},"Saldo",-1)),e("div",fe,i(r.money(o.saldo)),1)])]),e("div",ve,[a(c,{name:"account_circle",size:"16px",class:"q-mr-xs"}),V(" "+i(o.user?.name||"—"),1)])]),_:2},1024),a(y),a(N,{align:"between",class:"q-pa-sm"},{default:d(()=>[a(_,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:b=>l.$router.push("/prestamos/editar/"+o.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),t.totalPages>1?(u(),h("div",be,[e("div",xe," Mostrando "+i(t.from)+"–"+i(t.to)+" de "+i(t.totalItems),1),e("div",Ve,[a(A,{modelValue:t.page,"onUpdate:modelValue":[s[7]||(s[7]=o=>t.page=o),r.getPrestamos],max:t.totalPages,"max-pages":6,"boundary-numbers":"",color:"primary",disable:t.loading},null,8,["modelValue","max","disable","onUpdate:modelValue"])])])):C("",!0)])])]),_:1})]),_:1})]),_:1})}const Ie=w(S,[["render",ye],["__scopeId","data-v-f288fb31"]]);export{Ie as default};
