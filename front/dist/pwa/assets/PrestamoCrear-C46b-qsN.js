import{_ as f,c as b,o as u,w as r,a as s,Q as g,e as c,b as o,Z as m,an as n,d as _,f as p,a2 as h,a3 as V,a4 as v,a5 as x,t as i,as as C,a1 as y}from"./index-H1xfLONU.js";import{Q}from"./QPagination-CEle5SeA.js";import{Q as k}from"./format-BLZ5nlkB.js";import{Q as P}from"./QMarkupTable-r3-gjMWZ.js";import{Q as U}from"./QBanner-BJINbKKa.js";import{Q as w}from"./QForm-BMjke_cd.js";import{Q as S}from"./QPage-BwE-RHpL.js";import{h as q}from"./moment-C5S46NFB.js";const B={name:"PrestamoCrearPage",data(){return{page:1,totalPages:1,clientes:[],clienteFiltro:"",loading:!1,precioOro:{value:0},prestamo:{fecha_limite:q().add(1,"months").format("YYYY-MM-DD"),peso:0,valor_total:0,valor_prestado:0,interes:0,saldo:0,celular:"",detalle:"",cliente_id:null,cliente:null}}},async mounted(){await this.getClientes();const a=await this.$axios.get("cogs/1");this.precioOro=a.data},methods:{getClientes(){this.loading=!0,this.$axios.get("clients",{params:{search:this.clienteFiltro,page:this.page,per_page:10}}).then(a=>{this.clientes=a.data.data,this.totalPages=a.data.last_page||1}).finally(()=>{this.loading=!1})},seleccionarCliente(a){this.prestamo.cliente=a,this.prestamo.cliente_id=a.id,this.prestamo.celular=a.cellphone||""},calcularTotales(){const a=(this.prestamo.peso||0)*(this.precioOro.value||0);this.prestamo.valor_total=a,this.calcularSaldo()},calcularSaldo(){this.prestamo.saldo=(this.prestamo.valor_prestado||0)+(this.prestamo.interes||0)},guardarPrestamo(){if(!this.prestamo.cliente_id){this.$alert.error("Debe seleccionar un cliente");return}this.loading=!0,this.$axios.post("prestamos",{...this.prestamo,user_id:this.$store.user.id}).then(()=>{this.$alert.success("Préstamo creado"),this.$router.push("/prestamos")}).catch(a=>this.$alert.error(a.response?.data?.message||"Error al guardar")).finally(()=>{this.loading=!1})}}},M={class:"row"},F={class:"col-12 col-md-5"},N={class:"row"},D={class:"col-12 col-md-8"},I={class:"col-12 col-md-3 text-right"},T={class:"flex flex-center q-mb-sm"},z={style:{"white-space":"normal","max-width":"140px","word-break":"break-word","font-size":"12px","line-height":".9"}},O={class:"col-12 col-md-7"},Y={class:"text-grey text-caption"},E={class:"row q-col-gutter-sm"},L={class:"col-6 col-md-4"},A={class:"col-6 col-md-4"},G={class:"col-6 col-md-4"},Z={class:"col-6 col-md-4"},j={class:"col-6 col-md-4"},H={class:"col-6 col-md-4"},J={class:"col-12 col-md-4"},K={class:"col-12"},R={key:0,class:"col-12 q-mt-sm"},W={class:"q-mt-md text-right"};function X(a,e,$,ee,l,d){return u(),b(S,{class:"q-pa-xs"},{default:r(()=>[s(g,{flat:"",bordered:""},{default:r(()=>[s(c,{class:"q-pa-xs"},{default:r(()=>[o("div",M,[o("div",F,[s(g,{flat:"",bordered:""},{default:r(()=>[s(c,{class:"text-bold q-pa-xs"},{default:r(()=>e[11]||(e[11]=[m("Seleccionar Cliente")])),_:1}),o("div",N,[o("div",D,[s(n,{dense:"",outlined:"",clearable:"",modelValue:l.clienteFiltro,"onUpdate:modelValue":[e[0]||(e[0]=t=>l.clienteFiltro=t),d.getClientes],placeholder:"Buscar cliente...",debounce:400},{append:r(()=>[s(_,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),o("div",I,[s(p,{label:"Buscar",color:"primary",onClick:d.getClientes,loading:l.loading,"no-caps":"",dense:"",size:"10px",icon:"search"},null,8,["onClick","loading"])])]),o("div",T,[s(Q,{modelValue:l.page,"onUpdate:modelValue":[e[1]||(e[1]=t=>l.page=t),d.getClientes],max:l.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])]),s(P,{flat:"",bordered:"",dense:""},{default:r(()=>[e[12]||(e[12]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Nombre"),o("th",null,"CI"),o("th",null,"Estado"),o("th",null,"Acción")])],-1)),o("tbody",null,[(u(!0),h(V,null,v(l.clientes,t=>(u(),h("tr",{key:t.id,class:x({"bg-blue-2":l.prestamo.cliente_id===t.id})},[o("td",z,i(t.name),1),o("td",null,i(t.ci),1),o("td",null,[s(k,{color:t.status==="Confiable"?"green":t.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:r(()=>[m(i(t.status),1)]),_:2},1032,["color"])]),o("td",null,[s(p,{label:"Seleccionar",color:"primary",dense:"","no-caps":"",icon:"check",onClick:le=>d.seleccionarCliente(t)},null,8,["onClick"])])],2))),128))])]),_:1})]),_:1})]),o("div",O,[s(g,{flat:"",bordered:""},{default:r(()=>[s(c,{class:"text-bold q-pa-xs"},{default:r(()=>[e[13]||(e[13]=m(" Crear Préstamo ")),o("span",Y,"(Precio oro compra: "+i(l.precioOro.value)+")",1)]),_:1}),s(c,{class:"q-pa-xs"},{default:r(()=>[s(w,{onSubmit:C(d.guardarPrestamo,["prevent"])},{default:r(()=>[o("div",E,[o("div",L,[s(n,{label:"Fecha Límite",type:"date",modelValue:l.prestamo.fecha_limite,"onUpdate:modelValue":e[2]||(e[2]=t=>l.prestamo.fecha_limite=t),outlined:"",dense:""},null,8,["modelValue"])]),o("div",A,[s(n,{label:"Celular",modelValue:l.prestamo.celular,"onUpdate:modelValue":e[3]||(e[3]=t=>l.prestamo.celular=t),outlined:"",dense:""},null,8,["modelValue"])]),o("div",G,[s(n,{label:"Peso (kg)",type:"number",modelValue:l.prestamo.peso,"onUpdate:modelValue":[e[4]||(e[4]=t=>l.prestamo.peso=t),d.calcularTotales],modelModifiers:{number:!0},min:"0",step:"0.001",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Z,[s(n,{label:"Valor Total (ref.)",modelValue:l.prestamo.valor_total,"onUpdate:modelValue":e[5]||(e[5]=t=>l.prestamo.valor_total=t),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),o("div",j,[s(n,{label:"Prestado (Bs)",modelValue:l.prestamo.valor_prestado,"onUpdate:modelValue":[e[6]||(e[6]=t=>l.prestamo.valor_prestado=t),d.calcularSaldo],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),o("div",H,[s(n,{label:"Interés (Bs)",modelValue:l.prestamo.interes,"onUpdate:modelValue":[e[7]||(e[7]=t=>l.prestamo.interes=t),d.calcularSaldo],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),o("div",J,[s(n,{label:"Saldo",modelValue:l.prestamo.saldo,"onUpdate:modelValue":e[8]||(e[8]=t=>l.prestamo.saldo=t),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),o("div",K,[s(n,{label:"Detalle",modelValue:l.prestamo.detalle,"onUpdate:modelValue":e[9]||(e[9]=t=>l.prestamo.detalle=t),type:"textarea",outlined:"",dense:""},null,8,["modelValue"])]),l.prestamo.cliente?(u(),h("div",R,[s(U,{class:"bg-grey-2"},{default:r(()=>[e[14]||(e[14]=m(" Cliente: ")),o("b",null,i(l.prestamo.cliente.name),1),m(" (CI: "+i(l.prestamo.cliente.ci)+") ",1)]),_:1})])):y("",!0)]),o("div",W,[s(p,{label:"Cancelar",color:"negative",onClick:e[10]||(e[10]=t=>a.$router.push("/prestamos")),class:"q-mr-sm",loading:l.loading},null,8,["loading"]),s(p,{label:"Guardar",type:"submit",color:"green",loading:l.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})}const me=f(B,[["render",X]]);export{me as default};
