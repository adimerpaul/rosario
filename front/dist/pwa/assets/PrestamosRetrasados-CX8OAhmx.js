import{_ as Q,c as q,o as m,w as r,a as t,Q as u,e as c,b as e,an as x,d as _,ax as V,f as h,t as d,am as f,a2 as g,a1 as y,a3 as C,a4 as D,ay as p,a0 as P,Z as b,az as k,aq as N}from"./index-DePMG0cy.js";import{Q as S}from"./QSelect-BoFoKKct.js";import{Q as U}from"./QSpace-U9HCJXDw.js";import{Q as w}from"./format-B2tpYWqK.js";import{Q as z}from"./QBanner-Ca_ptwCo.js";import{Q as B}from"./QPagination-DK_iaAlO.js";import{Q as R}from"./QInnerLoading-jie7dCwJ.js";import{Q as A}from"./QPage-Crx2SrYo.js";import{h as H}from"./moment-C5S46NFB.js";import"./QMenu-BdRM3-9X.js";import"./selection-CQYWlQ2Y.js";const I={name:"PrestamosRetrasados",data(){return{prestamos:[],usuarios:[{id:null,name:"Todos"}],filters:{search:"",user_id:null,dias:1},page:1,perPage:24,totalPages:1,resumen:{total:0,saldo:0,promDias:0},loading:!1}},mounted(){this.getUsuarios(),this.fetchData()},methods:{async getUsuarios(){try{const{data:s}=await this.$axios.get("users");this.usuarios=[{id:null,name:"Todos"},...s]}catch{}},async fetchData(){this.loading=!0;try{const{data:s}=await this.$axios.get("prestamosRetrasados",{params:{...this.filters,page:this.page,per_page:this.perPage}});this.prestamos=s.data||s,this.totalPages=s.last_page||1,this.page=s.current_page||this.page,this.calcularResumen()}catch(s){this.$alert?.error?.(s.response?.data?.message||"Error al obtener préstamos retrasados")}finally{this.loading=!1}},calcularResumen(){const s=this.prestamos.length||1,a=(n,v)=>n.reduce((l,i)=>l+v(i),0);this.resumen.total=this.prestamos.length,this.resumen.saldo=a(this.prestamos,n=>Number(n.saldo||0)),this.resumen.promDias=(a(this.prestamos,n=>Number(n.dias_retraso||0))/s).toFixed(1)},cargos(s){const a=Number(s.valor_prestado||0);return a*Number(s.interes||0)/100+a*Number(s.almacen||0)/100},money(s){return Number(s||0).toFixed(2)},date(s){return s?H(s).format("YYYY-MM-DD"):"—"},colorDias(s){return s>=8?"#e53935":s>=4?"#fb8c00":"#fdd835"},estadoColor(s){return s==="Pendiente"?"#fb8c00":s==="Pagado"?"#21ba45":s==="Cancelado"?"#e53935":s==="Vencido"?"#f4511e":"#9e9e9e"},telHref(s){const a=String(s||"").trim();return a?`tel:${a}`:null},waHref(s){const a=String(s.celular||"").replace(/\D/g,""),n=encodeURIComponent(`Hola ${s.cliente?.name||""}, le recordamos su préstamo ${s.numero}. Fecha límite: ${this.date(s.fecha_limite)}. Presenta ${s.dias_retraso} día(s) de retraso. Saldo: Bs. ${this.money(s.saldo)}.`);return a?`https://wa.me/${a}?text=${n}`:null}}},E={class:"col-12 col-md-4"},F={class:"col-6 col-md-3"},L={class:"col-6 col-md-3"},M={class:"col-12 col-md-2"},T={class:"row justify-end"},Y={class:"row q-col-gutter-sm"},K={class:"col-12 col-md-4"},j={class:"text-h6"},W={class:"col-12 col-md-4"},Z={class:"text-h6"},G={class:"col-12 col-md-4"},J={class:"text-h6"},O={class:"row q-col-gutter-sm"},X={class:"row items-center no-wrap"},$={class:"q-ml-sm"},ee={class:"text-weight-bold"},se={class:"text-caption text-grey-7"},te={class:"row items-center"},ae={class:"text-body2 ellipsis-2-lines"},oe={class:"row q-mt-sm"},le={class:"col-6"},re={class:"text-weight-medium"},ie={class:"col-6"},de={class:"text-weight-medium"},ne={class:"text-caption text-grey"},ce={class:"row q-mt-sm"},me={class:"col-6"},ue={class:"text-weight-medium"},_e={class:"col-6"},he={class:"row items-center"},ge={key:0,class:"col-12"},fe={key:0,class:"row justify-center q-mt-sm"};function pe(s,a,n,v,l,i){return m(),q(A,{class:"q-pa-sm bg-grey-2"},{default:r(()=>[t(u,{flat:"",bordered:""},{default:r(()=>[t(c,{class:"row items-end q-col-gutter-sm"},{default:r(()=>[e("div",E,[t(x,{dense:"",outlined:"",clearable:"",modelValue:l.filters.search,"onUpdate:modelValue":[a[0]||(a[0]=o=>l.filters.search=o),i.fetchData],label:"Buscar por Nº / cliente / detalle…",debounce:400},{append:r(()=>[t(_,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),e("div",F,[t(S,{dense:"",outlined:"",modelValue:l.filters.user_id,"onUpdate:modelValue":[a[1]||(a[1]=o=>l.filters.user_id=o),i.fetchData],options:l.usuarios,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Usuario"},null,8,["modelValue","options","onUpdate:modelValue"])]),e("div",L,[t(x,{dense:"",outlined:"",type:"number",min:"1",step:"1",modelValue:l.filters.dias,"onUpdate:modelValue":a[2]||(a[2]=o=>l.filters.dias=o),modelModifiers:{number:!0},label:"Mín. días de retraso",onKeyup:V(i.fetchData,["enter"])},null,8,["modelValue","onKeyup"])]),e("div",M,[e("div",T,[t(h,{color:"primary","no-caps":"",icon:"refresh",label:"Actualizar",loading:l.loading,onClick:i.fetchData},null,8,["loading","onClick"])])])]),_:1}),t(c,{class:"q-pt-none"},{default:r(()=>[e("div",Y,[e("div",K,[t(u,{bordered:"",class:"bg-orange-1"},{default:r(()=>[t(c,{class:"row items-center"},{default:r(()=>[t(_,{name:"schedule",color:"orange",size:"lg",class:"q-mr-sm"}),e("div",null,[a[4]||(a[4]=e("div",{class:"text-subtitle2 text-orange-9 text-weight-bold"},"Total retrasados",-1)),e("div",j,d(l.resumen.total),1)])]),_:1})]),_:1})]),e("div",W,[t(u,{bordered:"",class:"bg-red-1"},{default:r(()=>[t(c,{class:"row items-center"},{default:r(()=>[t(_,{name:"account_balance_wallet",color:"red",size:"lg",class:"q-mr-sm"}),e("div",null,[a[5]||(a[5]=e("div",{class:"text-subtitle2 text-red-9 text-weight-bold"},"Saldo pendiente",-1)),e("div",Z,d(i.money(l.resumen.saldo)),1)])]),_:1})]),_:1})]),e("div",G,[t(u,{bordered:"",class:"bg-blue-1"},{default:r(()=>[t(c,{class:"row items-center"},{default:r(()=>[t(_,{name:"bar_chart",color:"blue",size:"lg",class:"q-mr-sm"}),e("div",null,[a[6]||(a[6]=e("div",{class:"text-subtitle2 text-blue-9 text-weight-bold"},"Prom. días retraso",-1)),e("div",J,d(l.resumen.promDias),1)])]),_:1})]),_:1})])])]),_:1}),t(f),t(c,{class:"q-pt-sm"},{default:r(()=>[e("div",O,[(m(!0),g(C,null,D(l.prestamos,o=>(m(),g("div",{key:o.id,class:"col-12 col-md-4"},[t(u,{bordered:"",flat:"",class:"loan-card"},{default:r(()=>[e("div",{class:"status-strip",style:p({backgroundColor:i.colorDias(o.dias_retraso)})},null,4),t(c,{class:"q-pb-xs"},{default:r(()=>[e("div",X,[t(P,{icon:"warning",color:i.colorDias(o.dias_retraso),"text-color":"white",size:"32px"},null,8,["color"]),e("div",$,[e("div",ee,"#"+d(o.numero),1),e("div",se,"Límite: "+d(i.date(o.fecha_limite)),1)]),t(U),t(w,{dense:"",square:"","text-color":"white",style:p({backgroundColor:i.colorDias(o.dias_retraso)})},{default:r(()=>[b(d(o.dias_retraso)+" d. ",1)]),_:2},1032,["style"])])]),_:2},1024),t(f,{spaced:""}),t(c,{class:"q-pt-none"},{default:r(()=>[e("div",te,[t(_,{name:"person",size:"18px",class:"q-mr-xs"}),e("div",ae,d(o.cliente?.name||"N/A"),1)]),e("div",oe,[e("div",le,[a[7]||(a[7]=e("div",{class:"text-caption text-grey-7"},"Prestado",-1)),e("div",re,d(i.money(o.valor_prestado)),1)]),e("div",ie,[a[8]||(a[8]=e("div",{class:"text-caption text-grey-7"},"Cargos",-1)),e("div",de,d(i.money(i.cargos(o))),1),e("div",ne,d(o.interes)+"% + "+d(o.almacen)+"%",1)])]),e("div",ce,[e("div",me,[a[9]||(a[9]=e("div",{class:"text-caption text-grey-7"},"Saldo",-1)),e("div",ue,d(i.money(o.saldo)),1)]),e("div",_e,[a[10]||(a[10]=e("div",{class:"text-caption text-grey-7"},"Estado",-1)),t(w,{dense:"",square:"","text-color":"white",style:p({backgroundColor:i.estadoColor(o.estado)})},{default:r(()=>[b(d(o.estado),1)]),_:2},1032,["style"])])])]),_:2},1024),t(f),t(k,{align:"between",class:"q-pa-sm"},{default:r(()=>[e("div",he,[t(h,{dense:"",flat:"",icon:"call",href:i.telHref(o.celular),disable:!o.celular,title:"Llamar"},null,8,["href","disable"]),t(h,{dense:"",flat:"",icon:"whatsapp",href:i.waHref(o),target:"_blank",title:"WhatsApp"},null,8,["href"])]),t(h,{dense:"",flat:"",icon:"edit",label:"Editar / Pagar",onClick:be=>s.$router.push("/prestamos/editar/"+o.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),!l.prestamos.length&&!l.loading?(m(),g("div",ge,[t(z,{class:"bg-grey-2 text-grey-8"},{default:r(()=>a[11]||(a[11]=[b("No hay préstamos retrasados con los filtros aplicados.")])),_:1})])):y("",!0)]),l.totalPages>1?(m(),g("div",fe,[t(B,{modelValue:l.page,"onUpdate:modelValue":[a[3]||(a[3]=o=>l.page=o),i.fetchData],max:l.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])])):y("",!0)]),_:1}),t(R,{showing:l.loading},{default:r(()=>[t(N,{size:"32px"})]),_:1},8,["showing"])]),_:1})]),_:1})}const Ne=Q(I,[["render",pe],["__scopeId","data-v-853ef1dd"]]);export{Ne as default};
