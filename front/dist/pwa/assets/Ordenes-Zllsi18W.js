import{_ as C,c as y,o as u,w as n,a,Q as b,e as p,b as t,an as g,at as P,d as h,f as d,a2 as w,a3 as k,a4 as V,au as x,a0 as O,t as r,Z as f,am as q,av as Y}from"./index-DGeOX59m.js";import{Q as _}from"./QSelect-fwxrYMDz.js";import{Q}from"./QSpace-CuP5_SG6.js";import{Q as T}from"./format-Do-yKYTf.js";import{Q as E}from"./QPagination-D6NWSYg7.js";import{Q as U}from"./QPage-CVQ1eb0z.js";import{h as c}from"./moment-C5S46NFB.js";import"./QMenu-BEXXgG0_.js";import"./selection-Bkn73VAn.js";const D={name:"OrdenesPage",data(){return{ordenes:[],usuarios:[],estados:["Todos","Pendiente","Entregado","Cancelada"],filters:{fecha_inicio:c().startOf("week").format("YYYY-MM-DD"),fecha_fin:c().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos",search:""},resumen:{total:0,adelanto:0,saldo:0},loading:!1,pagination:{page:1,rowsPerPage:12,rowsNumber:0,lastPage:1},perPageOptions:[12,24,48,96,100]}},mounted(){this.getUsuarios(),this.getOrdenes()},methods:{resetToFirst(){this.pagination.page=1},pagarTodo(s){const e=Number(s.saldo||0);this.$q.dialog({title:"Confirmar Pago",html:!0,message:`¿Confirma registrar el pago total de <b style="color: red">${this.money(e)}</b> Bs para la orden #${s.numero}?`,cancel:!0,persistent:!0}).onOk(()=>{this.$axios.post(`/ordenes/${s.id}/pagar-todo`).then(()=>{this.$alert?.success("Pago registrado correctamente"),this.getOrdenes()}).catch(v=>{this.$alert?.error(v.response?.data?.message||"Error al registrar el pago")})})},imprimirOrden(s){const e=`${this.$axios.defaults.baseURL}/ordenes/${s}/pdf`;window.open(e,"_blank")},imprimirGarantia(s){const e=`${this.$axios.defaults.baseURL}/ordenes/${s}/garantia`;window.open(e,"_blank")},getUsuarios(){this.$axios.get("users").then(s=>{this.usuarios=[{id:null,name:"Todos"},...s.data]})},getOrdenes(){this.loading=!0,this.$axios.get("ordenes",{params:{...this.filters,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(s=>{const e=s.data;this.ordenes=e.data||[],this.pagination.page=e.current_page||1,this.pagination.rowsPerPage=e.per_page||this.pagination.rowsPerPage,this.pagination.rowsNumber=e.total||this.ordenes.length,this.pagination.lastPage=e.last_page||1,this.calcularResumen()}).catch(s=>{this.$alert?.error?.(s.response?.data?.message||"Error al obtener órdenes")}).finally(()=>{this.loading=!1})},onChangePerPage(){this.pagination.page=1,this.getOrdenes()},calcularResumen(){this.resumen.total=this.ordenes.filter(s=>s.estado!=="Cancelada").reduce((s,e)=>s+Number(e.costo_total||0),0),this.resumen.adelanto=this.ordenes.filter(s=>s.estado!=="Cancelada").reduce((s,e)=>s+Number(e.adelanto||0),0),this.resumen.saldo=this.ordenes.filter(s=>s.estado!=="Cancelada").reduce((s,e)=>s+Number(e.saldo||0),0)},getEstadoColor(s){switch(s){case"Pendiente":return"#fb8c00";case"Entregado":return"#21ba45";case"Cancelada":return"#e53935";default:return"#9e9e9e"}},getEstadoIcon(s){switch(s){case"Pendiente":return"hourglass_empty";case"Entregado":return"check_circle";case"Cancelada":return"cancel";default:return"work"}},money(s){return Number(s||0).toFixed(2)},formatDateTime(s){return s?s.length>10?c(s).format("YYYY-MM-DD HH:mm"):c(s,"YYYY-MM-DD").format("YYYY-MM-DD"):"—"}},watch:{"filters.fecha_inicio"(){this.resetToFirst(),this.getOrdenes()},"filters.fecha_fin"(){this.resetToFirst(),this.getOrdenes()},"filters.user_id"(){this.resetToFirst(),this.getOrdenes()},"filters.estado"(){this.resetToFirst(),this.getOrdenes()},"filters.search"(){this.resetToFirst(),this.getOrdenes()}}},N={class:"row q-col-gutter-sm"},F={class:"col-12 col-md-3"},M={class:"col-12 col-md-3"},I={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},S={class:"col-12 col-md-6"},z={class:"col-12 col-md-2 q-mt-sm"},A={class:"col-12 col-md-2 q-mt-sm"},R={class:"col-12 q-mt-sm"},K={class:"row q-col-gutter-sm"},L={class:"row items-center no-wrap"},j={class:"q-ml-sm"},G={class:"text-weight-bold"},H={class:"text-caption text-grey-7"},Z={class:"muted"},J={class:"row items-center"},W={class:"text-body2 ellipsis-2-lines"},X={class:"row q-mt-sm"},$={class:"col-4"},ee={class:"text-weight-medium"},se={class:"col-4"},te={class:"text-weight-medium"},oe={class:"col-4"},ae={class:"text-weight-medium"},ie={class:"row items-center q-mt-sm text-caption text-grey"},le={class:"col-12 q-mt-md"},re={class:"row items-center justify-between"},ne={class:"col-12 col-sm-6 q-mb-sm"},de={class:"row items-center"},ce={class:"q-ml-md text-caption"},me={class:"col-12 col-sm-6"},ue={class:"row justify-end"};function pe(s,e,v,ge,i,l){return u(),y(U,{class:"q-pa-xs"},{default:n(()=>[a(b,{flat:"",bordered:""},{default:n(()=>[a(p,null,{default:n(()=>[t("div",N,[t("div",F,[a(g,{label:"Fecha Inicio",type:"date",dense:"",outlined:"",modelValue:i.filters.fecha_inicio,"onUpdate:modelValue":e[0]||(e[0]=o=>i.filters.fecha_inicio=o)},null,8,["modelValue"])]),t("div",M,[a(g,{label:"Fecha Fin",type:"date",dense:"",outlined:"",modelValue:i.filters.fecha_fin,"onUpdate:modelValue":e[1]||(e[1]=o=>i.filters.fecha_fin=o)},null,8,["modelValue"])]),t("div",I,[a(_,{modelValue:i.filters.user_id,"onUpdate:modelValue":e[2]||(e[2]=o=>i.filters.user_id=o),options:i.usuarios,"option-label":"name","option-value":"id",label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",B,[a(_,{modelValue:i.filters.estado,"onUpdate:modelValue":e[3]||(e[3]=o=>i.filters.estado=o),options:i.estados,label:"Estado",dense:"",outlined:""},null,8,["modelValue","options"])]),t("div",S,[a(g,{modelValue:i.filters.search,"onUpdate:modelValue":e[4]||(e[4]=o=>i.filters.search=o),dense:"",outlined:"",placeholder:"Buscar por Nº orden, nombre o CI...",debounce:400,onKeyup:P(l.getOrdenes,["enter"])},{append:n(()=>[a(h,{name:"search"})]),_:1},8,["modelValue","onKeyup"])]),t("div",z,[a(d,{color:"primary",label:"Actualizar",icon:"refresh",onClick:l.getOrdenes,loading:i.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",A,[a(d,{color:"green",label:"Crear Orden",icon:"add",onClick:e[5]||(e[5]=o=>s.$router.push("/ordenes/crear")),"no-caps":""})]),t("div",R,[t("div",K,[(u(!0),w(k,null,V(i.ordenes,o=>(u(),w("div",{key:o.id,class:"col-12 col-md-4"},[a(b,{bordered:"",flat:"",class:"order-card"},{default:n(()=>[t("div",{class:"status-strip",style:x({backgroundColor:l.getEstadoColor(o.estado)})},null,4),a(p,{class:"q-pb-xs"},{default:n(()=>[t("div",L,[a(O,{icon:l.getEstadoIcon(o.estado),color:l.getEstadoColor(o.estado),"text-color":"white",size:"32px"},null,8,["icon","color"]),t("div",j,[t("div",G,"#"+r(o.numero),1),t("div",H,[f(r(o.fecha_creacion?.substring(0,10))+" ",1),e[8]||(e[8]=t("br",null,null,-1)),t("span",Z,"Creado: "+r(l.formatDateTime(o.fecha_creacion)),1)])]),a(Q),a(T,{dense:"",square:"","text-color":"white",style:x({backgroundColor:l.getEstadoColor(o.estado)})},{default:n(()=>[f(r(o.estado),1)]),_:2},1032,["style"])])]),_:2},1024),a(p,{class:"q-pt-none"},{default:n(()=>[t("div",J,[a(h,{name:"person",size:"18px",class:"q-mr-xs"}),t("div",W,r(o.cliente?.name||"N/A"),1)]),t("div",X,[t("div",$,[e[9]||(e[9]=t("div",{class:"text-caption text-grey-7"},"Total",-1)),t("div",ee,r(l.money(o.costo_total)),1)]),t("div",se,[e[10]||(e[10]=t("div",{class:"text-caption text-grey-7"},"Adelanto",-1)),t("div",te,r(parseInt(o.adelanto)+parseInt(o.totalPagos)),1)]),t("div",oe,[e[11]||(e[11]=t("div",{class:"text-caption text-grey-7"},"Saldo",-1)),t("div",ae,r(l.money(o.saldo)),1)])]),t("div",ie,[a(h,{name:"account_circle",size:"16px",class:"q-mr-xs"}),f(" "+r(o.user?.name||"—"),1)])]),_:2},1024),a(q),a(Y,{align:"between",class:"q-pa-sm"},{default:n(()=>[a(d,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:m=>s.$router.push("/ordenes/editar/"+o.id)},null,8,["onClick"]),t("div",null,[a(d,{dense:"",flat:"",icon:"payment",onClick:m=>l.pagarTodo(o)},null,8,["onClick"]),a(d,{dense:"",flat:"",icon:"print",onClick:m=>l.imprimirOrden(o.id)},null,8,["onClick"]),a(d,{dense:"",flat:"",icon:"assignment",onClick:m=>l.imprimirGarantia(o.id)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128))])]),t("div",le,[t("div",re,[t("div",ne,[t("div",de,[e[12]||(e[12]=t("div",{class:"q-mr-sm text-caption text-grey-7"},"Por página",-1)),a(_,{dense:"",outlined:"","emit-value":"","map-options":"",options:i.perPageOptions,modelValue:i.pagination.rowsPerPage,"onUpdate:modelValue":[e[6]||(e[6]=o=>i.pagination.rowsPerPage=o),l.onChangePerPage],style:{width:"110px"}},null,8,["options","modelValue","onUpdate:modelValue"]),t("div",ce," Mostrando "+r(i.ordenes.length)+" de "+r(i.pagination.rowsNumber)+" registros ",1)])]),t("div",me,[t("div",ue,[a(E,{modelValue:i.pagination.page,"onUpdate:modelValue":[e[7]||(e[7]=o=>i.pagination.page=o),l.getOrdenes],max:i.pagination.lastPage,"max-pages":7,"boundary-numbers":"","direction-links":"",size:"sm"},null,8,["modelValue","max","onUpdate:modelValue"])])])])])])]),_:1})]),_:1})]),_:1})}const Pe=C(D,[["render",pe],["__scopeId","data-v-9fdab3c3"]]);export{Pe as default};
