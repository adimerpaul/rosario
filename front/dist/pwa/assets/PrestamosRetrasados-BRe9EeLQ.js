import{_ as Q,c as V,o as m,w as r,a as t,Q as u,e as c,b as s,a6 as x,d as h,as as q,f as _,t as d,a7 as f,a2 as g,a1 as y,a3 as C,a4 as D,at as p,a0 as P,Z as v,au as k,a8 as N}from"./index-CnDS1-Ly.js";import{Q as S}from"./QSelect-qKi2fo6-.js";import{Q as I}from"./QSpace-BDcGsSHP.js";import{Q as w}from"./QChip-BylPwh6W.js";import{Q as U}from"./QBanner-D3UAvC41.js";import{Q as z}from"./QPagination-C1tALz2-.js";import{Q as B}from"./QInnerLoading-hxbIYG_2.js";import{Q as R}from"./QPage-Cjd_szRk.js";import{h as A}from"./moment-C5S46NFB.js";import"./format-DfceTm9F.js";import"./selection-BlMJwWLR.js";const E={name:"PrestamosRetrasados",data(){return{prestamos:[],usuarios:[{id:null,name:"Todos"}],filters:{search:"",user_id:null,dias:1},page:1,totalInvertido:0,perPage:24,totalPages:1,resumen:{total:0,saldo:0,promDias:0},loading:!1}},mounted(){this.getUsuarios(),this.fetchData()},methods:{async totalInvertidoGet(){try{const{data:e}=await this.$axios.get("totalInvertido");this.totalInvertido=e||0}catch(e){this.$alert?.error?.(e.response?.data?.message||"Error al obtener el total invertido")}},async getUsuarios(){try{const{data:e}=await this.$axios.get("users");this.usuarios=[{id:null,name:"Todos"},...e]}catch{}},async fetchData(){this.totalInvertidoGet(),this.loading=!0;try{const{data:e}=await this.$axios.get("prestamosRetrasados",{params:{...this.filters,page:this.page,per_page:this.perPage}});this.prestamos=e.data||e,this.totalPages=e.last_page||1,this.page=e.current_page||this.page,this.calcularResumen()}catch(e){this.$alert?.error?.(e.response?.data?.message||"Error al obtener préstamos retrasados")}finally{this.loading=!1}},calcularResumen(){const e=this.prestamos.length||1,a=(n,b)=>n.reduce((l,i)=>l+b(i),0);this.resumen.total=this.prestamos.length,this.resumen.saldo=a(this.prestamos,n=>Number(n.saldo||0)),this.resumen.promDias=(a(this.prestamos,n=>Number(n.dias_retraso||0))/e).toFixed(1)},cargos(e){const a=Number(e.valor_prestado||0);return a*Number(e.interes||0)/100+a*Number(e.almacen||0)/100},money(e){return Number(e||0).toFixed(2)},date(e){return e?A(e).format("YYYY-MM-DD"):"—"},colorDias(e){return e>=8?"#e53935":e>=4?"#fb8c00":"#fdd835"},estadoColor(e){return e==="Pendiente"?"#fb8c00":e==="Pagado"?"#21ba45":e==="Cancelado"?"#e53935":e==="Vencido"?"#f4511e":"#9e9e9e"},telHref(e){const a=String(e||"").trim();return a?`tel:${a}`:null},waHref(e){const a=String(e.celular||"").replace(/\D/g,""),n=encodeURIComponent(`Hola ${e.cliente?.name||""}, le recordamos su préstamo ${e.numero}. Fecha límite: ${this.date(e.fecha_limite)}. Presenta ${e.dias_retraso} día(s) de retraso. Saldo: Bs. ${this.money(e.saldo)}.`);return a?`https://wa.me/${a}?text=${n}`:null}}},H={class:"col-12 col-md-4"},F={class:"col-6 col-md-3"},L={class:"col-6 col-md-3"},M={class:"col-12 col-md-2"},T={class:"row justify-end"},Y={class:"row q-col-gutter-sm"},K={class:"col-12 col-md-4"},j={class:"text-h6"},G={class:"col-12 col-md-4"},W={class:"text-h6"},Z={class:"col-12 col-md-4"},J={class:"text-h6"},O={class:"row q-col-gutter-sm"},X={class:"row items-center no-wrap"},$={class:"q-ml-sm"},ee={class:"text-weight-bold"},se={class:"text-caption text-grey-7"},te={class:"row items-center"},ae={class:"text-body2 ellipsis-2-lines"},oe={class:"row q-mt-sm"},le={class:"col-6"},re={class:"text-weight-medium"},ie={class:"col-6"},de={class:"text-weight-medium"},ne={class:"text-caption text-grey"},ce={class:"row q-mt-sm"},me={class:"col-6"},ue={class:"text-weight-medium"},he={class:"col-6"},_e={class:"row items-center"},ge={key:0,class:"col-12"},fe={key:0,class:"row justify-center q-mt-sm"};function pe(e,a,n,b,l,i){return m(),V(R,{class:"q-pa-sm bg-grey-2"},{default:r(()=>[t(u,{flat:"",bordered:""},{default:r(()=>[t(c,{class:"row items-end q-col-gutter-sm"},{default:r(()=>[s("div",H,[t(x,{dense:"",outlined:"",clearable:"",modelValue:l.filters.search,"onUpdate:modelValue":[a[0]||(a[0]=o=>l.filters.search=o),i.fetchData],label:"Buscar por Nº / cliente / detalle…",debounce:400},{append:r(()=>[t(h,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),s("div",F,[t(S,{dense:"",outlined:"",modelValue:l.filters.user_id,"onUpdate:modelValue":[a[1]||(a[1]=o=>l.filters.user_id=o),i.fetchData],options:l.usuarios,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Usuario"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",L,[t(x,{dense:"",outlined:"",type:"number",min:"1",step:"1",modelValue:l.filters.dias,"onUpdate:modelValue":a[2]||(a[2]=o=>l.filters.dias=o),modelModifiers:{number:!0},label:"Mín. días de retraso",onKeyup:q(i.fetchData,["enter"])},null,8,["modelValue","onKeyup"])]),s("div",M,[s("div",T,[t(_,{color:"primary","no-caps":"",icon:"refresh",label:"Actualizar",loading:l.loading,onClick:i.fetchData},null,8,["loading","onClick"])])])]),_:1}),t(c,{class:"q-pt-none"},{default:r(()=>[s("div",Y,[s("div",K,[t(u,{bordered:"",class:"bg-orange-1"},{default:r(()=>[t(c,{class:"row items-center"},{default:r(()=>[t(h,{name:"schedule",color:"orange",size:"lg",class:"q-mr-sm"}),s("div",null,[a[4]||(a[4]=s("div",{class:"text-subtitle2 text-orange-9 text-weight-bold"},"Total invertido",-1)),s("div",j,d(l.totalInvertido),1)])]),_:1})]),_:1})]),s("div",G,[t(u,{bordered:"",class:"bg-red-1"},{default:r(()=>[t(c,{class:"row items-center"},{default:r(()=>[t(h,{name:"account_balance_wallet",color:"red",size:"lg",class:"q-mr-sm"}),s("div",null,[a[5]||(a[5]=s("div",{class:"text-subtitle2 text-red-9 text-weight-bold"},"Saldo pendiente",-1)),s("div",W,d(i.money(l.resumen.saldo)),1)])]),_:1})]),_:1})]),s("div",Z,[t(u,{bordered:"",class:"bg-blue-1"},{default:r(()=>[t(c,{class:"row items-center"},{default:r(()=>[t(h,{name:"bar_chart",color:"blue",size:"lg",class:"q-mr-sm"}),s("div",null,[a[6]||(a[6]=s("div",{class:"text-subtitle2 text-blue-9 text-weight-bold"},"Prom. días retraso",-1)),s("div",J,d(l.resumen.promDias),1)])]),_:1})]),_:1})])])]),_:1}),t(f),t(c,{class:"q-pt-sm"},{default:r(()=>[s("div",O,[(m(!0),g(C,null,D(l.prestamos,o=>(m(),g("div",{key:o.id,class:"col-12 col-md-4"},[t(u,{bordered:"",flat:"",class:"loan-card"},{default:r(()=>[s("div",{class:"status-strip",style:p({backgroundColor:i.colorDias(o.dias_retraso)})},null,4),t(c,{class:"q-pb-xs"},{default:r(()=>[s("div",X,[t(P,{icon:"warning",color:i.colorDias(o.dias_retraso),"text-color":"white",size:"32px"},null,8,["color"]),s("div",$,[s("div",ee,"#"+d(o.numero),1),s("div",se,"Límite: "+d(i.date(o.fecha_limite)),1)]),t(I),t(w,{dense:"",square:"","text-color":"white",style:p({backgroundColor:i.colorDias(o.dias_retraso)})},{default:r(()=>[v(d(o.dias_retraso)+" d. ",1)]),_:2},1032,["style"])])]),_:2},1024),t(f,{spaced:""}),t(c,{class:"q-pt-none"},{default:r(()=>[s("div",te,[t(h,{name:"person",size:"18px",class:"q-mr-xs"}),s("div",ae,d(o.cliente?.name||"N/A"),1)]),s("div",oe,[s("div",le,[a[7]||(a[7]=s("div",{class:"text-caption text-grey-7"},"Prestado",-1)),s("div",re,d(i.money(o.valor_prestado)),1)]),s("div",ie,[a[8]||(a[8]=s("div",{class:"text-caption text-grey-7"},"Cargos",-1)),s("div",de,d(i.money(i.cargos(o))),1),s("div",ne,d(o.interes)+"% + "+d(o.almacen)+"%",1)])]),s("div",ce,[s("div",me,[a[9]||(a[9]=s("div",{class:"text-caption text-grey-7"},"Saldo",-1)),s("div",ue,d(i.money(o.saldo)),1)]),s("div",he,[a[10]||(a[10]=s("div",{class:"text-caption text-grey-7"},"Estado",-1)),t(w,{dense:"",square:"","text-color":"white",style:p({backgroundColor:i.estadoColor(o.estado)})},{default:r(()=>[v(d(o.estado),1)]),_:2},1032,["style"])])])]),_:2},1024),t(f),t(k,{align:"between",class:"q-pa-sm"},{default:r(()=>[s("div",_e,[t(_,{dense:"",flat:"",icon:"call",href:i.telHref(o.celular),disable:!o.celular,title:"Llamar"},null,8,["href","disable"]),t(_,{dense:"",flat:"",icon:"whatsapp",href:i.waHref(o),target:"_blank",title:"WhatsApp"},null,8,["href"])]),t(_,{dense:"",flat:"",icon:"edit",label:"Editar / Pagar",onClick:ve=>e.$router.push("/prestamos/editar/"+o.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),!l.prestamos.length&&!l.loading?(m(),g("div",ge,[t(U,{class:"bg-grey-2 text-grey-8"},{default:r(()=>a[11]||(a[11]=[v("No hay préstamos retrasados con los filtros aplicados.")])),_:1})])):y("",!0)]),l.totalPages>1?(m(),g("div",fe,[t(z,{modelValue:l.page,"onUpdate:modelValue":[a[3]||(a[3]=o=>l.page=o),i.fetchData],max:l.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])])):y("",!0)]),_:1}),t(B,{showing:l.loading},{default:r(()=>[t(N,{size:"32px"})]),_:1},8,["showing"])]),_:1})]),_:1})}const Ne=Q(E,[["render",pe],["__scopeId","data-v-09445acb"]]);export{Ne as default};
