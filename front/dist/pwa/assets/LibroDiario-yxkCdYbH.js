import{j as W,av as Y,k as _,aw as H,l as q,f as m,ax as J,af as Z,_ as K,c as F,o as d,w as n,a as l,Q as k,e as x,b as t,a6 as C,a1 as p,a7 as v,t as a,a2 as u,Z as y,a3 as w,a4 as D,a8 as X,h as B,ay as A,au as R,W as Q}from"./index-DJlbbp9w.js";import{Q as j}from"./QSelect-DXOWypMk.js";import{Q as S}from"./QChip-B2YiD0bd.js";import{Q as O}from"./QMarkupTable-Eb1bhQh3.js";import{Q as $}from"./QInnerLoading-BBZuvZRU.js";import{Q as ee}from"./QBtnGroup-BPtez06a.js";import{Q as te}from"./QPage-DZyoZfy2.js";import{C as T}from"./ClosePopup-DVkE79cu.js";import{h as oe}from"./moment-C5S46NFB.js";import"./format-BSyrK4UF.js";import"./selection-BBy6q_jq.js";const N=W({name:"QBtnToggle",props:{...Y,modelValue:{required:!0},options:{type:Array,required:!0,validator:s=>s.every(e=>("label"in e||"icon"in e||"slot"in e)&&"value"in e)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(s,{slots:e,emit:b}){const U=_(()=>s.options.find(c=>c.value===s.modelValue)!==void 0),r=_(()=>({type:"hidden",name:s.name,value:s.modelValue})),i=J(r),o=_(()=>H(s)),V=_(()=>({rounded:s.rounded,dense:s.dense,...o.value})),M=_(()=>s.options.map((c,f)=>{const{attrs:I,value:E,slot:L,...g}=c;return{slot:L,props:{key:f,"aria-pressed":E===s.modelValue?"true":"false",...I,...g,...V.value,disable:s.disable===!0||g.disable===!0,color:E===s.modelValue?h(g,"toggleColor"):h(g,"color"),textColor:E===s.modelValue?h(g,"toggleTextColor"):h(g,"textColor"),noCaps:h(g,"noCaps")===!0,noWrap:h(g,"noWrap")===!0,size:h(g,"size"),padding:h(g,"padding"),ripple:h(g,"ripple"),stack:h(g,"stack")===!0,stretch:h(g,"stretch")===!0,onClick(P){z(E,c,P)}}}}));function z(c,f,I){s.readonly!==!0&&(s.modelValue===c?s.clearable===!0&&(b("update:modelValue",null,null),b("clear")):b("update:modelValue",c,f),b("click",I))}function h(c,f){return c[f]===void 0?s[f]:c[f]}function G(){const c=M.value.map(f=>q(m,f.props,f.slot!==void 0?e[f.slot]:void 0));return s.name!==void 0&&s.disable!==!0&&U.value===!0&&i(c,"push"),Z(e.default,c)}return()=>q(ee,{class:"q-btn-toggle",...o.value,rounded:s.rounded,stretch:s.stretch,glossy:s.glossy,spread:s.spread},G)}}),se={name:"LibroDiarioSimple",data(){return{fecha:oe().format("YYYY-MM-DD"),usuario:null,metodo:null,usuarios:[],openingAmount:0,items_ingresos:[],items_egresos:[],totalIngresos:0,totalEgresos:0,totalCaja:0,loading:!1,loadingSave:!1,dlgIngreso:!1,ingresoForm:{fecha:"",descripcion:"",metodo:"EFECTIVO",monto:null},dlgEgreso:!1,egresoForm:{fecha:"",descripcion:"",metodo:"EFECTIVO",monto:null},dlgDetalle:!1,detalleContext:{tipo:"ingresos",metodo:"EFECTIVO"}}},computed:{queryParams(){return{date:this.fecha,usuario:this.usuario||null,metodo_pago:this.metodo||null}},ingresosActivos(){return(this.items_ingresos||[]).filter(s=>(s.estado||"Activo")==="Activo")},egresosActivos(){return(this.items_egresos||[]).filter(s=>(s.estado||"Activo")==="Activo")},detalleFiltrado(){return((this.detalleContext.tipo==="ingresos"?this.items_ingresos:this.items_egresos)||[]).filter(e=>(e.estado||"Activo")==="Activo"&&(e.metodo||"EFECTIVO")===this.detalleContext.metodo)}},watch:{fecha(){this.fetchDiario()},usuario(){this.fetchDiario()},metodo(){this.fetchDiario()}},mounted(){this.ingresoForm.fecha=this.fecha,this.egresoForm.fecha=this.fecha,this.fetchUsuarios(),this.fetchDiario()},methods:{currency(s){return`${Number(s||0).toFixed(2)} Bs.`},fetchUsuarios(){this.$axios.get("users").then(({data:s})=>{this.usuarios=s||[]}).catch(()=>{this.usuarios=[]})},fetchDiario(){this.loading=!0,this.$axios.get("daily-cash",{params:this.queryParams}).then(({data:s})=>{const e=Number(s.daily_cash?.opening_amount||0),b=Number(s.suggested_opening_amount||0);this.openingAmount=e>0?e:b,this.items_ingresos=s.items_ingresos||[],this.items_egresos=s.items_egresos||[],this.totalIngresos=Number(s.total_ingresos||0),this.totalEgresos=Number(s.total_egresos||0),this.totalCaja=Number(s.total_caja||0),this.ingresoForm.fecha=this.fecha,this.egresoForm.fecha=this.fecha}).catch(s=>{this.$alert?.error?.(s.response?.data?.message||"Error al cargar el libro diario")}).finally(()=>{this.loading=!1})},openIngresoDialog(){this.ingresoForm={fecha:this.fecha,descripcion:"",metodo:"EFECTIVO",monto:null},this.dlgIngreso=!0},guardarIngreso(){this.loadingSave=!0,this.$axios.post("ingresos",this.ingresoForm).then(()=>{this.$alert?.success?.("Ingreso registrado"),this.dlgIngreso=!1,this.fetchDiario()}).catch(s=>{this.$alert?.error?.(s.response?.data?.message||"Error al registrar ingreso")}).finally(()=>{this.loadingSave=!1})},openEgresoDialog(){this.egresoForm={fecha:this.fecha,descripcion:"",metodo:"EFECTIVO",monto:null},this.dlgEgreso=!0},guardarEgreso(){this.loadingSave=!0,this.$axios.post("egresos",this.egresoForm).then(()=>{this.$alert?.success?.("Egreso registrado"),this.dlgEgreso=!1,this.fetchDiario()}).catch(s=>{this.$alert?.error?.(s.response?.data?.message||"Error al registrar egreso")}).finally(()=>{this.loadingSave=!1})},anularIngreso(s){this.$q.dialog({title:"Confirmar",message:"¿Seguro que deseas anular este ingreso?",cancel:!0,persistent:!0}).onOk(()=>{this.loading=!0,this.$axios.post(`ingresos/${s}/anular`).then(()=>{this.$alert?.success?.("Ingreso anulado"),this.fetchDiario()}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo anular")}).finally(()=>{this.loading=!1})})},anularEgreso(s){this.$q.dialog({title:"Confirmar",message:"¿Seguro que deseas anular este egreso?",cancel:!0,persistent:!0}).onOk(()=>{this.loading=!0,this.$axios.post(`egresos/${s}/anular`).then(()=>{this.$alert?.success?.("Egreso anulado"),this.fetchDiario()}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo anular")}).finally(()=>{this.loading=!1})})},openDetalle(s,e){this.detalleContext={tipo:s,metodo:e},this.dlgDetalle=!0}}},le={class:"col-12 col-md-2"},re={class:"col-12 col-md-2"},ie={class:"col-12 col-md-2"},ne={class:"col-12 col-md-6 flex items-center justify-end q-gutter-sm"},ae={class:"col-12 col-md-3"},de={class:"text-h6"},ue={class:"col-12 col-md-3 bg-green text-white"},ce={class:"text-h6"},ge={class:"col-12 col-md-3 bg-red text-white"},me={class:"text-h6"},he={class:"col-12 col-md-3 flex items-center justify-end"},fe={class:"row q-col-gutter-md"},pe={class:"col-12 col-md-6"},xe={class:"row items-center q-mb-xs"},ve={class:"col-auto text-weight-medium"},be={class:"bg-green-2"},ye={key:0,class:"text-right"},Ve={class:"text-right"},_e={class:"text-left"},Ce={key:0},Ee={class:"text-left"},Fe={class:"text-left"},ke={class:"text-right"},Ae={class:"text-left"},Ie={class:"text-left"},we={class:"text-left"},De={class:"text-left"},Be={key:0,class:"text-right"},Qe={key:0},Se=["colspan"],Oe={class:"col-12 col-md-6"},Te={class:"row items-center q-mb-xs"},Ue={class:"col-auto text-weight-medium"},qe={class:"bg-red-2"},Re={key:0,class:"text-right"},je={class:"text-left"},Ne={class:"text-left"},Me={class:"text-right"},ze={class:"text-left"},Ge={class:"text-left"},Le={class:"text-left"},Pe={class:"text-left"},We={key:0,class:"text-right"},Ye={key:0},He=["colspan"],Je={class:"row q-col-gutter-sm"},Ze={class:"col"},Ke={class:"col"},Xe={class:"row q-col-gutter-sm"},$e={class:"col"},et={class:"col"},tt={class:"col-12 col-md-6"},ot={class:"col-12 col-md-4"},st={class:"col-12 col-md-2 flex justify-end"},lt={class:"text-left"},rt={class:"text-right"},it={class:"text-left"},nt={class:"text-left"},at={class:"text-left"},dt={key:0};function ut(s,e,b,U,r,i){return d(),F(te,{class:"q-pa-sm bg-grey-2"},{default:n(()=>[l(k,{flat:"",bordered:""},{default:n(()=>[l(x,{class:"row items-center q-col-gutter-sm"},{default:n(()=>[t("div",le,[l(C,{type:"date",modelValue:r.fecha,"onUpdate:modelValue":e[0]||(e[0]=o=>r.fecha=o),label:"Fecha",dense:"",outlined:""},null,8,["modelValue"])]),t("div",re,[s.$store.user?.role==="Administrador"?(d(),F(j,{key:0,modelValue:r.usuario,"onUpdate:modelValue":e[1]||(e[1]=o=>r.usuario=o),options:r.usuarios.map(o=>o.username),label:"Usuario",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])):p("",!0)]),t("div",ie,[l(j,{modelValue:r.metodo,"onUpdate:modelValue":e[2]||(e[2]=o=>r.metodo=o),options:["EFECTIVO","QR"],label:"Método pago",dense:"",outlined:"",clearable:""},null,8,["modelValue"])]),t("div",ne,[l(m,{style:{width:"150px"},size:"12px",dense:"",color:"grey",icon:"refresh",label:"Actualizar","no-caps":"",loading:r.loading,onClick:i.fetchDiario},null,8,["loading","onClick"]),l(m,{style:{width:"170px"},size:"12px",dense:"",color:"positive",icon:"add_circle",label:"Registrar ingreso","no-caps":"",onClick:i.openIngresoDialog},null,8,["onClick"]),l(m,{style:{width:"170px"},size:"12px",dense:"",color:"negative",icon:"remove_circle",label:"Registrar egreso","no-caps":"",onClick:i.openEgresoDialog},null,8,["onClick"])])]),_:1}),l(v),l(x,{class:"row q-col-gutter-sm"},{default:n(()=>[t("div",ae,[e[17]||(e[17]=t("div",{class:"text-caption text-grey-7"},"TOTAL CAJA (neto)",-1)),t("div",de,a(i.currency(r.totalCaja)),1)]),t("div",ue,[e[18]||(e[18]=t("div",{class:"text-caption text-white"},"TOTAL INGRESOS (incluye caja)",-1)),t("div",ce,a(i.currency(r.totalIngresos)),1)]),t("div",ge,[e[19]||(e[19]=t("div",{class:"text-caption text-white"},"TOTAL EGRESOS",-1)),t("div",me,a(i.currency(r.totalEgresos)),1)]),t("div",he,[l(m,{dense:"",outline:"","no-caps":"",icon:"visibility",label:"Ver detalle",onClick:e[3]||(e[3]=o=>i.openDetalle("ingresos","EFECTIVO"))})])]),_:1}),l(v),l(x,null,{default:n(()=>[t("div",fe,[t("div",pe,[t("div",xe,[e[20]||(e[20]=t("div",{class:"col text-subtitle1 text-weight-bold"},"Ingresos",-1)),t("div",ve,a(i.currency(r.totalIngresos)),1)]),l(O,{flat:"",bordered:"",dense:""},{default:n(()=>[t("thead",null,[t("tr",be,[e[21]||(e[21]=t("th",{class:"text-left"},"Hora",-1)),e[22]||(e[22]=t("th",{class:"text-left"},"Descripción",-1)),e[23]||(e[23]=t("th",{class:"text-right"},"Monto (Bs.)",-1)),e[24]||(e[24]=t("th",{class:"text-left"},"Usuario",-1)),e[25]||(e[25]=t("th",{class:"text-left"},"Método",-1)),e[26]||(e[26]=t("th",{class:"text-left"},"Fuente",-1)),e[27]||(e[27]=t("th",{class:"text-left"},"Estado",-1)),s.$store.user?.role==="Administrador"?(d(),u("th",ye,"Acciones")):p("",!0)])]),t("tbody",null,[t("tr",null,[e[29]||(e[29]=t("td",{class:"text-left"},"—",-1)),e[30]||(e[30]=t("td",{class:"text-left"},"Caja inicial del día",-1)),t("td",Ve,a(i.currency(r.openingAmount)),1),e[31]||(e[31]=t("td",{class:"text-left"},"—",-1)),e[32]||(e[32]=t("td",{class:"text-left"},"—",-1)),e[33]||(e[33]=t("td",{class:"text-left"},"CAJA",-1)),t("td",_e,[l(S,{dense:"",color:"blue-6","text-color":"white"},{default:n(()=>e[28]||(e[28]=[y("Fijo")])),_:1})]),s.$store.user?.role==="Administrador"?(d(),u("td",Ce)):p("",!0)]),(d(!0),u(w,null,D(i.ingresosActivos,o=>(d(),u("tr",{key:`in-${o.key}`},[t("td",Ee,a(o.hora),1),t("td",Fe,a(o.descripcion),1),t("td",ke,a(i.currency(o.monto)),1),t("td",Ae,a(o.usuario),1),t("td",Ie,a(o.metodo||"—"),1),t("td",we,a(o.fuente),1),t("td",De,[l(S,{dense:"",color:o.estado==="Activo"?"green-6":"grey-6","text-color":"white"},{default:n(()=>[y(a(o.estado),1)]),_:2},1032,["color"])]),s.$store.user?.role==="Administrador"?(d(),u("td",Be,[o.fuente==="INGRESO"&&o.estado==="Activo"?(d(),F(m,{key:0,dense:"",flat:"",color:"negative",icon:"block",label:"Anular","no-caps":"",size:"10px",onClick:V=>i.anularIngreso(o.id)},null,8,["onClick"])):p("",!0)])):p("",!0)]))),128)),i.ingresosActivos.length?p("",!0):(d(),u("tr",Qe,[t("td",{colspan:s.$store.user?.role==="Administrador"?8:7,class:"text-center text-grey"}," Sin ingresos (solo caja inicial) ",8,Se)]))])]),_:1})]),t("div",Oe,[t("div",Te,[e[34]||(e[34]=t("div",{class:"col text-subtitle1 text-weight-bold"},"Egresos",-1)),t("div",Ue,a(i.currency(r.totalEgresos)),1)]),l(O,{flat:"",bordered:"",dense:""},{default:n(()=>[t("thead",null,[t("tr",qe,[e[35]||(e[35]=t("th",{class:"text-left"},"Hora",-1)),e[36]||(e[36]=t("th",{class:"text-left"},"Descripción",-1)),e[37]||(e[37]=t("th",{class:"text-right"},"Monto (Bs.)",-1)),e[38]||(e[38]=t("th",{class:"text-left"},"Usuario",-1)),e[39]||(e[39]=t("th",{class:"text-left"},"Método",-1)),e[40]||(e[40]=t("th",{class:"text-left"},"Fuente",-1)),e[41]||(e[41]=t("th",{class:"text-left"},"Estado",-1)),s.$store.user?.role==="Administrador"?(d(),u("th",Re,"Acciones")):p("",!0)])]),t("tbody",null,[(d(!0),u(w,null,D(i.egresosActivos,o=>(d(),u("tr",{key:`eg-${o.key}`},[t("td",je,a(o.hora),1),t("td",Ne,a(o.descripcion),1),t("td",Me,a(i.currency(o.monto)),1),t("td",ze,a(o.usuario),1),t("td",Ge,a(o.metodo||"EFECTIVO"),1),t("td",Le,a(o.fuente),1),t("td",Pe,[l(S,{dense:"",color:o.estado==="Activo"?"green-6":"grey-6","text-color":"white"},{default:n(()=>[y(a(o.estado),1)]),_:2},1032,["color"])]),s.$store.user?.role==="Administrador"?(d(),u("td",We,[o.fuente==="EGRESO"&&o.estado==="Activo"?(d(),F(m,{key:0,dense:"",flat:"",color:"negative",icon:"block",label:"Anular","no-caps":"",size:"10px",onClick:V=>i.anularEgreso(o.id)},null,8,["onClick"])):p("",!0)])):p("",!0)]))),128)),i.egresosActivos.length?p("",!0):(d(),u("tr",Ye,[t("td",{colspan:s.$store.user?.role==="Administrador"?8:7,class:"text-center text-grey"}," Sin egresos ",8,He)]))])]),_:1})])])]),_:1}),l($,{showing:r.loading},{default:n(()=>[l(X,{size:"32px"})]),_:1},8,["showing"])]),_:1}),l(B,{modelValue:r.dlgIngreso,"onUpdate:modelValue":e[8]||(e[8]=o=>r.dlgIngreso=o),persistent:""},{default:n(()=>[l(k,{style:{"min-width":"420px"}},{default:n(()=>[l(x,{class:"text-h6"},{default:n(()=>e[42]||(e[42]=[y("Registrar ingreso")])),_:1}),l(v),l(x,{class:"q-gutter-sm"},{default:n(()=>[l(C,{modelValue:r.ingresoForm.monto,"onUpdate:modelValue":e[4]||(e[4]=o=>r.ingresoForm.monto=o),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",label:"Monto (Bs.)",dense:"",outlined:""},null,8,["modelValue"]),l(C,{modelValue:r.ingresoForm.descripcion,"onUpdate:modelValue":e[5]||(e[5]=o=>r.ingresoForm.descripcion=o),label:"Descripción",dense:"",outlined:""},null,8,["modelValue"]),t("div",Je,[t("div",Ze,[l(A,{modelValue:r.ingresoForm.metodo,"onUpdate:modelValue":e[6]||(e[6]=o=>r.ingresoForm.metodo=o),val:"EFECTIVO",label:"EFECTIVO"},null,8,["modelValue"])]),t("div",Ke,[l(A,{modelValue:r.ingresoForm.metodo,"onUpdate:modelValue":e[7]||(e[7]=o=>r.ingresoForm.metodo=o),val:"QR",label:"QR"},null,8,["modelValue"])])])]),_:1}),l(v),l(R,{align:"right"},{default:n(()=>[Q(l(m,{flat:"",label:"Cancelar",color:"grey"},null,512),[[T]]),l(m,{color:"positive",icon:"save",label:"Guardar",loading:r.loadingSave,onClick:i.guardarIngreso},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:r.dlgEgreso,"onUpdate:modelValue":e[13]||(e[13]=o=>r.dlgEgreso=o),persistent:""},{default:n(()=>[l(k,{style:{"min-width":"420px"}},{default:n(()=>[l(x,{class:"text-h6"},{default:n(()=>e[43]||(e[43]=[y("Registrar egreso")])),_:1}),l(v),l(x,{class:"q-gutter-sm"},{default:n(()=>[l(C,{modelValue:r.egresoForm.monto,"onUpdate:modelValue":e[9]||(e[9]=o=>r.egresoForm.monto=o),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",label:"Monto (Bs.)",dense:"",outlined:""},null,8,["modelValue"]),l(C,{modelValue:r.egresoForm.descripcion,"onUpdate:modelValue":e[10]||(e[10]=o=>r.egresoForm.descripcion=o),label:"Descripción",dense:"",outlined:""},null,8,["modelValue"]),t("div",Xe,[t("div",$e,[l(A,{modelValue:r.egresoForm.metodo,"onUpdate:modelValue":e[11]||(e[11]=o=>r.egresoForm.metodo=o),val:"EFECTIVO",label:"EFECTIVO"},null,8,["modelValue"])]),t("div",et,[l(A,{modelValue:r.egresoForm.metodo,"onUpdate:modelValue":e[12]||(e[12]=o=>r.egresoForm.metodo=o),val:"QR",label:"QR"},null,8,["modelValue"])])])]),_:1}),l(v),l(R,{align:"right"},{default:n(()=>[Q(l(m,{flat:"",label:"Cancelar",color:"grey"},null,512),[[T]]),l(m,{color:"negative",icon:"save",label:"Guardar",loading:r.loadingSave,onClick:i.guardarEgreso},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:r.dlgDetalle,"onUpdate:modelValue":e[16]||(e[16]=o=>r.dlgDetalle=o)},{default:n(()=>[l(k,{style:{"min-width":"720px","max-width":"90vw"}},{default:n(()=>[l(x,{class:"row items-center q-col-gutter-sm"},{default:n(()=>[t("div",tt,[l(N,{modelValue:r.detalleContext.tipo,"onUpdate:modelValue":e[14]||(e[14]=o=>r.detalleContext.tipo=o),spread:"","no-caps":"","toggle-color":"primary",options:[{label:"Ingresos",value:"ingresos"},{label:"Egresos",value:"egresos"}]},null,8,["modelValue"])]),t("div",ot,[l(N,{modelValue:r.detalleContext.metodo,"onUpdate:modelValue":e[15]||(e[15]=o=>r.detalleContext.metodo=o),spread:"","no-caps":"","toggle-color":"primary",options:[{label:"EFECTIVO",value:"EFECTIVO"},{label:"QR",value:"QR"}]},null,8,["modelValue"])]),t("div",st,[Q(l(m,{flat:"",dense:"",icon:"close"},null,512),[[T]])])]),_:1}),l(v),l(x,null,{default:n(()=>[l(O,{flat:"",bordered:"",dense:""},{default:n(()=>[e[45]||(e[45]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Hora"),t("th",{class:"text-right"},"Monto (Bs.)"),t("th",{class:"text-left"},"Descripción"),t("th",{class:"text-left"},"Usuario"),t("th",{class:"text-left"},"Fuente")])],-1)),t("tbody",null,[(d(!0),u(w,null,D(i.detalleFiltrado,o=>(d(),u("tr",{key:`dt-${o.key}`},[t("td",lt,a(o.hora),1),t("td",rt,a(i.currency(o.monto)),1),t("td",it,a(o.descripcion),1),t("td",nt,a(o.usuario),1),t("td",at,a(o.fuente),1)]))),128)),i.detalleFiltrado.length?p("",!0):(d(),u("tr",dt,e[44]||(e[44]=[t("td",{colspan:"5",class:"text-center text-grey"},"Sin movimientos",-1)])))])]),_:1})]),_:1}),l(v),l(x,{class:"text-right text-weight-medium"},{default:n(()=>[y(" Total: "+a(i.currency(i.detalleFiltrado.reduce((o,V)=>o+Number(V.monto||0),0))),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const _t=K(se,[["render",ut]]);export{_t as default};
