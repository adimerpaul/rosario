import{_ as E,c as C,o as g,w as l,a as e,Q as c,e as i,b as s,an as v,ax as w,f as p,t as o,am as y,a2 as u,a1 as m,a3 as _,a4 as h,aq as Q}from"./index-DePMG0cy.js";import{Q as x}from"./QMarkupTable-DLD9t-2U.js";import{Q as T}from"./QInnerLoading-jie7dCwJ.js";import{Q as O}from"./QPage-Crx2SrYo.js";import{h as V}from"./moment-C5S46NFB.js";const I={name:"LibroDiario",data(){return{fecha:V().format("YYYY-MM-DD"),openingAmount:0,ingresos:{ordenes:{total:0,items:[]},pagos_ordenes:{total:0,items:[]},pagos_prestamos:{total:0,items:[]}},egresos:{prestamos:{total:0,items:[]}},totalesMetodo:{ingresos:{EFECTIVO:0,QR:0},egresos:{EFECTIVO:0,QR:0},neto:{EFECTIVO:0,QR:0}},totalIngresos:0,totalEgresos:0,totalCaja:0,loading:!1,loadingSave:!1}},mounted(){this.fetchDiario()},methods:{currency(n){return`${Number(n||0).toFixed(2)} Bs.`},sumMetodo(n,t){return(n||[]).reduce((b,f)=>b+(f.metodo===t?Number(f.monto||0):0),0)},async fetchDiario(){this.loading=!0;try{const{data:n}=await this.$axios.get("daily-cash",{params:{date:this.fecha}});this.openingAmount=Number(n.daily_cash?.opening_amount||0),this.ingresos={ordenes:n.ingresos?.ordenes||{total:0,items:[]},pagos_ordenes:n.ingresos?.pagos_ordenes||{total:0,items:[]},pagos_prestamos:n.ingresos?.pagos_prestamos||{total:0,items:[]}},this.egresos={prestamos:n.egresos?.prestamos||{total:0,items:[]}},this.totalIngresos=Number(n.total_ingresos||0),this.totalEgresos=Number(n.total_egresos||0),this.totalCaja=Number(n.total_caja||this.totalIngresos-this.totalEgresos);const t=n.totales_metodo||{};this.totalesMetodo={ingresos:{EFECTIVO:t.ingresos?.EFECTIVO||0,QR:t.ingresos?.QR||0},egresos:{EFECTIVO:t.egresos?.EFECTIVO||0,QR:t.egresos?.QR||0},neto:{EFECTIVO:t.neto?.EFECTIVO||0,QR:t.neto?.QR||0}}}catch(n){this.$alert?.error?.(n.response?.data?.message||"Error al cargar el libro diario")}finally{this.loading=!1}},async guardarCaja(){this.loadingSave=!0;try{await this.$axios.post("daily-cash",{date:this.fecha,opening_amount:Number(this.openingAmount||0)}),this.$alert?.success?.("Caja inicial guardada"),this.fetchDiario()}catch(n){this.$alert?.error?.(n.response?.data?.message||"Error al guardar caja")}finally{this.loadingSave=!1}}}},M={class:"col-12 col-md-3"},R={class:"col-12 col-md-3"},S={class:"col-12 col-md-3 flex items-center"},F={class:"col-12 col-md-3"},k={class:"text-h6"},A={class:"row q-col-gutter-sm"},q={class:"col-12 col-md-3"},j={class:"text-h6"},D={class:"col-12 col-md-3"},N={class:"text-h6"},B={class:"text-caption"},L={class:"col-12 col-md-3"},P={class:"text-h6"},U={class:"text-caption"},G={class:"col-12 col-md-3"},H={class:"text-h6"},Y={class:"text-caption"},K={class:"col-12 col-md-4 text-right text-h6"},z={class:"col-12 col-md-4 text-right text-h6"},J={class:"text-left"},W={class:"text-left"},X={class:"text-left"},Z={class:"text-right"},$={key:0},ss={class:"col-12 col-md-4 text-right text-h6"},ts={class:"text-left"},es={class:"text-left"},os={class:"text-left"},ls={class:"text-left"},rs={class:"text-right"},ds={key:0},as={class:"col-12 col-md-4 text-right text-h6"},is={class:"text-left"},ns={class:"text-left"},cs={class:"text-left"},gs={class:"text-left"},us={class:"text-left"},ms={class:"text-right"},_s={key:0},hs={class:"col-12 col-md-4 text-right text-h6"},xs={class:"text-left"},fs={class:"text-left"},bs={class:"text-left"},vs={class:"text-left"},ps={class:"text-right"},ys={key:0},Es={class:"row q-col-gutter-sm"},Cs={class:"col-12 col-md-3"},ws={class:"text-h6"},Qs={class:"col-12 col-md-3"},Ts={class:"text-h6"},Os={class:"col-12 col-md-3"},Vs={class:"text-h6"},Is={class:"row q-col-gutter-sm q-mt-sm"},Ms={class:"col-12 col-md-4"},Rs={class:"row q-mt-xs"},Ss={class:"col-6 text-right"},Fs={class:"row"},ks={class:"col-6 text-right"},As={class:"col-12 col-md-4"},qs={class:"row q-mt-xs"},js={class:"col-6 text-right"},Ds={class:"row"},Ns={class:"col-6 text-right"},Bs={class:"col-12 col-md-4"},Ls={class:"row q-mt-xs"},Ps={class:"col-6 text-right"},Us={class:"row"},Gs={class:"col-6 text-right"};function Hs(n,t,b,f,r,d){return g(),C(O,{class:"q-pa-sm bg-grey-2"},{default:l(()=>[e(c,{flat:"",bordered:""},{default:l(()=>[e(i,{class:"row items-center q-col-gutter-sm"},{default:l(()=>[s("div",M,[e(v,{type:"date",modelValue:r.fecha,"onUpdate:modelValue":[t[0]||(t[0]=a=>r.fecha=a),d.fetchDiario],label:"Fecha",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),s("div",R,[e(v,{modelValue:r.openingAmount,"onUpdate:modelValue":t[1]||(t[1]=a=>r.openingAmount=a),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",dense:"",outlined:"",label:"Caja inicial (Bs.)",onKeyup:w(d.guardarCaja,["enter"])},null,8,["modelValue","onKeyup"])]),s("div",S,[e(p,{color:"primary",icon:"save",label:"Guardar caja","no-caps":"",loading:r.loadingSave,onClick:d.guardarCaja},null,8,["loading","onClick"]),e(p,{color:"grey",flat:"",icon:"refresh",label:"Actualizar",class:"q-ml-sm","no-caps":"",loading:r.loading,onClick:d.fetchDiario},null,8,["loading","onClick"])]),s("div",F,[e(c,{bordered:"",class:"bg-blue-1"},{default:l(()=>[e(i,{class:"q-pa-sm"},{default:l(()=>[t[2]||(t[2]=s("div",{class:"text-weight-bold text-blue"},"TOTAL CAJA (neto)",-1)),s("div",k,o(d.currency(r.totalCaja)),1),t[3]||(t[3]=s("div",{class:"text-caption"},"= Caja + Ingresos – Egresos",-1))]),_:1})]),_:1})])]),_:1}),e(y),e(i,null,{default:l(()=>[s("div",A,[s("div",q,[e(c,{bordered:"",class:"bg-green-1"},{default:l(()=>[e(i,null,{default:l(()=>[t[4]||(t[4]=s("div",{class:"text-weight-bold text-green-10"},"ÓRDENES (adelantos)",-1)),s("div",j,o(d.currency(r.ingresos.ordenes.total)),1)]),_:1})]),_:1})]),s("div",D,[e(c,{bordered:"",class:"bg-green-2"},{default:l(()=>[e(i,null,{default:l(()=>[t[5]||(t[5]=s("div",{class:"text-weight-bold text-green-10"},"PAGOS ÓRDENES",-1)),s("div",N,o(d.currency(r.ingresos.pagos_ordenes.total)),1),s("div",B," Efec: "+o(d.currency(d.sumMetodo(r.ingresos.pagos_ordenes.items,"EFECTIVO")))+" · QR: "+o(d.currency(d.sumMetodo(r.ingresos.pagos_ordenes.items,"QR"))),1)]),_:1})]),_:1})]),s("div",L,[e(c,{bordered:"",class:"bg-teal-1"},{default:l(()=>[e(i,null,{default:l(()=>[t[6]||(t[6]=s("div",{class:"text-weight-bold text-teal-10"},"PAGOS PRÉSTAMOS",-1)),s("div",P,o(d.currency(r.ingresos.pagos_prestamos.total)),1),s("div",U," Efec: "+o(d.currency(d.sumMetodo(r.ingresos.pagos_prestamos.items,"EFECTIVO")))+" · QR: "+o(d.currency(d.sumMetodo(r.ingresos.pagos_prestamos.items,"QR"))),1)]),_:1})]),_:1})]),s("div",G,[e(c,{bordered:"",class:"bg-red-1"},{default:l(()=>[e(i,null,{default:l(()=>[t[7]||(t[7]=s("div",{class:"text-weight-bold text-red-10"},"EGRESOS (préstamos otorgados)",-1)),s("div",H,o(d.currency(r.egresos.prestamos.total)),1),s("div",Y," Efec: "+o(d.currency(d.sumMetodo(r.egresos.prestamos.items,"EFECTIVO")))+" · QR: "+o(d.currency(d.sumMetodo(r.egresos.prestamos.items,"QR"))),1)]),_:1})]),_:1})])])]),_:1}),e(y),e(i,null,{default:l(()=>[e(c,{bordered:"",class:"q-mb-sm"},{default:l(()=>[e(i,{class:"row items-center"},{default:l(()=>[t[8]||(t[8]=s("div",{class:"col-12 col-md-8 text-weight-bold"},"Caja inicial del día",-1)),s("div",K,o(d.currency(r.openingAmount)),1)]),_:1})]),_:1}),e(c,{bordered:"",class:"q-mb-md"},{default:l(()=>[e(i,{class:"row items-center"},{default:l(()=>[t[9]||(t[9]=s("div",{class:"col-12 col-md-8 text-weight-bold"},"Órdenes de Trabajo (adelantos)",-1)),s("div",z,o(d.currency(r.ingresos.ordenes.total)),1)]),_:1}),e(x,{flat:"",bordered:"",dense:""},{default:l(()=>[t[11]||(t[11]=s("thead",null,[s("tr",{class:"bg-green-6 text-white"},[s("th",{class:"text-left"},"Hora"),s("th",{class:"text-left"},"Descripción"),s("th",{class:"text-left"},"Usuario"),s("th",{class:"text-right"},"Monto (Bs.)")])],-1)),s("tbody",null,[(g(!0),u(_,null,h(r.ingresos.ordenes.items,a=>(g(),u("tr",{key:`o-${a.id}`},[s("td",J,o(a.hora),1),s("td",W,o(a.descripcion),1),s("td",X,o(a.usuario),1),s("td",Z,o(d.currency(a.monto)),1)]))),128)),r.ingresos.ordenes.items.length?m("",!0):(g(),u("tr",$,t[10]||(t[10]=[s("td",{colspan:"4",class:"text-center text-grey"},"Sin ingresos por órdenes",-1)])))])]),_:1})]),_:1}),e(c,{bordered:"",class:"q-mb-md"},{default:l(()=>[e(i,{class:"row items-center"},{default:l(()=>[t[12]||(t[12]=s("div",{class:"col-12 col-md-8 text-weight-bold"},"Pagos de Órdenes",-1)),s("div",ss,o(d.currency(r.ingresos.pagos_ordenes.total)),1)]),_:1}),e(x,{flat:"",bordered:"",dense:""},{default:l(()=>[t[14]||(t[14]=s("thead",null,[s("tr",{class:"bg-green-3 text-black"},[s("th",{class:"text-left"},"Hora"),s("th",{class:"text-left"},"Descripción"),s("th",{class:"text-left"},"Usuario"),s("th",{class:"text-left"},"Método"),s("th",{class:"text-right"},"Monto (Bs.)")])],-1)),s("tbody",null,[(g(!0),u(_,null,h(r.ingresos.pagos_ordenes.items,a=>(g(),u("tr",{key:`po-${a.id}`},[s("td",ts,o(a.hora),1),s("td",es,o(a.descripcion),1),s("td",os,o(a.usuario),1),s("td",ls,o(a.metodo||"—"),1),s("td",rs,o(d.currency(a.monto)),1)]))),128)),r.ingresos.pagos_ordenes.items.length?m("",!0):(g(),u("tr",ds,t[13]||(t[13]=[s("td",{colspan:"5",class:"text-center text-grey"},"Sin pagos registrados",-1)])))])]),_:1})]),_:1}),e(c,{bordered:"",class:"q-mb-md"},{default:l(()=>[e(i,{class:"row items-center"},{default:l(()=>[t[15]||(t[15]=s("div",{class:"col-12 col-md-8 text-weight-bold"},"Pagos de Préstamos",-1)),s("div",as,o(d.currency(r.ingresos.pagos_prestamos.total)),1)]),_:1}),e(x,{flat:"",bordered:"",dense:""},{default:l(()=>[t[17]||(t[17]=s("thead",null,[s("tr",{class:"bg-teal-3 text-black"},[s("th",{class:"text-left"},"Hora"),s("th",{class:"text-left"},"Descripción"),s("th",{class:"text-left"},"Usuario"),s("th",{class:"text-left"},"Método"),s("th",{class:"text-left"},"Tipo"),s("th",{class:"text-right"},"Monto (Bs.)")])],-1)),s("tbody",null,[(g(!0),u(_,null,h(r.ingresos.pagos_prestamos.items,a=>(g(),u("tr",{key:`pp-${a.id}`},[s("td",is,o(a.hora),1),s("td",ns,o(a.descripcion),1),s("td",cs,o(a.usuario),1),s("td",gs,o(a.metodo||"—"),1),s("td",us,o(a.tipo_pago||"—"),1),s("td",ms,o(d.currency(a.monto)),1)]))),128)),r.ingresos.pagos_prestamos.items.length?m("",!0):(g(),u("tr",_s,t[16]||(t[16]=[s("td",{colspan:"6",class:"text-center text-grey"},"Sin pagos de préstamos",-1)])))])]),_:1})]),_:1}),e(c,{bordered:"",class:"q-mb-md"},{default:l(()=>[e(i,{class:"row items-center"},{default:l(()=>[t[18]||(t[18]=s("div",{class:"col-12 col-md-8 text-weight-bold"},"Egresos — Préstamos Otorgados",-1)),s("div",hs,o(d.currency(r.egresos.prestamos.total)),1)]),_:1}),e(x,{flat:"",bordered:"",dense:""},{default:l(()=>[t[20]||(t[20]=s("thead",null,[s("tr",{class:"bg-red-3 text-black"},[s("th",{class:"text-left"},"Hora"),s("th",{class:"text-left"},"Descripción"),s("th",{class:"text-left"},"Usuario"),s("th",{class:"text-left"},"Método"),s("th",{class:"text-right"},"Monto (Bs.)")])],-1)),s("tbody",null,[(g(!0),u(_,null,h(r.egresos.prestamos.items,a=>(g(),u("tr",{key:`eg-${a.id}`},[s("td",xs,o(a.hora),1),s("td",fs,o(a.descripcion),1),s("td",bs,o(a.usuario),1),s("td",vs,o(a.metodo||"EFECTIVO"),1),s("td",ps,o(d.currency(a.monto)),1)]))),128)),r.egresos.prestamos.items.length?m("",!0):(g(),u("tr",ys,t[19]||(t[19]=[s("td",{colspan:"5",class:"text-center text-grey"},"Sin egresos de préstamos",-1)])))])]),_:1})]),_:1}),s("div",Es,[s("div",Cs,[e(c,{bordered:"",class:"bg-green-1"},{default:l(()=>[e(i,null,{default:l(()=>[t[21]||(t[21]=s("div",{class:"text-weight-bold text-green-10"},"TOTAL INGRESOS (con caja)",-1)),s("div",ws,o(d.currency(r.totalIngresos)),1)]),_:1})]),_:1})]),s("div",Qs,[e(c,{bordered:"",class:"bg-red-1"},{default:l(()=>[e(i,null,{default:l(()=>[t[22]||(t[22]=s("div",{class:"text-weight-bold text-red-10"},"TOTAL EGRESOS",-1)),s("div",Ts,o(d.currency(r.totalEgresos)),1)]),_:1})]),_:1})]),s("div",Os,[e(c,{bordered:"",class:"bg-blue-1"},{default:l(()=>[e(i,null,{default:l(()=>[t[23]||(t[23]=s("div",{class:"text-weight-bold text-blue-10"},"TOTAL CAJA (neto)",-1)),s("div",Vs,o(d.currency(r.totalCaja)),1)]),_:1})]),_:1})])]),s("div",Is,[s("div",Ms,[e(c,{bordered:""},{default:l(()=>[e(i,null,{default:l(()=>[t[26]||(t[26]=s("div",{class:"text-weight-bold"},"Ingresos por método",-1)),s("div",Rs,[t[24]||(t[24]=s("div",{class:"col-6"},"EFECTIVO",-1)),s("div",Ss,o(d.currency(r.totalesMetodo.ingresos.EFECTIVO)),1)]),s("div",Fs,[t[25]||(t[25]=s("div",{class:"col-6"},"QR",-1)),s("div",ks,o(d.currency(r.totalesMetodo.ingresos.QR)),1)])]),_:1})]),_:1})]),s("div",As,[e(c,{bordered:""},{default:l(()=>[e(i,null,{default:l(()=>[t[29]||(t[29]=s("div",{class:"text-weight-bold"},"Egresos por método",-1)),s("div",qs,[t[27]||(t[27]=s("div",{class:"col-6"},"EFECTIVO",-1)),s("div",js,o(d.currency(r.totalesMetodo.egresos.EFECTIVO)),1)]),s("div",Ds,[t[28]||(t[28]=s("div",{class:"col-6"},"QR",-1)),s("div",Ns,o(d.currency(r.totalesMetodo.egresos.QR)),1)])]),_:1})]),_:1})]),s("div",Bs,[e(c,{bordered:""},{default:l(()=>[e(i,null,{default:l(()=>[t[32]||(t[32]=s("div",{class:"text-weight-bold"},"Neto por método",-1)),s("div",Ls,[t[30]||(t[30]=s("div",{class:"col-6"},"EFECTIVO",-1)),s("div",Ps,o(d.currency(r.totalesMetodo.neto.EFECTIVO)),1)]),s("div",Us,[t[31]||(t[31]=s("div",{class:"col-6"},"QR",-1)),s("div",Gs,o(d.currency(r.totalesMetodo.neto.QR)),1)])]),_:1})]),_:1})])])]),_:1}),e(T,{showing:r.loading},{default:l(()=>[e(Q,{size:"32px"})]),_:1},8,["showing"])]),_:1})]),_:1})}const Xs=E(I,[["render",Hs]]);export{Xs as default};
