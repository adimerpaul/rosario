import{_ as v,c as f,o as p,w as a,a as s,Q as b,e as g,b as t,Z as d,an as c,d as k,f as u,a1 as _,t as r,a2 as V,a3 as y,a4 as w,a5 as Q,as as U,ak as B}from"./index-DGeOX59m.js";import{Q as C}from"./format-Do-yKYTf.js";import{Q as x}from"./QBanner-DqWWW59E.js";import{Q as S}from"./QPagination-D6NWSYg7.js";import{Q as q}from"./QMarkupTable-DODD5QwI.js";import{Q as K}from"./QForm-DPSoRKrr.js";import{Q as O}from"./QPage-CVQ1eb0z.js";import{h as P}from"./moment-C5S46NFB.js";const N={name:"OrdenCrearPage",data(){return{page:1,totalPages:1,check18Kilates:!0,orden:{numero:"",fecha_entrega:P().add(1,"weeks").format("YYYY-MM-DD"),detalle:"18 Kilates",celular:"",costo_total:0,adelanto:0,saldo:0,estado:"Pendiente",peso:0,nota:"",cliente_id:null,cliente:null},estados:["Pendiente","Entregado","Cancelada"],clientes:[],clienteFiltro:"",loading:!1,precioOro:{value:0},costoBase:0,reconocimiento:null,reconocimientoCampo:!1}},async mounted(){this.getClientes();const n=await this.$axios.get("cogs/2");this.precioOro=n.data;const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.reconocimiento=new e,this.reconocimiento.lang="es-BO",this.reconocimiento.interimResults=!1,this.reconocimiento.continuous=!1,this.reconocimiento.onresult=h=>{const m=h.results[0][0].transcript;this.reconocimientoCampo==="detalle"?this.orden.detalle=this.orden.detalle?this.orden.detalle+" "+m:m:this.reconocimientoCampo==="nota"&&(this.orden.nota=this.orden.nota?this.orden.nota+" "+m:m)},this.reconocimiento.onerror=h=>{console.error("Error de reconocimiento:",h.error)}):console.warn("Speech Recognition no está soportado en este navegador")},methods:{coloca18Kilates(){this.check18Kilates?this.orden.detalle=this.orden.detalle?this.orden.detalle+" | 18 Kilates":"18 Kilates":this.orden.detalle=this.orden.detalle.replace(" | 18 Kilates","").replace("18 Kilates","").trim()},iniciarReconocimiento(n){if(!this.reconocimiento){this.$alert.warning("Reconocimiento de voz no soportado en este navegador");return}this.reconocimientoCampo=n,this.reconocimiento.start()},getClientes(){this.loading=!0,this.$axios.get("clients",{params:{search:this.clienteFiltro,page:this.page,per_page:3}}).then(n=>{this.clientes=n.data.data,this.totalPages=n.data.last_page}).catch(n=>{this.$alert.error(n.response?.data?.message||"Error al cargar los clientes")}).finally(()=>{this.loading=!1})},calcularSaldo(){this.orden.saldo=(this.orden.costo_total||0)-(this.orden.adelanto||0)},validarCostoTotal(n){const e=this.costoBase-20;n<e&&(this.$alert.warning(`El costo total solo puede modificarse ±20 Bs del valor calculado (${this.costoBase.toFixed(2)} Bs)`),this.orden.costo_total=this.costoBase),this.calcularSaldo()},calcularTotal(){const n=(this.orden.peso||0)*(this.precioOro.value||0);this.costoBase=n,this.orden.costo_total=n,this.calcularSaldo()},seleccionarCliente(n){this.orden.cliente=n,this.orden.cliente_id=n.id,this.orden.celular=n.cellphone||""},guardarOrden(){if(!this.orden.cliente_id){this.$alert.error("Debe seleccionar un cliente");return}this.loading=!0,this.$axios.post("ordenes",{...this.orden,user_id:this.$store.user.id}).then(n=>{this.$alert.success("Orden creada con éxito"),this.$router.push("/ordenes")}).catch(n=>{this.$alert.error(n.response?.data?.message||"Error al guardar la orden")}).finally(()=>{this.loading=!1})}}},z={class:"row"},E={class:"col-12 col-md-5"},R={class:"row"},F={class:"col-12 col-md-8"},M={class:"col-12 col-md-2 text-right"},T={class:"col-12 q-mt-sm"},D={class:"flex flex-center"},I={style:{"white-space":"normal","max-width":"120px","word-break":"break-word","font-size":"12px","line-height":"0.9"}},Y={class:"col-12 col-md-7"},A={class:"text-grey text-caption"},G={class:"row q-col-gutter-sm"},L={class:"col-12 col-md-3"},Z={class:"col-12 col-md-3"},j={class:"col-12 col-md-3"},H={class:"col-6 col-md-3"},J={class:"col-6 col-md-3"},W={class:"col-12 col-md-4"},X={class:"col-12 col-md-3"},$={class:"col-12 col-md-6"},ee={class:"col-12 col-md-6"},oe={class:"col-12 q-mt-sm"},le={class:"q-mt-md text-right"};function te(n,e,h,m,o,i){return p(),f(O,{class:"q-pa-xs"},{default:a(()=>[s(b,{flat:"",bordered:""},{default:a(()=>[s(g,{class:"q-pa-xs"},{default:a(()=>[t("div",z,[t("div",E,[s(b,{flat:"",bordered:""},{default:a(()=>[s(g,{class:"text-bold q-pa-xs"},{default:a(()=>e[14]||(e[14]=[d("Seleccionar Cliente")])),_:1}),t("div",R,[t("div",F,[s(c,{dense:"",outlined:"",debounce:"300",modelValue:o.clienteFiltro,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.clienteFiltro=l),i.getClientes],placeholder:"Buscar cliente...",class:"q-mb-sm",clearable:""},{append:a(()=>[s(k,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),t("div",M,[s(u,{label:"Buscar",color:"primary",class:"q-mb-sm",onClick:i.getClientes,icon:"search",loading:o.loading,"no-caps":"",dense:"",size:"10px"},null,8,["onClick","loading"])])]),t("div",T,[o.orden.cliente?(p(),f(x,{key:0,class:"bg-grey-2"},{default:a(()=>[e[15]||(e[15]=d(" Cliente seleccionado: ")),t("b",null,r(o.orden.cliente.name),1),d(" (CI: "+r(o.orden.cliente.ci)+") ",1),s(C,{color:o.orden.cliente.status==="Confiable"?"green":o.orden.cliente.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[d(r(o.orden.cliente.status),1)]),_:1},8,["color"])]),_:1})):_("",!0)]),t("div",D,[s(S,{size:"10px",modelValue:o.page,"onUpdate:modelValue":[e[1]||(e[1]=l=>o.page=l),i.getClientes],max:o.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])]),s(q,{flat:"",bordered:"",dense:""},{default:a(()=>[e[16]||(e[16]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Nombre"),t("th",null,"CI"),t("th",null,"Estado"),t("th",null,"Acción")])],-1)),t("tbody",null,[(p(!0),V(y,null,w(o.clientes,(l,se)=>(p(),V("tr",{key:l.id,class:Q({"bg-blue-2":o.orden.cliente_id===l.id})},[t("td",I,r(l.name),1),t("td",null,r(l.ci),1),t("td",null,[s(C,{color:l.status==="Confiable"?"green":l.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[d(r(l.status),1)]),_:2},1032,["color"])]),t("td",null,[s(u,{label:"Seleccionar",color:"primary",dense:"",onClick:ne=>i.seleccionarCliente(l),icon:"check",size:"10px","no-caps":""},null,8,["onClick"])])],2))),128))])]),_:1})]),_:1})]),t("div",Y,[s(b,{flat:"",bordered:""},{default:a(()=>[s(g,{class:"text-bold q-pa-xs"},{default:a(()=>[e[17]||(e[17]=d(" Crear Nueva Orden ")),t("span",A," (Precio oro: "+r(o.precioOro.value)+") ",1)]),_:1}),s(g,{class:"q-pa-xs"},{default:a(()=>[s(K,{onSubmit:U(i.guardarOrden,["prevent"])},{default:a(()=>[t("div",G,[t("div",L,[s(c,{label:"Fecha de Entrega",type:"date",modelValue:o.orden.fecha_entrega,"onUpdate:modelValue":e[2]||(e[2]=l=>o.orden.fecha_entrega=l),outlined:"",dense:""},null,8,["modelValue"])]),t("div",Z,[s(c,{label:"Celular",modelValue:o.orden.celular,"onUpdate:modelValue":e[3]||(e[3]=l=>o.orden.celular=l),outlined:"",dense:""},null,8,["modelValue"])]),t("div",j,[s(c,{label:"Peso (kg)",modelValue:o.orden.peso,"onUpdate:modelValue":[e[4]||(e[4]=l=>o.orden.peso=l),i.calcularTotal],modelModifiers:{number:!0},type:"number",outlined:"",dense:"",min:"0",step:"0.01",rules:[l=>l>=0||"El peso debe ser positivo"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),t("div",H,[s(c,{label:"Costo Total",modelValue:o.orden.costo_total,"onUpdate:modelValue":[e[5]||(e[5]=l=>o.orden.costo_total=l),i.validarCostoTotal],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",J,[s(c,{label:"Adelanto",modelValue:o.orden.adelanto,"onUpdate:modelValue":[e[6]||(e[6]=l=>o.orden.adelanto=l),i.calcularSaldo],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",W,[s(c,{label:"Saldo",modelValue:o.orden.saldo,"onUpdate:modelValue":e[7]||(e[7]=l=>o.orden.saldo=l),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),t("div",X,[s(B,{modelValue:o.check18Kilates,"onUpdate:modelValue":[e[8]||(e[8]=l=>o.check18Kilates=l),i.coloca18Kilates],label:"18 Kilates",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",$,[s(c,{label:"Detalle",modelValue:o.orden.detalle,"onUpdate:modelValue":e[10]||(e[10]=l=>o.orden.detalle=l),type:"textarea",outlined:"",dense:""},{append:a(()=>[s(u,{icon:"mic",onClick:e[9]||(e[9]=l=>i.iniciarReconocimiento("detalle")),flat:"",dense:""})]),_:1},8,["modelValue"])]),t("div",ee,[s(c,{label:"Nota",modelValue:o.orden.nota,"onUpdate:modelValue":e[12]||(e[12]=l=>o.orden.nota=l),type:"textarea",outlined:"",dense:""},{append:a(()=>[s(u,{icon:"mic",onClick:e[11]||(e[11]=l=>i.iniciarReconocimiento("nota")),flat:"",dense:""})]),_:1},8,["modelValue"])]),e[19]||(e[19]=t("div",{class:"col-12"},null,-1)),t("div",oe,[o.orden.cliente?(p(),f(x,{key:0,class:"bg-grey-2"},{default:a(()=>[e[18]||(e[18]=d(" Cliente seleccionado: ")),t("b",null,r(o.orden.cliente.name),1),d(" (CI: "+r(o.orden.cliente.ci)+") ",1),s(C,{color:o.orden.cliente.status==="Confiable"?"green":o.orden.cliente.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[d(r(o.orden.cliente.status),1)]),_:1},8,["color"])]),_:1})):_("",!0)])]),t("div",le,[s(u,{label:"Cancelar",type:"button",color:"negative",onClick:e[13]||(e[13]=l=>n.$router.push("/ordenes")),class:"q-mr-sm",loading:o.loading},null,8,["loading"]),s(u,{label:"Guardar",type:"submit",color:"green",loading:o.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})}const he=v(N,[["render",te]]);export{he as default};
