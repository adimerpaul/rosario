import{_ as w,c as C,o as n,w as d,a as l,Q as b,e as c,b as t,an as m,d as u,f as p,a2 as g,a1 as Q,a3 as k,a4 as q,ay as x,a0 as U,t as i,Z as V,am as P,az as N}from"./index-DF8yCw7g.js";import{Q as h}from"./QSelect-DSC_Q8Vw.js";import{Q as F}from"./QSpace-Ch6WXqp3.js";import{Q as I}from"./format-DrCijr_x.js";import{Q as A}from"./QPagination-BHy9S2cW.js";import{Q as E}from"./QPage-DIPGfeq1.js";import{h as y}from"./moment-C5S46NFB.js";import"./QMenu-CimfnVpa.js";import"./selection-BKxO1Gtz.js";const S={name:"PrestamosPage",data(){return{prestamos:[],usuarios:[],estados:["Todos","Pendiente","Pagado","Cancelado","Vencido"],filters:{fecha_inicio:y().startOf("week").format("YYYY-MM-DD"),fecha_fin:y().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos",search:""},page:1,perPage:12,perPageOptions:[6,12,24,36,60].map(a=>({label:String(a),value:a})),totalPages:1,totalItems:0,from:0,to:0,resumen:{prestado:0,cargos:0,saldo:0},loading:!1}},mounted(){this.getUsuarios(),this.getPrestamos()},methods:{resetAndFetch(){this.page=1,this.getPrestamos()},getUsuarios(){this.$axios.get("users").then(a=>{this.usuarios=[{id:null,name:"Todos"},...a.data]})},getPrestamos(){this.loading=!0,this.$axios.get("prestamos",{params:{...this.filters,page:this.page,per_page:this.perPage}}).then(a=>{const e=a.data;this.prestamos=e.data||e,this.totalPages=e.last_page||1,this.page=e.current_page||1,this.totalItems=e.total||(e.data?e.data.length:this.prestamos.length),this.from=e.from||(this.page-1)*this.perPage+(this.totalItems?1:0),this.to=e.to||Math.min(this.page*this.perPage,this.totalItems),this.calcularResumen()}).catch(a=>{this.$alert?.error?.(a.response?.data?.message||"Error al obtener préstamos")}).finally(()=>{this.loading=!1})},calcularResumen(){const a=(s,r)=>s.reduce((o,v)=>o+r(v),0),e=s=>Number(s.valor_prestado||0),_=s=>e(s)*Number(s.interes||0)/100,f=s=>e(s)*Number(s.almacen||0)/100;this.resumen.prestado=a(this.prestamos,e),this.resumen.cargos=a(this.prestamos,s=>_(s)+f(s)),this.resumen.saldo=a(this.prestamos,s=>Number(s.saldo||0))},cargosTotales(a){const e=Number(a.valor_prestado||0);return e*Number(a.interes||0)/100+e*Number(a.almacen||0)/100},getEstadoColor(a){return a==="Pendiente"?"#fb8c00":a==="Pagado"?"#21ba45":a==="Cancelado"?"#e53935":a==="Vencido"?"#f4511e":"#9e9e9e"},getEstadoIcon(a){return a==="Pendiente"?"hourglass_empty":a==="Pagado"?"check_circle":a==="Cancelado"?"block":a==="Vencido"?"warning":"payments"},money(a){return Number(a||0).toFixed(2)}}},Y={class:"row q-col-gutter-sm"},z={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},M={class:"col-12 col-md-3"},T={class:"col-12 col-md-3"},D={class:"col-12 col-md-6"},O={class:"col-12 col-md-2"},R={class:"col-12 col-md-2 q-mt-sm"},j={class:"col-12 col-md-2 q-mt-sm"},L={class:"col-12 q-mt-sm"},Z={class:"row q-col-gutter-sm"},G={class:"row items-center no-wrap"},H={class:"q-ml-sm"},J={class:"text-weight-bold"},K={class:"text-caption text-grey-7"},W={class:"row items-center"},X={class:"text-body2 ellipsis-2-lines"},$={class:"row q-mt-sm"},ee={class:"col-6"},se={class:"text-weight-medium"},te={class:"col-6"},oe={class:"text-weight-medium"},ae={class:"text-caption text-grey"},le={class:"row q-mt-sm"},re={class:"col-6"},ie={class:"text-weight-medium"},de={class:"col-6"},ne={class:"text-weight-medium"},ce={class:"row items-center q-mt-sm text-caption text-grey"},me={key:0,class:"row items-center justify-between q-mt-sm"},ue={class:"col-auto text-caption text-grey-8 q-ml-sm"},pe={class:"col-auto"};function ge(a,e,_,f,s,r){return n(),C(E,{class:"q-pa-xs"},{default:d(()=>[l(b,{flat:"",bordered:""},{default:d(()=>[l(c,null,{default:d(()=>[t("div",Y,[t("div",z,[l(m,{type:"date",label:"Fecha Inicio",dense:"",outlined:"",modelValue:s.filters.fecha_inicio,"onUpdate:modelValue":[e[0]||(e[0]=o=>s.filters.fecha_inicio=o),r.resetAndFetch]},null,8,["modelValue","onUpdate:modelValue"])]),t("div",B,[l(m,{type:"date",label:"Fecha Fin",dense:"",outlined:"",modelValue:s.filters.fecha_fin,"onUpdate:modelValue":[e[1]||(e[1]=o=>s.filters.fecha_fin=o),r.resetAndFetch]},null,8,["modelValue","onUpdate:modelValue"])]),t("div",M,[l(h,{modelValue:s.filters.user_id,"onUpdate:modelValue":[e[2]||(e[2]=o=>s.filters.user_id=o),r.resetAndFetch],options:s.usuarios,"option-label":"name","option-value":"id","emit-value":"","map-options":"",dense:"",outlined:"",label:"Usuario"},null,8,["modelValue","options","onUpdate:modelValue"])]),t("div",T,[l(h,{modelValue:s.filters.estado,"onUpdate:modelValue":[e[3]||(e[3]=o=>s.filters.estado=o),r.resetAndFetch],options:s.estados,dense:"",outlined:"",label:"Estado"},null,8,["modelValue","options","onUpdate:modelValue"])]),t("div",D,[l(m,{modelValue:s.filters.search,"onUpdate:modelValue":[e[4]||(e[4]=o=>s.filters.search=o),r.resetAndFetch],dense:"",outlined:"",placeholder:"Buscar por Nº, nombre o CI…",debounce:400},{append:d(()=>[l(u,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),t("div",O,[l(h,{dense:"",outlined:"",modelValue:s.perPage,"onUpdate:modelValue":[e[5]||(e[5]=o=>s.perPage=o),r.resetAndFetch],options:s.perPageOptions,label:"Por página","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])]),t("div",R,[l(p,{color:"primary",label:"Actualizar",icon:"refresh",loading:s.loading,"no-caps":"",onClick:r.getPrestamos},null,8,["loading","onClick"])]),t("div",j,[l(p,{color:"green",label:"Nuevo Préstamo",icon:"add","no-caps":"",onClick:e[6]||(e[6]=o=>a.$router.push("/prestamos/crear"))})]),t("div",L,[t("div",Z,[(n(!0),g(k,null,q(s.prestamos,o=>(n(),g("div",{key:o.id,class:"col-12 col-sm-6 col-md-4"},[l(b,{bordered:"",flat:"",class:"loan-card"},{default:d(()=>[t("div",{class:"status-strip",style:x({backgroundColor:r.getEstadoColor(o.estado)})},null,4),l(c,{class:"q-pb-xs"},{default:d(()=>[t("div",G,[l(U,{icon:r.getEstadoIcon(o.estado),color:r.getEstadoColor(o.estado),"text-color":"white",size:"32px"},null,8,["icon","color"]),t("div",H,[t("div",J,"#"+i(o.numero),1),t("div",K,i(String(o.fecha_creacion).substring(0,10)),1)]),l(F),l(I,{dense:"",square:"","text-color":"white",style:x({backgroundColor:r.getEstadoColor(o.estado)})},{default:d(()=>[V(i(o.estado),1)]),_:2},1032,["style"])])]),_:2},1024),l(P,{spaced:""}),l(c,{class:"q-pt-none"},{default:d(()=>[t("div",W,[l(u,{name:"person",size:"18px",class:"q-mr-xs"}),t("div",X,i(o.cliente?.name||"N/A"),1)]),t("div",$,[t("div",ee,[e[8]||(e[8]=t("div",{class:"text-caption text-grey-7"},"Prestado",-1)),t("div",se,i(r.money(o.valor_prestado)),1)]),t("div",te,[e[9]||(e[9]=t("div",{class:"text-caption text-grey-7"},"Cargos",-1)),t("div",oe,i(r.money(r.cargosTotales(o))),1),t("div",ae,i(o.interes)+"% + "+i(o.almacen)+"%",1)])]),t("div",le,[t("div",re,[e[10]||(e[10]=t("div",{class:"text-caption text-grey-7"},"Peso (kg)",-1)),t("div",ie,i(Number(o.peso||0).toFixed(3)),1)]),t("div",de,[e[11]||(e[11]=t("div",{class:"text-caption text-grey-7"},"Saldo",-1)),t("div",ne,i(r.money(o.saldo)),1)])]),t("div",ce,[l(u,{name:"account_circle",size:"16px",class:"q-mr-xs"}),V(" "+i(o.user?.name||"—"),1)])]),_:2},1024),l(P),l(N,{align:"between",class:"q-pa-sm"},{default:d(()=>[l(p,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:v=>a.$router.push("/prestamos/editar/"+o.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),s.totalPages>1?(n(),g("div",me,[t("div",ue," Mostrando "+i(s.from)+"–"+i(s.to)+" de "+i(s.totalItems),1),t("div",pe,[l(A,{modelValue:s.page,"onUpdate:modelValue":[e[7]||(e[7]=o=>s.page=o),r.getPrestamos],max:s.totalPages,"max-pages":6,"boundary-numbers":"",color:"primary",disable:s.loading},null,8,["modelValue","max","disable","onUpdate:modelValue"])])])):Q("",!0)])])]),_:1})]),_:1})]),_:1})}const we=w(S,[["render",ge],["__scopeId","data-v-76f4ad7e"]]);export{we as default};
