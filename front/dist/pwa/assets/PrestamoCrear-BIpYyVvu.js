import{_ as x,c as C,o as u,w as r,a as t,Q as h,e as c,b as o,Z as m,an as i,d as y,f as p,a2 as g,a1 as _,t as d,a3 as Q,a4 as P,a5 as M,as as k}from"./index-DF8yCw7g.js";import{Q as b}from"./format-DrCijr_x.js";import{Q as v}from"./QBanner-r7BFLuMZ.js";import{Q as U}from"./QPagination-BHy9S2cW.js";import{Q as w}from"./QMarkupTable-DOVaOwyd.js";import{Q as V}from"./QSelect-DSC_Q8Vw.js";import{Q as q}from"./QForm-CDow4LrH.js";import{Q as S}from"./QPage-DIPGfeq1.js";import{h as N}from"./moment-C5S46NFB.js";import"./QMenu-CimfnVpa.js";import"./selection-BKxO1Gtz.js";const B={name:"PrestamoCrearPage",data(){return{page:1,totalPages:1,clientes:[],clienteFiltro:"",loading:!1,precioOro:{value:0},prestamo:{fecha_limite:N().add(1,"months").format("YYYY-MM-DD"),peso:0,valor_total:0,valor_prestado:0,interes:1,almacen:1,saldo:0,celular:"",detalle:"",cliente_id:null,cliente:null},interesMonto:0,almacenMonto:0,totalPagar:0}},async mounted(){await this.getClientes();const a=await this.$axios.get("cogs/1");this.precioOro=a.data,this.calcularTotales()},methods:{getClientes(){this.loading=!0,this.$axios.get("clients",{params:{search:this.clienteFiltro,page:this.page,per_page:3}}).then(a=>{this.clientes=a.data.data,this.totalPages=a.data.last_page||1}).finally(()=>{this.loading=!1})},seleccionarCliente(a){this.prestamo.cliente=a,this.prestamo.cliente_id=a.id,this.prestamo.celular=a.cellphone||""},calcularTotales(){const a=(this.prestamo.peso||0)*(this.precioOro.value||0);this.prestamo.valor_total=a,this.calcularSaldo()},calcularSaldo(){const a=Number(this.prestamo.valor_prestado||0),l=Number(this.prestamo.interes||0),f=Number(this.prestamo.almacen||0);this.interesMonto=+(a*l/100).toFixed(2),this.almacenMonto=+(a*f/100).toFixed(2),this.totalPagar=+(a+this.interesMonto+this.almacenMonto).toFixed(2),this.prestamo.saldo=this.totalPagar},guardarPrestamo(){if(!this.prestamo.cliente_id){this.$alert?.error?.("Debe seleccionar un cliente");return}this.loading=!0,this.$axios.post("prestamos",{...this.prestamo,user_id:this.$store.user.id}).then(()=>{this.$alert.success("Préstamo creado"),this.$router.push("/prestamos")}).catch(a=>this.$alert.error(a.response?.data?.message||"Error al guardar")).finally(()=>{this.loading=!1})},money(a){return Number(a||0).toFixed(2)}}},F={class:"row"},z={class:"col-12 col-md-5"},I={class:"row"},T={class:"col-12 col-md-8"},D={class:"col-12 col-md-3 text-right"},O={class:"flex flex-center q-mb-sm"},Y={key:0,class:"col-12 q-mt-sm"},A={style:{"white-space":"normal","max-width":"140px","word-break":"break-word","font-size":"12px","line-height":".9"}},E={class:"col-12 col-md-7"},L={class:"text-grey text-caption"},G={class:"row q-col-gutter-sm"},Z={class:"col-6 col-md-4"},j={class:"col-6 col-md-4"},H={class:"col-6 col-md-4"},J={class:"col-6 col-md-4"},K={class:"col-6 col-md-4"},R={class:"col-6 col-md-2"},W={class:"col-6 col-md-2"},X={class:"col-6 col-md-4"},$={class:"col-6 col-md-4"},ee={class:"col-6 col-md-4"},le={class:"col-12 col-md-4"},oe={class:"col-12"},te={key:0,class:"col-12 q-mt-sm"},se={class:"q-mt-md text-right"};function ae(a,l,f,re,e,n){return u(),C(S,{class:"q-pa-xs"},{default:r(()=>[t(h,{flat:"",bordered:""},{default:r(()=>[t(c,{class:"q-pa-xs"},{default:r(()=>[o("div",F,[o("div",z,[t(h,{flat:"",bordered:""},{default:r(()=>[t(c,{class:"text-bold q-pa-xs"},{default:r(()=>l[12]||(l[12]=[m("Seleccionar Cliente")])),_:1}),o("div",I,[o("div",T,[t(i,{dense:"",outlined:"",clearable:"",modelValue:e.clienteFiltro,"onUpdate:modelValue":[l[0]||(l[0]=s=>e.clienteFiltro=s),n.getClientes],placeholder:"Buscar cliente...",debounce:400},{append:r(()=>[t(y,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),o("div",D,[t(p,{label:"Buscar",color:"primary",onClick:n.getClientes,loading:e.loading,"no-caps":"",dense:"",size:"10px",icon:"search"},null,8,["onClick","loading"])])]),o("div",O,[e.prestamo.cliente?(u(),g("div",Y,[t(v,{class:"bg-grey-2"},{default:r(()=>[l[13]||(l[13]=m(" Cliente: ")),o("b",null,d(e.prestamo.cliente.name),1),m(" (CI: "+d(e.prestamo.cliente.ci)+") ",1),t(b,{color:e.prestamo.cliente.status==="Confiable"?"green":e.prestamo.cliente.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px",class:"q-ml-sm"},{default:r(()=>[m(d(e.prestamo.cliente.status),1)]),_:1},8,["color"])]),_:1})])):_("",!0),t(U,{size:"10px",modelValue:e.page,"onUpdate:modelValue":[l[1]||(l[1]=s=>e.page=s),n.getClientes],max:e.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])]),t(w,{flat:"",bordered:"",dense:""},{default:r(()=>[l[14]||(l[14]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Nombre"),o("th",null,"CI"),o("th",null,"Estado"),o("th",null,"Acción")])],-1)),o("tbody",null,[(u(!0),g(Q,null,P(e.clientes,s=>(u(),g("tr",{key:s.id,class:M({"bg-blue-2":e.prestamo.cliente_id===s.id})},[o("td",A,d(s.name),1),o("td",null,d(s.ci),1),o("td",null,[t(b,{color:s.status==="Confiable"?"green":s.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:r(()=>[m(d(s.status),1)]),_:2},1032,["color"])]),o("td",null,[t(p,{label:"Seleccionar",color:"primary",size:"xs",dense:"","no-caps":"",icon:"check",onClick:ne=>n.seleccionarCliente(s)},null,8,["onClick"])])],2))),128))])]),_:1})]),_:1})]),o("div",E,[t(h,{flat:"",bordered:""},{default:r(()=>[t(c,{class:"text-bold q-pa-xs"},{default:r(()=>[l[15]||(l[15]=m(" Crear Préstamo ")),o("span",L,"(Precio oro compra: "+d(e.precioOro.value)+")",1)]),_:1}),t(c,{class:"q-pa-xs"},{default:r(()=>[t(q,{onSubmit:k(n.guardarPrestamo,["prevent"])},{default:r(()=>[o("div",G,[o("div",Z,[t(i,{label:"Fecha Límite",type:"date",modelValue:e.prestamo.fecha_limite,"onUpdate:modelValue":l[2]||(l[2]=s=>e.prestamo.fecha_limite=s),outlined:"",dense:""},null,8,["modelValue"])]),o("div",j,[t(i,{label:"Celular",modelValue:e.prestamo.celular,"onUpdate:modelValue":l[3]||(l[3]=s=>e.prestamo.celular=s),outlined:"",dense:""},null,8,["modelValue"])]),o("div",H,[t(i,{label:"Peso (kg)",type:"number",modelValue:e.prestamo.peso,"onUpdate:modelValue":[l[4]||(l[4]=s=>e.prestamo.peso=s),n.calcularTotales],modelModifiers:{number:!0},min:"0",step:"0.001",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),o("div",J,[t(i,{label:"Valor Total (ref.)",modelValue:e.prestamo.valor_total,"onUpdate:modelValue":l[5]||(l[5]=s=>e.prestamo.valor_total=s),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),o("div",K,[t(i,{label:"Prestado (Bs)",modelValue:e.prestamo.valor_prestado,"onUpdate:modelValue":[l[6]||(l[6]=s=>e.prestamo.valor_prestado=s),n.calcularSaldo],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),o("div",R,[t(V,{label:"Interés (%)",outlined:"",dense:"",modelValue:e.prestamo.interes,"onUpdate:modelValue":[l[7]||(l[7]=s=>e.prestamo.interes=s),n.calcularSaldo],modelModifiers:{number:!0},options:[1,2,3]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",W,[t(V,{label:"Almacén (%)",outlined:"",dense:"",modelValue:e.prestamo.almacen,"onUpdate:modelValue":[l[8]||(l[8]=s=>e.prestamo.almacen=s),n.calcularSaldo],modelModifiers:{number:!0},options:[1,2,3]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",X,[t(i,{label:"Interés (Bs)","model-value":n.money(e.interesMonto),outlined:"",dense:"",readonly:""},null,8,["model-value"])]),o("div",$,[t(i,{label:"Almacén (Bs)","model-value":n.money(e.almacenMonto),outlined:"",dense:"",readonly:""},null,8,["model-value"])]),o("div",ee,[t(i,{label:"Total a pagar","model-value":n.money(e.totalPagar),outlined:"",dense:"",readonly:""},null,8,["model-value"])]),o("div",le,[t(i,{label:"Saldo",modelValue:e.prestamo.saldo,"onUpdate:modelValue":l[9]||(l[9]=s=>e.prestamo.saldo=s),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),o("div",oe,[t(i,{label:"Detalle",modelValue:e.prestamo.detalle,"onUpdate:modelValue":l[10]||(l[10]=s=>e.prestamo.detalle=s),type:"textarea",outlined:"",dense:""},null,8,["modelValue"])]),e.prestamo.cliente?(u(),g("div",te,[t(v,{class:"bg-grey-2"},{default:r(()=>[l[16]||(l[16]=m(" Cliente: ")),o("b",null,d(e.prestamo.cliente.name),1),m(" (CI: "+d(e.prestamo.cliente.ci)+") ",1),t(b,{color:e.prestamo.cliente.status==="Confiable"?"green":e.prestamo.cliente.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px",class:"q-ml-sm"},{default:r(()=>[m(d(e.prestamo.cliente.status),1)]),_:1},8,["color"])]),_:1})])):_("",!0)]),o("div",se,[t(p,{label:"Cancelar",color:"negative",onClick:l[11]||(l[11]=s=>a.$router.push("/prestamos")),class:"q-mr-sm",loading:e.loading},null,8,["loading"]),t(p,{label:"Guardar",type:"submit",color:"green",loading:e.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})}const ve=x(B,[["render",ae]]);export{ve as default};
