import{_ as x,c as b,o as h,w as a,a as n,Q as f,e as g,b as t,Z as u,an as i,d as V,f as m,a2 as _,a3 as v,a4 as w,a5 as y,t as d,as as k,a1 as Q}from"./index-H1xfLONU.js";import{Q as B}from"./QPagination-CEle5SeA.js";import{Q as C}from"./format-BLZ5nlkB.js";import{Q as S}from"./QMarkupTable-r3-gjMWZ.js";import{Q as U}from"./QBanner-BJINbKKa.js";import{Q as P}from"./QForm-BMjke_cd.js";import{Q as q}from"./QPage-BwE-RHpL.js";import{h as O}from"./moment-C5S46NFB.js";const E={name:"OrdenCrearPage",data(){return{page:1,totalPages:1,orden:{numero:"",fecha_entrega:O().add(1,"weeks").format("YYYY-MM-DD"),detalle:"",celular:"",costo_total:0,adelanto:0,saldo:0,estado:"Pendiente",peso:0,nota:"",cliente_id:null,cliente:null},estados:["Pendiente","Entregado","Cancelada"],clientes:[],clienteFiltro:"",loading:!1,precioOro:{value:0},costoBase:0,reconocimiento:null,reconocimientoCampo:!1}},async mounted(){this.getClientes();const s=await this.$axios.get("cogs/2");this.precioOro=s.data;const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.reconocimiento=new e,this.reconocimiento.lang="es-BO",this.reconocimiento.interimResults=!1,this.reconocimiento.continuous=!1,this.reconocimiento.onresult=c=>{const p=c.results[0][0].transcript;this.reconocimientoCampo==="detalle"?this.orden.detalle=this.orden.detalle?this.orden.detalle+" "+p:p:this.reconocimientoCampo==="nota"&&(this.orden.nota=this.orden.nota?this.orden.nota+" "+p:p)},this.reconocimiento.onerror=c=>{console.error("Error de reconocimiento:",c.error)}):console.warn("Speech Recognition no está soportado en este navegador")},methods:{iniciarReconocimiento(s){if(!this.reconocimiento){this.$alert.warning("Reconocimiento de voz no soportado en este navegador");return}this.reconocimientoCampo=s,this.reconocimiento.start()},getClientes(){this.loading=!0,this.$axios.get("clients",{params:{search:this.clienteFiltro,page:this.page,per_page:10}}).then(s=>{this.clientes=s.data.data,this.totalPages=s.data.last_page}).catch(s=>{this.$alert.error(s.response?.data?.message||"Error al cargar los clientes")}).finally(()=>{this.loading=!1})},calcularSaldo(){this.orden.saldo=(this.orden.costo_total||0)-(this.orden.adelanto||0)},validarCostoTotal(s){const e=this.costoBase+20,c=this.costoBase-20;(s>e||s<c)&&(this.$alert.warning(`El costo total solo puede modificarse ±20 Bs del valor calculado (${this.costoBase.toFixed(2)} Bs)`),this.orden.costo_total=this.costoBase),this.calcularSaldo()},calcularTotal(){const s=(this.orden.peso||0)*(this.precioOro.value||0);this.costoBase=s,this.orden.costo_total=s,this.calcularSaldo()},seleccionarCliente(s){this.orden.cliente=s,this.orden.cliente_id=s.id,this.orden.celular=s.cellphone||""},guardarOrden(){if(!this.orden.cliente_id){this.$alert.error("Debe seleccionar un cliente");return}this.loading=!0,this.$axios.post("ordenes",{...this.orden,user_id:this.$store.user.id}).then(s=>{this.$alert.success("Orden creada con éxito"),this.$router.push("/ordenes")}).catch(s=>{this.$alert.error(s.response?.data?.message||"Error al guardar la orden")}).finally(()=>{this.loading=!1})}}},N={class:"row"},R={class:"col-12 col-md-5"},F={class:"row"},M={class:"col-12 col-md-8"},z={class:"col-12 col-md-2 text-right"},T={class:"flex flex-center"},D={style:{"white-space":"normal","max-width":"120px","word-break":"break-word","font-size":"12px","line-height":"0.9"}},I={class:"col-12 col-md-7"},Y={class:"text-grey text-caption"},A={class:"row q-col-gutter-sm"},G={class:"col-12 col-md-3"},L={class:"col-12 col-md-3"},Z={class:"col-12 col-md-3"},j={class:"col-6 col-md-3"},H={class:"col-6 col-md-3"},J={class:"col-12 col-md-4"},K={class:"col-12 col-md-6"},W={class:"col-12 col-md-6"},X={class:"col-12 q-mt-sm"},$={class:"q-mt-md text-right"};function ee(s,e,c,p,o,r){return h(),b(q,{class:"q-pa-xs"},{default:a(()=>[n(f,{flat:"",bordered:""},{default:a(()=>[n(g,{class:"q-pa-xs"},{default:a(()=>[t("div",N,[t("div",R,[n(f,{flat:"",bordered:""},{default:a(()=>[n(g,{class:"text-bold q-pa-xs"},{default:a(()=>e[13]||(e[13]=[u("Seleccionar Cliente")])),_:1}),t("div",F,[t("div",M,[n(i,{dense:"",outlined:"",debounce:"300",modelValue:o.clienteFiltro,"onUpdate:modelValue":[e[0]||(e[0]=l=>o.clienteFiltro=l),r.getClientes],placeholder:"Buscar cliente...",class:"q-mb-sm",clearable:""},{append:a(()=>[n(V,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),t("div",z,[n(m,{label:"Buscar",color:"primary",class:"q-mb-sm",onClick:r.getClientes,icon:"search",loading:o.loading,"no-caps":"",dense:"",size:"10px"},null,8,["onClick","loading"])])]),t("div",T,[n(B,{modelValue:o.page,"onUpdate:modelValue":[e[1]||(e[1]=l=>o.page=l),r.getClientes],max:o.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])]),n(S,{flat:"",bordered:"",dense:""},{default:a(()=>[e[14]||(e[14]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Nombre"),t("th",null,"CI"),t("th",null,"Estado"),t("th",null,"Acción")])],-1)),t("tbody",null,[(h(!0),_(v,null,w(o.clientes,(l,oe)=>(h(),_("tr",{key:l.id,class:y({"bg-blue-2":o.orden.cliente_id===l.id})},[t("td",D,d(l.name),1),t("td",null,d(l.ci),1),t("td",null,[n(C,{color:l.status==="Confiable"?"green":l.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[u(d(l.status),1)]),_:2},1032,["color"])]),t("td",null,[n(m,{label:"Seleccionar",color:"primary",dense:"",onClick:le=>r.seleccionarCliente(l),icon:"check",size:"10px","no-caps":""},null,8,["onClick"])])],2))),128))])]),_:1})]),_:1})]),t("div",I,[n(f,{flat:"",bordered:""},{default:a(()=>[n(g,{class:"text-bold q-pa-xs"},{default:a(()=>[e[15]||(e[15]=u(" Crear Nueva Orden ")),t("span",Y," (Precio oro: "+d(o.precioOro.value)+") ",1)]),_:1}),n(g,{class:"q-pa-xs"},{default:a(()=>[n(P,{onSubmit:k(r.guardarOrden,["prevent"])},{default:a(()=>[t("div",A,[t("div",G,[n(i,{label:"Fecha de Entrega",type:"date",modelValue:o.orden.fecha_entrega,"onUpdate:modelValue":e[2]||(e[2]=l=>o.orden.fecha_entrega=l),outlined:"",dense:""},null,8,["modelValue"])]),t("div",L,[n(i,{label:"Celular",modelValue:o.orden.celular,"onUpdate:modelValue":e[3]||(e[3]=l=>o.orden.celular=l),outlined:"",dense:""},null,8,["modelValue"])]),t("div",Z,[n(i,{label:"Peso (kg)",modelValue:o.orden.peso,"onUpdate:modelValue":[e[4]||(e[4]=l=>o.orden.peso=l),r.calcularTotal],modelModifiers:{number:!0},type:"number",outlined:"",dense:"",min:"0",step:"0.01",rules:[l=>l>=0||"El peso debe ser positivo"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),t("div",j,[n(i,{label:"Costo Total",modelValue:o.orden.costo_total,"onUpdate:modelValue":[e[5]||(e[5]=l=>o.orden.costo_total=l),r.validarCostoTotal],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",H,[n(i,{label:"Adelanto",modelValue:o.orden.adelanto,"onUpdate:modelValue":[e[6]||(e[6]=l=>o.orden.adelanto=l),r.calcularSaldo],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",J,[n(i,{label:"Saldo",modelValue:o.orden.saldo,"onUpdate:modelValue":e[7]||(e[7]=l=>o.orden.saldo=l),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),t("div",K,[n(i,{label:"Detalle",modelValue:o.orden.detalle,"onUpdate:modelValue":e[9]||(e[9]=l=>o.orden.detalle=l),type:"textarea",outlined:"",dense:""},{append:a(()=>[n(m,{icon:"mic",onClick:e[8]||(e[8]=l=>r.iniciarReconocimiento("detalle")),flat:"",dense:""})]),_:1},8,["modelValue"])]),t("div",W,[n(i,{label:"Nota",modelValue:o.orden.nota,"onUpdate:modelValue":e[11]||(e[11]=l=>o.orden.nota=l),type:"textarea",outlined:"",dense:""},{append:a(()=>[n(m,{icon:"mic",onClick:e[10]||(e[10]=l=>r.iniciarReconocimiento("nota")),flat:"",dense:""})]),_:1},8,["modelValue"])]),e[17]||(e[17]=t("div",{class:"col-12"},null,-1)),t("div",X,[o.orden.cliente?(h(),b(U,{key:0,class:"bg-grey-2"},{default:a(()=>[e[16]||(e[16]=u(" Cliente seleccionado: ")),t("b",null,d(o.orden.cliente.name),1),u(" (CI: "+d(o.orden.cliente.ci)+") ",1),n(C,{color:o.orden.cliente.status==="Confiable"?"green":o.orden.cliente.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[u(d(o.orden.cliente.status),1)]),_:1},8,["color"])]),_:1})):Q("",!0)])]),t("div",$,[n(m,{label:"Cancelar",type:"button",color:"negative",onClick:e[12]||(e[12]=l=>s.$router.push("/ordenes")),class:"q-mr-sm",loading:o.loading},null,8,["loading"]),n(m,{label:"Guardar",type:"submit",color:"green",loading:o.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})}const ue=x(E,[["render",ee]]);export{ue as default};
