import{_ as x,c as f,o as m,w as a,a as s,Q as b,e as g,b as l,Z as d,a6 as c,d as k,f as p,a1 as C,t as i,a2 as V,a3 as w,a4 as y,a5 as Q,ar as B,am as S}from"./index-DJlbbp9w.js";import{Q as _}from"./QChip-B2YiD0bd.js";import{Q as v}from"./QBanner-Cr0XBA55.js";import{Q as U}from"./QPagination-Bu1lKwfy.js";import{Q as K}from"./QMarkupTable-Eb1bhQh3.js";import{Q as q}from"./QSelect-DXOWypMk.js";import{Q as P}from"./QForm-C-6n6sp5.js";import{Q as E}from"./QPage-DZyoZfy2.js";import{h as O}from"./moment-C5S46NFB.js";import"./format-BSyrK4UF.js";import"./selection-BBy6q_jq.js";const z={name:"OrdenCrearPage",data(){return{page:1,totalPages:1,check18Kilates:"18 Kilates",orden:{numero:"",tipo_pago:"Efectivo",fecha_entrega:O().add(1,"weeks").format("YYYY-MM-DD"),detalle:"",celular:"",costo_total:0,adelanto:0,saldo:0,estado:"Pendiente",peso:0,nota:"",cliente_id:null,cliente:null},estados:["Pendiente","Entregado","Cancelada"],clientes:[],clienteFiltro:"",loading:!1,precioOro:{value:0},costoBase:0,reconocimiento:null,reconocimientoCampo:!1}},async mounted(){this.getClientes();const n=await this.$axios.get("cogs/2");this.precioOro=n.data;const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.reconocimiento=new e,this.reconocimiento.lang="es-BO",this.reconocimiento.interimResults=!1,this.reconocimiento.continuous=!1,this.reconocimiento.onresult=h=>{const u=h.results[0][0].transcript;this.reconocimientoCampo==="detalle"?this.orden.detalle=this.orden.detalle?this.orden.detalle+" "+u:u:this.reconocimientoCampo==="nota"&&(this.orden.nota=this.orden.nota?this.orden.nota+" "+u:u)},this.reconocimiento.onerror=h=>{console.error("Error de reconocimiento:",h.error)}):console.warn("Speech Recognition no está soportado en este navegador")},methods:{coloca18Kilates(){this.check18Kilates?this.orden.detalle=this.orden.detalle?this.orden.detalle+" | 18 Kilates":"18 Kilates":this.orden.detalle=this.orden.detalle.replace(" | 18 Kilates","").replace("18 Kilates","").trim()},iniciarReconocimiento(n){if(!this.reconocimiento){this.$alert.warning("Reconocimiento de voz no soportado en este navegador");return}this.reconocimientoCampo=n,this.reconocimiento.start()},getClientes(){this.loading=!0,this.$axios.get("clients",{params:{search:this.clienteFiltro,page:this.page,per_page:3}}).then(n=>{this.clientes=n.data.data,this.totalPages=n.data.last_page}).catch(n=>{this.$alert.error(n.response?.data?.message||"Error al cargar los clientes")}).finally(()=>{this.loading=!1})},calcularSaldo(){this.orden.saldo=(this.orden.costo_total||0)-(this.orden.adelanto||0)},validarCostoTotal(n){const e=this.costoBase-20;n<e&&(this.$alert.warning(`El costo total solo puede modificarse ±20 Bs del valor calculado (${this.costoBase.toFixed(2)} Bs)`),this.orden.costo_total=this.costoBase),this.calcularSaldo()},calcularTotal(){const n=(this.orden.peso||0)*(this.precioOro.value||0);this.costoBase=n,this.orden.costo_total=n,this.calcularSaldo()},seleccionarCliente(n){this.orden.cliente=n,this.orden.cliente_id=n.id,this.orden.celular=n.cellphone||""},guardarOrden(){if(!this.orden.cliente_id){this.$alert.error("Debe seleccionar un cliente");return}this.loading=!0,this.orden.kilates18=this.check18Kilates,this.$axios.post("ordenes",{...this.orden,user_id:this.$store.user.id}).then(n=>{this.$alert.success("Orden creada con éxito"),this.$router.push("/ordenes")}).catch(n=>{this.$alert.error(n.response?.data?.message||"Error al guardar la orden")}).finally(()=>{this.loading=!1})}}},N={class:"row"},R={class:"col-12 col-md-5"},F={class:"row"},M={class:"col-12 col-md-8"},T={class:"col-12 col-md-2 text-right"},D={class:"col-12 q-mt-sm"},I={class:"flex flex-center"},Y={style:{"white-space":"normal","max-width":"120px","word-break":"break-word","font-size":"12px","line-height":"0.9"}},A={class:"col-12 col-md-7"},G={class:"text-grey text-caption"},L={class:"row q-col-gutter-sm"},Z={class:"col-12 col-md-3"},j={class:"col-12 col-md-3"},H={class:"col-12 col-md-3"},J={class:"col-6 col-md-3"},W={class:"col-6 col-md-3"},X={class:"col-12 col-md-4"},$={class:"col-12 col-md-2"},ee={class:"col-12 col-md-3"},oe={class:"col-12 col-md-6"},le={class:"col-12 q-mt-sm"},te={class:"q-mt-md text-right"};function se(n,e,h,u,o,r){return m(),f(E,{class:"q-pa-xs"},{default:a(()=>[s(b,{flat:"",bordered:""},{default:a(()=>[s(g,{class:"q-pa-xs"},{default:a(()=>[l("div",N,[l("div",R,[s(b,{flat:"",bordered:""},{default:a(()=>[s(g,{class:"text-bold q-pa-xs"},{default:a(()=>e[13]||(e[13]=[d("Seleccionar Cliente")])),_:1}),l("div",F,[l("div",M,[s(c,{dense:"",outlined:"",debounce:"300",modelValue:o.clienteFiltro,"onUpdate:modelValue":[e[0]||(e[0]=t=>o.clienteFiltro=t),r.getClientes],placeholder:"Buscar cliente...",class:"q-mb-sm",clearable:""},{append:a(()=>[s(k,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",T,[s(p,{label:"Buscar",color:"primary",class:"q-mb-sm",onClick:r.getClientes,icon:"search",loading:o.loading,"no-caps":"",dense:"",size:"10px"},null,8,["onClick","loading"])])]),l("div",D,[o.orden.cliente?(m(),f(v,{key:0,class:"bg-grey-2"},{default:a(()=>[e[14]||(e[14]=d(" Cliente seleccionado: ")),l("b",null,i(o.orden.cliente.name),1),d(" (CI: "+i(o.orden.cliente.ci)+") ",1),s(_,{color:o.orden.cliente.status==="Confiable"?"green":o.orden.cliente.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[d(i(o.orden.cliente.status),1)]),_:1},8,["color"])]),_:1})):C("",!0)]),l("div",I,[s(U,{size:"10px",modelValue:o.page,"onUpdate:modelValue":[e[1]||(e[1]=t=>o.page=t),r.getClientes],max:o.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])]),s(K,{flat:"",bordered:"",dense:""},{default:a(()=>[e[15]||(e[15]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",null,"Nombre"),l("th",null,"CI"),l("th",null,"Estado"),l("th",null,"Acción")])],-1)),l("tbody",null,[(m(!0),V(w,null,y(o.clientes,(t,ne)=>(m(),V("tr",{key:t.id,class:Q({"bg-blue-2":o.orden.cliente_id===t.id})},[l("td",Y,i(t.name),1),l("td",null,i(t.ci),1),l("td",null,[s(_,{color:t.status==="Confiable"?"green":t.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[d(i(t.status),1)]),_:2},1032,["color"])]),l("td",null,[s(p,{label:"Seleccionar",color:"primary",dense:"",onClick:ae=>r.seleccionarCliente(t),icon:"check",size:"10px","no-caps":""},null,8,["onClick"])])],2))),128))])]),_:1})]),_:1})]),l("div",A,[s(b,{flat:"",bordered:""},{default:a(()=>[s(g,{class:"text-bold q-pa-xs"},{default:a(()=>[e[16]||(e[16]=d(" Crear Nueva Orden ")),l("span",G," (Precio oro: "+i(o.precioOro.value)+") ",1)]),_:1}),s(g,{class:"q-pa-xs"},{default:a(()=>[s(P,{onSubmit:B(r.guardarOrden,["prevent"])},{default:a(()=>[l("div",L,[l("div",Z,[s(c,{label:"Fecha de Entrega",type:"date",modelValue:o.orden.fecha_entrega,"onUpdate:modelValue":e[2]||(e[2]=t=>o.orden.fecha_entrega=t),outlined:"",dense:""},null,8,["modelValue"])]),l("div",j,[s(c,{label:"Celular",modelValue:o.orden.celular,"onUpdate:modelValue":e[3]||(e[3]=t=>o.orden.celular=t),outlined:"",dense:""},null,8,["modelValue"])]),l("div",H,[s(c,{label:"Peso (kg)",modelValue:o.orden.peso,"onUpdate:modelValue":[e[4]||(e[4]=t=>o.orden.peso=t),r.calcularTotal],modelModifiers:{number:!0},type:"number",outlined:"",dense:"",min:"0",step:"0.01",rules:[t=>t>=0||"El peso debe ser positivo"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),l("div",J,[s(c,{label:"Costo Total",modelValue:o.orden.costo_total,"onUpdate:modelValue":[e[5]||(e[5]=t=>o.orden.costo_total=t),r.validarCostoTotal],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),l("div",W,[s(c,{label:"Adelanto",modelValue:o.orden.adelanto,"onUpdate:modelValue":[e[6]||(e[6]=t=>o.orden.adelanto=t),r.calcularSaldo],modelModifiers:{number:!0},type:"number",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),l("div",X,[s(c,{label:"Saldo",modelValue:o.orden.saldo,"onUpdate:modelValue":e[7]||(e[7]=t=>o.orden.saldo=t),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),l("div",$,[s(S,{modelValue:o.check18Kilates,"onUpdate:modelValue":e[8]||(e[8]=t=>o.check18Kilates=t),label:"18 Kilates",dense:"","true-value":"18 Kilates","false-value":""},null,8,["modelValue"])]),l("div",ee,[s(q,{modelValue:o.orden.tipo_pago,"onUpdate:modelValue":e[9]||(e[9]=t=>o.orden.tipo_pago=t),options:["Efectivo","QR"],label:"Tipo de Pago",outlined:"",dense:""},null,8,["modelValue"])]),l("div",oe,[s(c,{label:"Detalle",modelValue:o.orden.detalle,"onUpdate:modelValue":e[11]||(e[11]=t=>o.orden.detalle=t),type:"textarea",outlined:"",dense:""},{append:a(()=>[s(p,{icon:"mic",onClick:e[10]||(e[10]=t=>r.iniciarReconocimiento("detalle")),flat:"",dense:""})]),_:1},8,["modelValue"])]),e[18]||(e[18]=l("div",{class:"col-12"},null,-1)),l("div",le,[o.orden.cliente?(m(),f(v,{key:0,class:"bg-grey-2"},{default:a(()=>[e[17]||(e[17]=d(" Cliente seleccionado: ")),l("b",null,i(o.orden.cliente.name),1),d(" (CI: "+i(o.orden.cliente.ci)+") ",1),s(_,{color:o.orden.cliente.status==="Confiable"?"green":o.orden.cliente.status==="No Confiable"?"red":"orange","text-color":"white",dense:"",size:"10px"},{default:a(()=>[d(i(o.orden.cliente.status),1)]),_:1},8,["color"])]),_:1})):C("",!0)])]),l("div",te,[s(p,{label:"Cancelar",type:"button",color:"negative",onClick:e[12]||(e[12]=t=>n.$router.push("/ordenes")),class:"q-mr-sm",loading:o.loading},null,8,["loading"]),s(p,{label:"Guardar",type:"submit",color:"green",loading:o.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1})]),_:1})}const _e=x(z,[["render",se]]);export{_e as default};
