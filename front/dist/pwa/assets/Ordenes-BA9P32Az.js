import{_ as y,c as C,o as p,w as i,a as o,Q as m,e as d,b as e,an as h,ax as P,d as c,f as u,t as r,a2 as b,a3 as V,a4 as q,ay as x,a0 as k,Z as _,am as w,az as O}from"./index-DePMG0cy.js";import{Q as f}from"./QSelect-BoFoKKct.js";import{Q as Y}from"./QSpace-U9HCJXDw.js";import{Q}from"./format-B2tpYWqK.js";import{Q as F}from"./QPagination-DK_iaAlO.js";import{Q as T}from"./QPage-Crx2SrYo.js";import{h as g}from"./moment-C5S46NFB.js";import"./QMenu-BdRM3-9X.js";import"./selection-CQYWlQ2Y.js";const U={name:"OrdenesPage",data(){return{ordenes:[],usuarios:[],estados:["Todos","Pendiente","Entregado","Cancelada"],filters:{fecha_inicio:g().startOf("week").format("YYYY-MM-DD"),fecha_fin:g().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos",search:""},resumen:{total:0,adelanto:0,saldo:0},loading:!1,pagination:{page:1,rowsPerPage:12,rowsNumber:0,lastPage:1},perPageOptions:[12,24,48,96,100]}},mounted(){this.getUsuarios(),this.getOrdenes()},methods:{resetToFirst(){this.pagination.page=1},imprimirOrden(t){const s=`${this.$axios.defaults.baseURL}/ordenes/${t}/pdf`;window.open(s,"_blank")},imprimirGarantia(t){const s=`${this.$axios.defaults.baseURL}/ordenes/${t}/garantia`;window.open(s,"_blank")},getUsuarios(){this.$axios.get("users").then(t=>{this.usuarios=[{id:null,name:"Todos"},...t.data]})},getOrdenes(){this.loading=!0,this.$axios.get("ordenes",{params:{...this.filters,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(t=>{const s=t.data;this.ordenes=s.data||[],this.pagination.page=s.current_page||1,this.pagination.rowsPerPage=s.per_page||this.pagination.rowsPerPage,this.pagination.rowsNumber=s.total||this.ordenes.length,this.pagination.lastPage=s.last_page||1,this.calcularResumen()}).catch(t=>{this.$alert?.error?.(t.response?.data?.message||"Error al obtener órdenes")}).finally(()=>{this.loading=!1})},onChangePerPage(){this.pagination.page=1,this.getOrdenes()},calcularResumen(){this.resumen.total=this.ordenes.filter(t=>t.estado!=="Cancelada").reduce((t,s)=>t+Number(s.costo_total||0),0),this.resumen.adelanto=this.ordenes.filter(t=>t.estado!=="Cancelada").reduce((t,s)=>t+Number(s.adelanto||0),0),this.resumen.saldo=this.ordenes.filter(t=>t.estado!=="Cancelada").reduce((t,s)=>t+Number(s.saldo||0),0)},getEstadoColor(t){switch(t){case"Pendiente":return"#fb8c00";case"Entregado":return"#21ba45";case"Cancelada":return"#e53935";default:return"#9e9e9e"}},getEstadoIcon(t){switch(t){case"Pendiente":return"hourglass_empty";case"Entregado":return"check_circle";case"Cancelada":return"cancel";default:return"work"}},money(t){return Number(t||0).toFixed(2)},formatDateTime(t){return t?t.length>10?g(t).format("YYYY-MM-DD HH:mm"):g(t,"YYYY-MM-DD").format("YYYY-MM-DD"):"—"}},watch:{"filters.fecha_inicio"(){this.resetToFirst(),this.getOrdenes()},"filters.fecha_fin"(){this.resetToFirst(),this.getOrdenes()},"filters.user_id"(){this.resetToFirst(),this.getOrdenes()},"filters.estado"(){this.resetToFirst(),this.getOrdenes()},"filters.search"(){this.resetToFirst(),this.getOrdenes()}}},D={class:"row q-col-gutter-sm"},E={class:"col-12 col-md-3"},N={class:"col-12 col-md-3"},M={class:"col-12 col-md-3"},z={class:"col-12 col-md-3"},S={class:"col-12 col-md-6"},I={class:"col-12 col-md-2 q-mt-sm"},A={class:"col-12 col-md-2 q-mt-sm"},B={class:"col-12 col-md-8 q-mt-sm"},R={class:"row q-col-gutter-sm"},K={class:"col-12 col-md-4"},L={class:"text-h6"},j={class:"col-12 col-md-4"},G={class:"text-h6"},H={class:"col-12 col-md-4"},Z={class:"text-h6"},J={class:"col-12 q-mt-sm"},W={class:"row q-col-gutter-sm"},X={class:"row items-center no-wrap"},$={class:"q-ml-sm"},ee={class:"text-weight-bold"},se={class:"text-caption text-grey-7"},te={class:"muted"},oe={class:"row items-center"},ae={class:"text-body2 ellipsis-2-lines"},le={class:"row q-mt-sm"},ie={class:"col-4"},ne={class:"text-weight-medium"},re={class:"col-4"},de={class:"text-weight-medium"},ce={class:"col-4"},me={class:"text-weight-medium"},ue={class:"row items-center q-mt-sm text-caption text-grey"},ge={class:"col-12 q-mt-md"},pe={class:"row items-center justify-between"},he={class:"col-12 col-sm-6 q-mb-sm"},_e={class:"row items-center"},fe={class:"q-ml-md text-caption"},ve={class:"col-12 col-sm-6"},be={class:"row justify-end"};function xe(t,s,we,ye,l,n){return p(),C(T,{class:"q-pa-xs"},{default:i(()=>[o(m,{flat:"",bordered:""},{default:i(()=>[o(d,null,{default:i(()=>[e("div",D,[e("div",E,[o(h,{label:"Fecha Inicio",type:"date",dense:"",outlined:"",modelValue:l.filters.fecha_inicio,"onUpdate:modelValue":s[0]||(s[0]=a=>l.filters.fecha_inicio=a)},null,8,["modelValue"])]),e("div",N,[o(h,{label:"Fecha Fin",type:"date",dense:"",outlined:"",modelValue:l.filters.fecha_fin,"onUpdate:modelValue":s[1]||(s[1]=a=>l.filters.fecha_fin=a)},null,8,["modelValue"])]),e("div",M,[o(f,{modelValue:l.filters.user_id,"onUpdate:modelValue":s[2]||(s[2]=a=>l.filters.user_id=a),options:l.usuarios,"option-label":"name","option-value":"id",label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e("div",z,[o(f,{modelValue:l.filters.estado,"onUpdate:modelValue":s[3]||(s[3]=a=>l.filters.estado=a),options:l.estados,label:"Estado",dense:"",outlined:""},null,8,["modelValue","options"])]),e("div",S,[o(h,{modelValue:l.filters.search,"onUpdate:modelValue":s[4]||(s[4]=a=>l.filters.search=a),dense:"",outlined:"",placeholder:"Buscar por Nº orden, nombre o CI...",debounce:400,onKeyup:P(n.getOrdenes,["enter"])},{append:i(()=>[o(c,{name:"search"})]),_:1},8,["modelValue","onKeyup"])]),e("div",I,[o(u,{color:"primary",label:"Actualizar",icon:"refresh",onClick:n.getOrdenes,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])]),e("div",A,[o(u,{color:"green",label:"Crear Orden",icon:"add",onClick:s[5]||(s[5]=a=>t.$router.push("/ordenes/crear")),"no-caps":""})]),e("div",B,[e("div",R,[e("div",K,[o(m,{bordered:"",class:"bg-blue-1"},{default:i(()=>[o(d,{class:"row items-center"},{default:i(()=>[o(c,{name:"payments",color:"blue",size:"lg",class:"q-mr-sm"}),e("div",null,[s[8]||(s[8]=e("div",{class:"text-subtitle1 text-weight-bold text-blue"},"Total",-1)),e("div",L,r(l.resumen.total.toFixed(2)),1)])]),_:1})]),_:1})]),e("div",j,[o(m,{bordered:"",class:"bg-green-1"},{default:i(()=>[o(d,{class:"row items-center"},{default:i(()=>[o(c,{name:"trending_up",color:"green",size:"lg",class:"q-mr-sm"}),e("div",null,[s[9]||(s[9]=e("div",{class:"text-subtitle1 text-weight-bold text-green"},"Adelanto",-1)),e("div",G,r(l.resumen.adelanto.toFixed(2)),1)])]),_:1})]),_:1})]),e("div",H,[o(m,{bordered:"",class:"bg-red-1"},{default:i(()=>[o(d,{class:"row items-center"},{default:i(()=>[o(c,{name:"account_balance_wallet",color:"red",size:"lg",class:"q-mr-sm"}),e("div",null,[s[10]||(s[10]=e("div",{class:"text-subtitle1 text-weight-bold text-red"},"Saldo",-1)),e("div",Z,r(l.resumen.saldo.toFixed(2)),1)])]),_:1})]),_:1})])])]),e("div",J,[e("div",W,[(p(!0),b(V,null,q(l.ordenes,a=>(p(),b("div",{key:a.id,class:"col-12 col-md-4"},[o(m,{bordered:"",flat:"",class:"order-card"},{default:i(()=>[e("div",{class:"status-strip",style:x({backgroundColor:n.getEstadoColor(a.estado)})},null,4),o(d,{class:"q-pb-xs"},{default:i(()=>[e("div",X,[o(k,{icon:n.getEstadoIcon(a.estado),color:n.getEstadoColor(a.estado),"text-color":"white",size:"32px"},null,8,["icon","color"]),e("div",$,[e("div",ee,"#"+r(a.numero),1),e("div",se,[_(r(a.fecha_creacion?.substring(0,10))+" ",1),s[11]||(s[11]=e("br",null,null,-1)),e("span",te,"Creado: "+r(n.formatDateTime(a.fecha_creacion)),1)])]),o(Y),o(Q,{dense:"",square:"","text-color":"white",style:x({backgroundColor:n.getEstadoColor(a.estado)})},{default:i(()=>[_(r(a.estado),1)]),_:2},1032,["style"])])]),_:2},1024),o(w,{spaced:""}),o(d,{class:"q-pt-none"},{default:i(()=>[e("div",oe,[o(c,{name:"person",size:"18px",class:"q-mr-xs"}),e("div",ae,r(a.cliente?.name||"N/A"),1)]),e("div",le,[e("div",ie,[s[12]||(s[12]=e("div",{class:"text-caption text-grey-7"},"Total",-1)),e("div",ne,r(n.money(a.costo_total)),1)]),e("div",re,[s[13]||(s[13]=e("div",{class:"text-caption text-grey-7"},"Adelanto",-1)),e("div",de,r(n.money(a.adelanto)),1)]),e("div",ce,[s[14]||(s[14]=e("div",{class:"text-caption text-grey-7"},"Saldo",-1)),e("div",me,r(n.money(a.saldo)),1)])]),e("div",ue,[o(c,{name:"account_circle",size:"16px",class:"q-mr-xs"}),_(" "+r(a.user?.name||"—"),1)])]),_:2},1024),o(w),o(O,{align:"between",class:"q-pa-sm"},{default:i(()=>[o(u,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:v=>t.$router.push("/ordenes/editar/"+a.id)},null,8,["onClick"]),e("div",null,[o(u,{dense:"",flat:"",icon:"print",onClick:v=>n.imprimirOrden(a.id)},null,8,["onClick"]),o(u,{dense:"",flat:"",icon:"assignment",onClick:v=>n.imprimirGarantia(a.id)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128))])]),e("div",ge,[e("div",pe,[e("div",he,[e("div",_e,[s[15]||(s[15]=e("div",{class:"q-mr-sm text-caption text-grey-7"},"Por página",-1)),o(f,{dense:"",outlined:"","emit-value":"","map-options":"",options:l.perPageOptions,modelValue:l.pagination.rowsPerPage,"onUpdate:modelValue":[s[6]||(s[6]=a=>l.pagination.rowsPerPage=a),n.onChangePerPage],style:{width:"110px"}},null,8,["options","modelValue","onUpdate:modelValue"]),e("div",fe," Mostrando "+r(l.ordenes.length)+" de "+r(l.pagination.rowsNumber)+" registros ",1)])]),e("div",ve,[e("div",be,[o(F,{modelValue:l.pagination.page,"onUpdate:modelValue":[s[7]||(s[7]=a=>l.pagination.page=a),n.getOrdenes],max:l.pagination.lastPage,"max-pages":7,"boundary-numbers":"","direction-links":"",size:"sm"},null,8,["modelValue","max","onUpdate:modelValue"])])])])])])]),_:1})]),_:1})]),_:1})}const Te=y(U,[["render",xe],["__scopeId","data-v-706a8d7c"]]);export{Te as default};
