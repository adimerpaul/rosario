import{_ as q,c as C,o as u,w as r,a as e,Q as m,e as c,b as s,a6 as v,d as p,as as D,f,t as i,a7 as _,a2 as h,a1 as w,a3 as V,a4 as k,at as g,a0 as S,Z as b,au as U,a8 as N}from"./index-GRQbFRjP.js";import{Q as P}from"./QSelect-RdYh5VZI.js";import{Q as z}from"./QSpace-xDVxSuLr.js";import{Q as y}from"./QChip-DR0J0hUa.js";import{Q as B}from"./QBanner-BMb9tB6T.js";import{Q as R}from"./QPagination-_JPADg8m.js";import{Q as A}from"./QInnerLoading-CvoyLaCz.js";import{Q as E}from"./QPage-Dsg829Do.js";import{h as I}from"./moment-C5S46NFB.js";import"./format-DVi3OWXM.js";import"./selection-Dljr_TAl.js";const H={name:"OrdenesRetrasados",data(){return{ordenes:[],usuarios:[{id:null,name:"Todos"}],filters:{search:"",user_id:null,dias:1},page:1,perPage:24,totalPages:1,resumen:{total:0,saldo:0,promDias:0},loading:!1}},mounted(){this.getUsuarios(),this.fetchData()},methods:{async getUsuarios(){try{const{data:t}=await this.$axios.get("users");this.usuarios=[{id:null,name:"Todos"},...t]}catch{}},async fetchData(){this.loading=!0;try{const{data:t}=await this.$axios.get("ordenesRetrasadas",{params:{...this.filters,page:this.page,per_page:this.perPage}});this.ordenes=t.data||t,this.totalPages=t.last_page||1,this.page=t.current_page||this.page,this.calcularResumen()}catch(t){this.$alert?.error?.(t.response?.data?.message||"Error al obtener órdenes retrasadas")}finally{this.loading=!1}},calcularResumen(){const t=this.ordenes.length||1,a=(n,x)=>n.reduce((o,d)=>o+x(d),0);this.resumen.total=this.ordenes.length,this.resumen.saldo=a(this.ordenes,n=>Number(n.saldo||0)),this.resumen.promDias=(a(this.ordenes,n=>Number(n.dias_retraso||0))/t).toFixed(1)},money(t){return Number(t||0).toFixed(2)},date(t){return t?I(t).format("YYYY-MM-DD"):"—"},colorDias(t){return t>=8?"#e53935":t>=4?"#fb8c00":"#fdd835"},estadoColor(t){return t==="Pendiente"?"#fb8c00":t==="Entregado"?"#21ba45":t==="Cancelada"?"#e53935":"#9e9e9e"},telHref(t){const a=String(t||"").trim();return a?`tel:${a}`:null},waHref(t){const a=String(t.celular||"").replace(/\D/g,""),n=encodeURIComponent(`Hola ${t.cliente?.name||""}, le recordamos su Orden ${t.numero} con fecha de entrega ${this.date(t.fecha_entrega)}. Actualmente presenta ${t.dias_retraso} día(s) de retraso. Saldo: Bs. ${this.money(t.saldo)}.`);return a?`https://wa.me/${a}?text=${n}`:null},imprimir(t){const a=`${this.$axios.defaults.baseURL}/ordenes/${t}/pdf`;window.open(a,"_blank")}}},L={class:"col-12 col-md-4"},M={class:"col-6 col-md-3"},T={class:"col-6 col-md-3"},Y={class:"col-12 col-md-2"},F={class:"row justify-end"},K={class:"row q-col-gutter-sm"},O={class:"col-12 col-md-4"},j={class:"text-h6"},W={class:"col-12 col-md-4"},Z={class:"text-h6"},G={class:"col-12 col-md-4"},J={class:"text-h6"},X={class:"row q-col-gutter-sm"},$={class:"row items-center no-wrap"},ee={class:"q-ml-sm"},se={class:"text-weight-bold"},te={class:"text-caption text-grey-7"},ae={class:"row items-center"},le={class:"text-body2 ellipsis-2-lines"},oe={class:"row q-mt-xs"},re={class:"col-12"},de={class:"ellipsis-2-lines"},ie={class:"row q-mt-sm"},ne={class:"col-6"},ce={class:"text-weight-medium"},ue={class:"col-6"},me={class:"row items-center"},pe={key:0,class:"col-12"},fe={key:0,class:"row justify-center q-mt-sm"};function he(t,a,n,x,o,d){return u(),C(E,{class:"q-pa-sm bg-grey-2"},{default:r(()=>[e(m,{flat:"",bordered:""},{default:r(()=>[e(c,{class:"row items-end q-col-gutter-sm"},{default:r(()=>[s("div",L,[e(v,{dense:"",outlined:"",clearable:"",modelValue:o.filters.search,"onUpdate:modelValue":[a[0]||(a[0]=l=>o.filters.search=l),d.fetchData],label:"Buscar por N° / cliente / detalle…",debounce:400},{append:r(()=>[e(p,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),s("div",M,[e(P,{dense:"",outlined:"",modelValue:o.filters.user_id,"onUpdate:modelValue":[a[1]||(a[1]=l=>o.filters.user_id=l),d.fetchData],options:o.usuarios,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Usuario"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",T,[e(v,{dense:"",outlined:"",type:"number",min:"1",step:"1",modelValue:o.filters.dias,"onUpdate:modelValue":a[2]||(a[2]=l=>o.filters.dias=l),modelModifiers:{number:!0},label:"Mín. días de retraso",onKeyup:D(d.fetchData,["enter"])},null,8,["modelValue","onKeyup"])]),s("div",Y,[s("div",F,[e(f,{color:"primary","no-caps":"",icon:"refresh",label:"Actualizar",loading:o.loading,onClick:d.fetchData},null,8,["loading","onClick"])])])]),_:1}),e(c,{class:"q-pt-none"},{default:r(()=>[s("div",K,[s("div",O,[e(m,{bordered:"",class:"bg-orange-1"},{default:r(()=>[e(c,{class:"row items-center"},{default:r(()=>[e(p,{name:"schedule",color:"orange",size:"lg",class:"q-mr-sm"}),s("div",null,[a[4]||(a[4]=s("div",{class:"text-subtitle2 text-orange-9 text-weight-bold"},"Total retrasadas",-1)),s("div",j,i(o.resumen.total),1)])]),_:1})]),_:1})]),s("div",W,[e(m,{bordered:"",class:"bg-red-1"},{default:r(()=>[e(c,{class:"row items-center"},{default:r(()=>[e(p,{name:"account_balance_wallet",color:"red",size:"lg",class:"q-mr-sm"}),s("div",null,[a[5]||(a[5]=s("div",{class:"text-subtitle2 text-red-9 text-weight-bold"},"Saldo pendiente",-1)),s("div",Z,i(d.money(o.resumen.saldo)),1)])]),_:1})]),_:1})]),s("div",G,[e(m,{bordered:"",class:"bg-blue-1"},{default:r(()=>[e(c,{class:"row items-center"},{default:r(()=>[e(p,{name:"bar_chart",color:"blue",size:"lg",class:"q-mr-sm"}),s("div",null,[a[6]||(a[6]=s("div",{class:"text-subtitle2 text-blue-9 text-weight-bold"},"Prom. días retraso",-1)),s("div",J,i(o.resumen.promDias),1)])]),_:1})]),_:1})])])]),_:1}),e(_),e(c,{class:"q-pt-sm"},{default:r(()=>[s("div",X,[(u(!0),h(V,null,k(o.ordenes,l=>(u(),h("div",{key:l.id,class:"col-12 col-md-4"},[e(m,{bordered:"",flat:"",class:"ord-card"},{default:r(()=>[s("div",{class:"status-strip",style:g({backgroundColor:d.colorDias(l.dias_retraso)})},null,4),e(c,{class:"q-pb-xs"},{default:r(()=>[s("div",$,[e(S,{icon:"warning",color:d.colorDias(l.dias_retraso),"text-color":"white",size:"32px"},null,8,["color"]),s("div",ee,[s("div",se,"#"+i(l.numero),1),s("div",te,"Entrega: "+i(d.date(l.fecha_entrega)),1)]),e(z),e(y,{dense:"",square:"","text-color":"white",style:g({backgroundColor:d.colorDias(l.dias_retraso)})},{default:r(()=>[b(i(l.dias_retraso)+" d. ",1)]),_:2},1032,["style"])])]),_:2},1024),e(_,{spaced:""}),e(c,{class:"q-pt-none"},{default:r(()=>[s("div",ae,[e(p,{name:"person",size:"18px",class:"q-mr-xs"}),s("div",le,i(l.cliente?.name||"N/A"),1)]),s("div",oe,[s("div",re,[a[7]||(a[7]=s("div",{class:"text-caption text-grey-7"},"Detalle",-1)),s("div",de,i(l.detalle||"—"),1)])]),s("div",ie,[s("div",ne,[a[8]||(a[8]=s("div",{class:"text-caption text-grey-7"},"Saldo",-1)),s("div",ce,i(d.money(l.saldo)),1)]),s("div",ue,[a[9]||(a[9]=s("div",{class:"text-caption text-grey-7"},"Estado",-1)),e(y,{dense:"",square:"","text-color":"white",style:g({backgroundColor:d.estadoColor(l.estado)})},{default:r(()=>[b(i(l.estado),1)]),_:2},1032,["style"])])])]),_:2},1024),e(_),e(U,{align:"between",class:"q-pa-sm"},{default:r(()=>[s("div",me,[e(f,{dense:"",flat:"",icon:"call",href:d.telHref(l.celular),disable:!l.celular,title:"Llamar"},null,8,["href","disable"]),e(f,{dense:"",flat:"",icon:"whatsapp",href:d.waHref(l),target:"_blank",title:"WhatsApp"},null,8,["href"]),e(f,{dense:"",flat:"",icon:"print",onClick:Q=>d.imprimir(l.id),title:"Imprimir orden"},null,8,["onClick"])]),e(f,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:Q=>t.$router.push("/ordenes/editar/"+l.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),!o.ordenes.length&&!o.loading?(u(),h("div",pe,[e(B,{class:"bg-grey-2 text-grey-8"},{default:r(()=>a[10]||(a[10]=[b("No hay órdenes retrasadas con los filtros aplicados.")])),_:1})])):w("",!0)]),o.totalPages>1?(u(),h("div",fe,[e(R,{modelValue:o.page,"onUpdate:modelValue":[a[3]||(a[3]=l=>o.page=l),d.fetchData],max:o.totalPages,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])])):w("",!0)]),_:1}),e(A,{showing:o.loading},{default:r(()=>[e(N,{size:"32px"})]),_:1},8,["showing"])]),_:1})]),_:1})}const Ve=q(H,[["render",he],["__scopeId","data-v-9bbd9f93"]]);export{Ve as default};
