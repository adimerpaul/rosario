import{_ as O,c as m,o as r,w as o,a as t,Q as f,e as p,b as e,an as x,f as k,d as u,t as n,a2 as w,a3 as U,a4 as y,W as _,Z as h}from"./index-H1xfLONU.js";import{Q as C}from"./QSelect-B5Q5KX5I.js";import{Q as q,d as E,a as g,b as c,C as b}from"./ClosePopup-BWUG6Kch.js";import{Q as F}from"./format-BLZ5nlkB.js";import{Q as N}from"./QMarkupTable-r3-gjMWZ.js";import{Q as Y}from"./QPage-BwE-RHpL.js";import{h as Q}from"./moment-C5S46NFB.js";import"./selection-B1P-o9T7.js";const z={name:"OrdenesPage",data(){return{ordenes:[],usuarios:[],estados:["Todos","Pendiente","Entregado","Cancelada"],filters:{fecha_inicio:Q().startOf("week").format("YYYY-MM-DD"),fecha_fin:Q().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos"},resumen:{total:0,adelanto:0,saldo:0},loading:!1}},mounted(){this.getUsuarios(),this.getOrdenes()},methods:{imprimirOrden(a){const l=`${this.$axios.defaults.baseURL}/ordenes/${a}/pdf`;window.open(l,"_blank")},imprimirGarantia(a){const l=`${this.$axios.defaults.baseURL}/ordenes/${a}/garantia`;window.open(l,"_blank")},getUsuarios(){this.$axios.get("users").then(a=>{this.usuarios=[{id:null,name:"Todos"},...a.data]})},getOrdenes(){this.loading=!0,this.$axios.get("ordenes",{params:this.filters}).then(a=>{this.ordenes=a.data.data||a.data,this.calcularResumen()}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al obtener órdenes")}).finally(()=>{this.loading=!1})},calcularResumen(){this.resumen.total=this.ordenes.reduce((a,l)=>a+Number(l.costo_total),0),this.resumen.adelanto=this.ordenes.reduce((a,l)=>a+Number(l.adelanto),0),this.resumen.saldo=this.ordenes.reduce((a,l)=>a+Number(l.saldo),0)},getEstadoColor(a){switch(a){case"Pendiente":return"orange";case"Entregado":return"green";case"Cancelada":return"red";default:return"grey"}}}},D={class:"row q-col-gutter-sm"},I={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},S={class:"col-12 col-md-3"},T={class:"col-12 col-md-3"},M={class:"col-12 col-md-2 q-mt-sm"},P={class:"col-12 col-md-2 q-mt-sm"},A={class:"col-12 col-md-8 q-mt-sm"},L={class:"row q-col-gutter-sm"},R={class:"col-12 col-md-4"},G={class:"text-h6"},W={class:"col-12 col-md-4"},Z={class:"text-h6"},j={class:"col-12 col-md-4"},H={class:"text-h6"},J={class:"col-12 q-mt-sm"};function K(a,l,X,$,d,i){return r(),m(Y,{class:"q-pa-xs"},{default:o(()=>[t(f,{flat:"",bordered:""},{default:o(()=>[t(p,null,{default:o(()=>[e("div",D,[e("div",I,[t(x,{label:"Fecha Inicio",type:"date",dense:"",outlined:"",modelValue:d.filters.fecha_inicio,"onUpdate:modelValue":[l[0]||(l[0]=s=>d.filters.fecha_inicio=s),i.getOrdenes]},null,8,["modelValue","onUpdate:modelValue"])]),e("div",B,[t(x,{label:"Fecha Fin",type:"date",dense:"",outlined:"",modelValue:d.filters.fecha_fin,"onUpdate:modelValue":[l[1]||(l[1]=s=>d.filters.fecha_fin=s),i.getOrdenes]},null,8,["modelValue","onUpdate:modelValue"])]),e("div",S,[t(C,{modelValue:d.filters.user_id,"onUpdate:modelValue":[l[2]||(l[2]=s=>d.filters.user_id=s),i.getOrdenes],options:d.usuarios,"option-label":"name","option-value":"id",label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])]),e("div",T,[t(C,{modelValue:d.filters.estado,"onUpdate:modelValue":[l[3]||(l[3]=s=>d.filters.estado=s),i.getOrdenes],options:d.estados,label:"Estado",dense:"",outlined:""},null,8,["modelValue","options","onUpdate:modelValue"])]),e("div",M,[t(k,{color:"primary",label:"Actualizar",icon:"refresh",onClick:i.getOrdenes,loading:d.loading,"no-caps":"",size:"10px"},null,8,["onClick","loading"])]),e("div",P,[t(k,{color:"green",label:"Crear Orden",icon:"add",onClick:l[4]||(l[4]=s=>a.$router.push("/ordenes/crear")),"no-caps":"",size:"10px"})]),e("div",A,[e("div",L,[e("div",R,[t(f,{bordered:"",class:"bg-blue-1"},{default:o(()=>[t(p,{class:"row items-center"},{default:o(()=>[t(u,{name:"payments",color:"blue",size:"lg",class:"q-mr-sm"}),e("div",null,[l[5]||(l[5]=e("div",{class:"text-subtitle1 text-weight-bold text-blue"},"Total",-1)),e("div",G,n(d.resumen.total.toFixed(2)),1)])]),_:1})]),_:1})]),e("div",W,[t(f,{bordered:"",class:"bg-green-1"},{default:o(()=>[t(p,{class:"row items-center"},{default:o(()=>[t(u,{name:"trending_up",color:"green",size:"lg",class:"q-mr-sm"}),e("div",null,[l[6]||(l[6]=e("div",{class:"text-subtitle1 text-weight-bold text-green"},"Adelanto",-1)),e("div",Z,n(d.resumen.adelanto.toFixed(2)),1)])]),_:1})]),_:1})]),e("div",j,[t(f,{bordered:"",class:"bg-red-1"},{default:o(()=>[t(p,{class:"row items-center"},{default:o(()=>[t(u,{name:"account_balance_wallet",color:"red",size:"lg",class:"q-mr-sm"}),e("div",null,[l[7]||(l[7]=e("div",{class:"text-subtitle1 text-weight-bold text-red"},"Saldo",-1)),e("div",H,n(d.resumen.saldo.toFixed(2)),1)])]),_:1})]),_:1})])])]),e("div",J,[t(N,{dense:"",flat:"",bordered:""},{default:o(()=>[l[11]||(l[11]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"#"),e("th",null,"Opciones"),e("th",null,"Nro"),e("th",null,"Fecha"),e("th",null,"Cliente"),e("th",null,"Usuario"),e("th",null,"Estado"),e("th",null,"Costo"),e("th",null,"Adelanto"),e("th",null,"Saldo")])],-1)),e("tbody",null,[(r(!0),w(U,null,y(d.ordenes,(s,V)=>(r(),w("tr",{key:s.id},[e("td",null,n(V+1),1),e("td",null,[t(q,{dense:"",color:"primary","no-caps":"",label:"Opciones",size:"10px"},{default:o(()=>[t(E,null,{default:o(()=>[_((r(),m(g,{clickable:"",onClick:v=>a.$router.push("/ordenes/editar/"+s.id)},{default:o(()=>[t(c,{avatar:""},{default:o(()=>[t(u,{name:"edit"})]),_:1}),t(c,null,{default:o(()=>l[8]||(l[8]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[b]]),_((r(),m(g,{clickable:"",onClick:v=>i.imprimirOrden(s.id)},{default:o(()=>[t(c,{avatar:""},{default:o(()=>[t(u,{name:"print"})]),_:1}),t(c,null,{default:o(()=>l[9]||(l[9]=[h("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[b]]),_((r(),m(g,{clickable:"",onClick:v=>i.imprimirGarantia(s.id)},{default:o(()=>[t(c,{avatar:""},{default:o(()=>[t(u,{name:"assignment"})]),_:1}),t(c,null,{default:o(()=>l[10]||(l[10]=[h("Imprimir Garantía")])),_:1})]),_:2},1032,["onClick"])),[[b]])]),_:2},1024)]),_:2},1024)]),e("td",null,n(s.numero),1),e("td",null,n(s.fecha_creacion.substring(0,10)),1),e("td",null,n(s.cliente?.name||"N/A"),1),e("td",null,n(s.user?.name),1),e("td",null,[t(F,{color:i.getEstadoColor(s.estado),"text-color":"white",dense:""},{default:o(()=>[h(n(s.estado),1)]),_:2},1032,["color"])]),e("td",null,n(s.costo_total),1),e("td",null,n(s.adelanto),1),e("td",null,n(s.saldo),1)]))),128))])]),_:1})])])]),_:1})]),_:1})]),_:1})}const ie=O(z,[["render",K]]);export{ie as default};
