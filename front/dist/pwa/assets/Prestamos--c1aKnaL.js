import{Q as _}from"./QSelect-D3IBl4sl.js";import{j as w,k as y,l as Y,ad as k,_ as Q,c as P,o as u,w as n,a as r,Q as V,e as v,b as a,an as D,d as x,f as b,a2 as h,a1 as p,a3 as M,a4 as N,ay as q,a0 as B,t as i,Z as c,am as C,az as U}from"./index-BeVpAlZF.js";import{Q as f}from"./format-Bb3gYUA6.js";import{Q as F}from"./QPagination-CSdn6oI8.js";import{Q as S}from"./QPage-CjLFjO73.js";import{h as m}from"./moment-C5S46NFB.js";import"./QMenu-DCtng7NL.js";import"./selection-kJT5E5np.js";const A=["top","middle","bottom"],I=w({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>A.includes(e)}},setup(e,{slots:t}){const g=y(()=>e.align!==void 0?{verticalAlign:e.align}:null),d=y(()=>{const o=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(o!==void 0?` text-${o}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>Y("div",{class:d.value,style:g.value,role:"status","aria-label":e.label},k(t.default,e.label!==void 0?[e.label]:[]))}}),O={name:"PrestamosPage",data(){return{prestamos:[],usuarios:[],estados:["Todos","Pendiente","Pagado","Cancelado","Vencido"],filters:{fecha_inicio:m().startOf("week").format("YYYY-MM-DD"),fecha_fin:m().endOf("week").format("YYYY-MM-DD"),user_id:null,estado:"Todos",search:""},page:1,perPage:12,perPageOptions:[6,12,24,36,60].map(e=>({label:String(e),value:e})),totalPages:1,totalItems:0,from:0,to:0,resumen:{prestado:0,cargos:0,saldo:0},loading:!1}},mounted(){this.getUsuarios(),this.getPrestamos()},methods:{resetAndFetch(){this.page=1,this.getPrestamos()},getUsuarios(){this.$axios.get("users").then(e=>{this.usuarios=[{id:null,name:"Todos"},...e.data]})},getPrestamos(){this.loading=!0,this.$axios.get("prestamos",{params:{...this.filters,page:this.page,per_page:this.perPage}}).then(e=>{const t=e.data;this.prestamos=t.data||t,this.totalPages=t.last_page||1,this.page=t.current_page||1,this.totalItems=t.total||(t.data?t.data.length:this.prestamos.length),this.from=t.from||(this.page-1)*this.perPage+(this.totalItems?1:0),this.to=t.to||Math.min(this.page*this.perPage,this.totalItems),this.calcularResumen()}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"Error al obtener préstamos")}).finally(()=>{this.loading=!1})},calcularResumen(){const e=(d,o)=>d.reduce((l,s)=>l+o(s),0),t=d=>Number(d.valor_prestado||0),g=d=>this.cargosEstimados(d);this.resumen.prestado=e(this.prestamos,t),this.resumen.cargos=e(this.prestamos,g),this.resumen.saldo=e(this.prestamos,d=>Number(d.saldo||0))},fmtFecha(e){return e?m(e).format("YYYY-MM-DD"):"—"},money(e){return Number(e||0).toFixed(2)},estadoColor(e){return e.estado==="Pagado"?"#21ba45":e.estado==="Cancelado"?"#e53935":this.esVencido(e)?"#f4511e":e.estado==="Pendiente"?"#fb8c00":"#9e9e9e"},estadoIcon(e){return e.estado==="Pagado"?"check_circle":e.estado==="Cancelado"?"block":this.esVencido(e)?"warning":e.estado==="Pendiente"?"hourglass_empty":"payments"},estadoTexto(e){return this.esVencido(e)&&e.estado==="Pendiente"?"Vencido":e.estado},esVencido(e){return e.fecha_limite?m().startOf("day").isAfter(m(e.fecha_limite,"YYYY-MM-DD").startOf("day"))&&e.estado!=="Pagado"&&e.estado!=="Cancelado":!1},dias(e){const t=e.fecha_creacion?m(e.fecha_creacion,"YYYY-MM-DD"):m();return Math.max(0,m().startOf("day").diff(t.startOf("day"),"days"))},tasaMensual(e){return Number(e.interes||0)+Number(e.almacen||0)},tasaDiaria(e){return this.tasaMensual(e)/100/30},cargoDiario(e){return+(Number(e.valor_prestado||0)*this.tasaDiaria(e)).toFixed(2)},cargosEstimados(e){return+(this.cargoDiario(e)*this.dias(e)).toFixed(2)}}},E={class:"row q-col-gutter-sm"},z={class:"col-12 col-md-3"},T={class:"col-12 col-md-3"},L={class:"col-12 col-md-6"},j={class:"col-12 col-md-2"},R={class:"col-12 col-md-2 q-mt-sm"},H={class:"col-12 col-md-2 q-mt-sm"},Z={class:"col-12 q-mt-sm"},G={class:"row q-col-gutter-sm"},J={class:"row items-center no-wrap"},K={class:"q-ml-sm"},W={class:"text-weight-bold"},X={class:"text-caption text-grey-7"},$={key:0},ee={class:"q-mt-xs"},te={class:"row items-center"},se={class:"text-body2 ellipsis-2-lines"},ae={class:"row q-mt-sm"},oe={class:"col-6"},le={class:"text-weight-medium"},re={class:"col-6"},ie={class:"text-weight-medium"},ne={class:"text-caption text-grey"},de={class:"row q-mt-sm"},ce={class:"col-6"},me={class:"text-weight-medium"},ue={class:"col-6"},ge={class:"text-h6 text-weight-bold"},he={class:"row items-center q-mt-sm text-caption text-grey"},fe={key:0,class:"row items-center justify-between q-mt-sm"},_e={class:"col-auto text-caption text-grey-8 q-ml-sm"},ve={class:"col-auto"};function xe(e,t,g,d,o,l){return u(),P(S,{class:"q-pa-xs"},{default:n(()=>[r(V,{flat:"",bordered:""},{default:n(()=>[r(v,null,{default:n(()=>[a("div",E,[a("div",z,[r(_,{modelValue:o.filters.user_id,"onUpdate:modelValue":[t[0]||(t[0]=s=>o.filters.user_id=s),l.resetAndFetch],options:o.usuarios,"option-label":"name","option-value":"id","emit-value":"","map-options":"",dense:"",outlined:"",label:"Usuario"},null,8,["modelValue","options","onUpdate:modelValue"])]),a("div",T,[r(_,{modelValue:o.filters.estado,"onUpdate:modelValue":[t[1]||(t[1]=s=>o.filters.estado=s),l.resetAndFetch],options:o.estados,dense:"",outlined:"",label:"Estado"},null,8,["modelValue","options","onUpdate:modelValue"])]),a("div",L,[r(D,{modelValue:o.filters.search,"onUpdate:modelValue":[t[2]||(t[2]=s=>o.filters.search=s),l.resetAndFetch],dense:"",outlined:"",placeholder:"Buscar por Nº, nombre o CI…",debounce:400},{append:n(()=>[r(x,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),a("div",j,[r(_,{dense:"",outlined:"",modelValue:o.perPage,"onUpdate:modelValue":[t[3]||(t[3]=s=>o.perPage=s),l.resetAndFetch],options:o.perPageOptions,label:"Por página","emit-value":"","map-options":""},null,8,["modelValue","options","onUpdate:modelValue"])]),a("div",R,[r(b,{color:"primary",label:"Actualizar",icon:"refresh",loading:o.loading,"no-caps":"",onClick:l.getPrestamos},null,8,["loading","onClick"])]),a("div",H,[r(b,{color:"green",label:"Nuevo Préstamo",icon:"add","no-caps":"",onClick:t[4]||(t[4]=s=>e.$router.push("/prestamos/crear"))})]),a("div",Z,[a("div",G,[(u(!0),h(M,null,N(o.prestamos,s=>(u(),h("div",{key:s.id,class:"col-12 col-sm-6 col-md-4"},[r(V,{bordered:"",flat:"",class:"loan-card"},{default:n(()=>[a("div",{class:"status-strip",style:q({backgroundColor:l.estadoColor(s)})},null,4),r(v,{class:"q-pb-xs"},{default:n(()=>[a("div",J,[r(B,{icon:l.estadoIcon(s),color:l.estadoColor(s),"text-color":"white",size:"32px"},null,8,["icon","color"]),a("div",K,[a("div",W,"#"+i(s.numero),1),a("div",X,[c(i(l.fmtFecha(s.fecha_creacion))+" ",1),s.fecha_limite?(u(),h("span",$," — vence: "+i(l.fmtFecha(s.fecha_limite)),1)):p("",!0)]),a("div",ee,[r(f,{dense:"",square:"",style:q({backgroundColor:l.estadoColor(s)}),"text-color":"white"},{default:n(()=>[c(i(l.estadoTexto(s)),1)]),_:2},1032,["style"]),r(f,{dense:"",outline:"",color:"primary",class:"q-ml-xs"},{default:n(()=>[c(i(l.dias(s))+" días ",1)]),_:2},1024),r(f,{dense:"",outline:"",color:"teal",class:"q-ml-xs"},{default:n(()=>[c(i(l.tasaMensual(s))+"%/mes ",1)]),_:2},1024),r(f,{dense:"",outline:"",color:"indigo",class:"q-ml-xs"},{default:n(()=>[c(i(l.money(l.tasaDiaria(s)*100))+"%/día ",1)]),_:2},1024)])])])]),_:2},1024),r(C,{spaced:""}),r(v,{class:"q-pt-none"},{default:n(()=>[a("div",te,[r(x,{name:"person",size:"18px",class:"q-mr-xs"}),a("div",se,i(s.cliente?.name||"N/A"),1)]),a("div",ae,[a("div",oe,[t[6]||(t[6]=a("div",{class:"text-caption text-grey-7"},"Prestado",-1)),a("div",le,i(l.money(s.valor_prestado)),1)]),a("div",re,[t[7]||(t[7]=a("div",{class:"text-caption text-grey-7"},"Cargos estimados",-1)),a("div",ie,i(l.money(l.cargosEstimados(s))),1),a("div",ne,i(s.interes)+"% + "+i(s.almacen)+"%",1)])]),a("div",de,[a("div",ce,[t[8]||(t[8]=a("div",{class:"text-caption text-grey-7"},"Cargo diario",-1)),a("div",me,i(l.money(l.cargoDiario(s))),1)]),a("div",ue,[t[10]||(t[10]=a("div",{class:"text-caption text-grey-7"},"Saldo HOY",-1)),a("div",ge,[c(i(l.money(s.saldo))+" ",1),l.esVencido(s)?(u(),P(I,{key:0,color:"negative",class:"q-ml-xs"},{default:n(()=>t[9]||(t[9]=[c("Vencido")])),_:1})):p("",!0)])])]),a("div",he,[r(x,{name:"account_circle",size:"16px",class:"q-mr-xs"}),c(" "+i(s.user?.name||"—"),1)])]),_:2},1024),r(C),r(U,{align:"between",class:"q-pa-sm"},{default:n(()=>[r(b,{dense:"",flat:"",icon:"edit",label:"Editar",onClick:be=>e.$router.push("/prestamos/editar/"+s.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),o.totalPages>1?(u(),h("div",fe,[a("div",_e," Mostrando "+i(o.from)+"–"+i(o.to)+" de "+i(o.totalItems),1),a("div",ve,[r(F,{modelValue:o.page,"onUpdate:modelValue":[t[5]||(t[5]=s=>o.page=s),l.getPrestamos],max:o.totalPages,"max-pages":6,"boundary-numbers":"",color:"primary",disable:o.loading},null,8,["modelValue","max","disable","onUpdate:modelValue"])])])):p("",!0)])])]),_:1})]),_:1})]),_:1})}const ke=Q(O,[["render",xe],["__scopeId","data-v-f28f51cf"]]);export{ke as default};
